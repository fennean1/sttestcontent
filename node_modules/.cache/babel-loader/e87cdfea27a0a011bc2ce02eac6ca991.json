{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport blueGradient from \"../assets/blue-gradient.png\";\nimport * as CONST from \"./const.js\";\nimport QuestionMark from '../assets/QuestionMark.png';\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport { Fraction, Draggable } from \"./api.js\";\nimport { isObject } from \"util\";\nconst ASSETS = CONST.ASSETS;\nexport const init = (app, setup) => {\n  // Layout Parameters\n  const LINE_PERCENTAGE = 0.8;\n  let WINDOW_WIDTH = setup.width;\n  let BAR_HEIGHT = setup.height / 15;\n  let WINDOW_HEIGHT = setup.height;\n  let H_W_RATIO = setup.height / setup.width;\n  let LANDSCAPE = H_W_RATIO < 3 / 4;\n  let ARENA_WIDTH = LANDSCAPE ? 4 / 3 * setup.height : setup.width;\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3 / 4 * setup.width;\n  let SQUARE_DIM = ARENA_HEIGHT * 0.6;\n  let SQUARE_AREA = SQUARE_DIM * SQUARE_DIM;\n  let stencil;\n  let Nodes = [];\n  let CurrentPolygon = [];\n  let fraction; // Constants\n\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.GLASS_CIRCLE);\n  const DOT_TEXTURE = new PIXI.Texture.from(ASSETS.GLASS_CIRCLE);\n\n  function makeBackground() {\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH;\n    this.sprite.height = WINDOW_HEIGHT;\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.interactive = true;\n    app.stage.addChild(this.sprite);\n\n    this.draw = () => {\n      this.sprite.width = WINDOW_WIDTH;\n      this.sprite.height = WINDOW_HEIGHT;\n    };\n  }\n\n  class Stencil extends PIXI.Graphics {\n    constructor() {\n      super();\n    }\n\n    draw(nodes) {\n      console.log(\"draw called\");\n      console.log(\"nodes\", nodes);\n      this.clear();\n      this.lineStyle(4, 0xff3b55);\n      this.moveTo(nodes[0][0], nodes[0][1]);\n\n      for (let n of nodes) {\n        let x = n[0];\n        let y = n[1];\n        this.lineTo(x, y);\n      }\n    }\n\n  }\n\n  function linesIntersect(l1, l2) {\n    let m1 = l1.m;\n    let m2 = l2.m;\n    let b1 = l1.b;\n    let b2 = l2.b;\n    let xIntersect = (m1 - m2) / (b2 - b1);\n    let yIntersect = l1.yOf(xIntersect);\n    let inYRange1 = yIntersect > l1.yMin && yIntersect < l1.yMax;\n    let inXRange1 = xIntersect > l1.xMin && yIntersect < l1.xMax;\n    let inYRange2 = yIntersect > l2.yMin && yIntersect < l2.yMax;\n    let inXRange2 = xIntersect > l2.xMin && xIntersect < l2.xMax;\n    return inXRange1 && inXRange2 && inYRange1 && inYRange2;\n  }\n  /*\n  function intersects(lineOnePointPair,lineTwoPointPair){\n    let x11 = lineOnePointPair[0][0]\n    let y11 = lineOnePointPair[0][1]\n    let x21 = lineOnePointPair[1][0]\n    let y21 = lineOnePointPair[1][1]\n    let x12 = lineTwoPointPair[0][0]\n    let y12 = lineTwoPointPair[0][1]\n    let x22 = lineTwoPointPair[1][0]\n    let y22 = lineTwoPointPair[1][1]\n     let yMax1 = Math.max(y11,y21)\n    let yMin1 = Math.min(y11,y21)\n    let xMax1 = Math.max(x11,x21)\n    let xMin1 = Math.min(x11,x21)\n     let yMax2 = Math.max(y12,y22)\n    let yMin2 = Math.min(y12,y22)\n    let xMax2 = Math.max(x12,x22)\n    let xMin2 = Math.min(x12,x22)\n      let m1 = (y21 - y11)/(x21-x11)\n    let m2 = (y22 - y12)/(x22-x12)\n    let b1 = y11 - m1*x11\n    let b2 = y12 - m2*x12\n    \n    const y1 = x=>m1*x+b1\n    const y2 = x=>m2*x+b2\n     let xIntersect = (m1 - m2)/(b2-b1)\n    let yIntersect = y1(xIntersect)\n    \n    let inYRange1 = (yIntersect > yMin1) && (yIntersect < yMax1)\n    let inXRange1 = (xIntersect > xMin1) && (yIntersect < xMax1)\n    let inYRange2 = (yIntersect > yMin2) && (yIntersect < yMax2)\n    let inXRange2 = (xIntersect > xMin2) && (xIntersect < xMax2)\n    \n    return (inXRange1 && inXRange2 && inYRange1 && inYRange2)\n   }\n  */\n\n\n  class Line {\n    constructor(p1, p2) {\n      this.x1 = p1[0];\n      this.y1 = p1[1];\n      this.x2 = p2[0];\n      this.y2 = p2[1];\n      this.yMax = Math.max(this.y1, this.y2);\n      this.yMin = Math.min(this.y1, this.y2);\n      this.xMax = Math.max(this.x1, this.x2);\n      this.xMin = Math.min(this.x1, this.x2);\n      this.p1 = p1;\n      this.p2 = p2;\n      this.m = (this.y2 - this.y1) / (this.x2 - this.x1);\n      this.b = this.y1 - this.m * this.x1;\n    }\n\n    yOf(x) {\n      return this.m * x + this.b;\n    }\n\n    xOf(y) {\n      return (y - this.b) / this.m;\n    }\n\n  }\n\n  function polyToLines(poly) {\n    let n = poly.length;\n    let lines = poly.map((p, i) => {\n      return new Line(p, poly[(i + 1) % n]);\n    });\n  }\n\n  function doesNewLineCrossCurrentLines(lines, newLine) {\n    let contains = false;\n    lines.forEach(l => {\n      if (linesIntersect(l, newLine)) {\n        return true;\n      }\n    });\n    return contains;\n  }\n\n  class Node extends PIXI.Sprite {\n    constructor() {\n      super();\n      this.on('pointerdown', this.pointerDown);\n      this.on('pointerup', this.pointerUp);\n      this.on('pointerupoutside', this.pointerUpOutside);\n      this.anchor.set(0.5);\n      this.activated = false;\n      this.interactive = true;\n      this.texture = DOT_TEXTURE;\n    }\n\n    pointerDown() {\n      if (this.first) {\n        this.first = false;\n        stencil.clear();\n        this.generatePolygon();\n      } else {\n        if (CurrentPolygon.length == 0) {\n          this.first = true;\n        }\n\n        CurrentPolygon.push([this.x, this.y]);\n        this.activated = true;\n        this.scale.x = this.scale.x * 1.2;\n        this.scale.y = this.scale.y * 1.2;\n        stencil.draw(CurrentPolygon);\n        app.stage.addChild(this);\n      }\n    }\n\n    pointerUpOutside() {}\n\n    pointerUp() {}\n\n    generatePolygon() {\n      Nodes.forEach(n => {\n        if (n.activated) {\n          n.scale.x = n.scale.x / 1.2;\n          n.scale.y = n.scale.y / 1.2;\n          n.activated = false;\n        }\n      });\n      let xS = CurrentPolygon.map(p => p[0]);\n      let yS = CurrentPolygon.map(p => p[1]);\n      let minX = Math.min(...xS);\n      let minY = Math.min(...yS);\n      let flatPolygon = [];\n      CurrentPolygon.forEach(p => {\n        flatPolygon.push(p[0] - minX);\n        flatPolygon.push(p[1] - minY);\n      });\n      let a = polygonArea(CurrentPolygon) / SQUARE_AREA;\n      let f = decimalToFrac(a);\n      console.log(\"polyarea\", a);\n      console.log(\"areatofrac\", decimalToFrac(a));\n      fraction.set(f[0], f[1]);\n      var graphics = new PIXI.Graphics();\n      graphics.beginFill(0xff3b55);\n      graphics.lineStyle(2, 0xffffff);\n      graphics.drawPolygon(flatPolygon);\n      graphics.endFill();\n      let d = new Draggable();\n      d.hitArea = new PIXI.Polygon(flatPolygon);\n      let t = app.renderer.generateTexture(graphics);\n      d.texture = t;\n      d.x = minX;\n      d.y = minY;\n      app.stage.addChild(d);\n    }\n\n  }\n\n  function set(a, b) {\n    let dx = SQUARE_DIM / (a - 1);\n    let dy = SQUARE_DIM / (b - 1);\n    let dim = SQUARE_DIM / 15;\n\n    for (let i = 0; i < a; i++) {\n      for (let j = 0; j < a; j++) {\n        let n = new Node();\n        Nodes.push(n);\n        n.x = WINDOW_WIDTH / 2 - SQUARE_DIM / 2 + i * dx;\n        n.y = WINDOW_HEIGHT / 2 - SQUARE_DIM / 2 + j * dy;\n        n.w = dx / 10;\n        n.height = dim;\n        n.width = dim;\n        app.stage.addChild(n);\n      }\n    }\n  }\n\n  function decimalToFrac(dec) {\n    for (let i = 1; i < 100; i++) {\n      for (let j = 0; j <= i; j++) {\n        if (Math.abs(j / i - dec) < 0.001) {\n          return [j, i];\n        }\n      }\n    }\n  } // Called on resize\n\n\n  function resize(newFrame, flex) {\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame);\n    app.renderer.resize(WINDOW_WIDTH, WINDOW_HEIGHT);\n  }\n\n  function polygonArea(poly) {\n    let area = 0;\n    let xS = poly.map(p => p[0]);\n    let yS = poly.map(p => p[1]); // Calculate value of shoelace formula \n\n    let n = poly.length;\n    let j = n - 1;\n\n    for (let i = 0; i < n; i++) {\n      area = area + (xS[j] + xS[i]) * (yS[j] - yS[i]);\n      j = i; // j is previous vertex to i \n    } // Return absolute value \n\n\n    return Math.abs(area / 2);\n  }\n\n  function updateLayoutParams(newFrame) {\n    let frame;\n\n    if (newFrame) {\n      frame = newFrame;\n    } else {\n      frame = {\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT\n      };\n    }\n\n    WINDOW_WIDTH = frame.width;\n    WINDOW_HEIGHT = frame.height;\n    H_W_RATIO = frame.height / frame.width;\n    LANDSCAPE = H_W_RATIO < 3 / 4;\n    ARENA_WIDTH = LANDSCAPE ? 4 / 3 * frame.height : frame.width;\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3 / 4 * frame.width;\n  } // Loading Script\n\n\n  function load() {\n    console.log('load called');\n    let features = {};\n\n    if (setup.props.features) {\n      features = setup.props.features;\n    }\n\n    let backGround = new makeBackground();\n    set(4, 4);\n    fraction = new Fraction(0, 1, 100);\n    fraction.x = SQUARE_DIM / 10;\n    fraction.y = SQUARE_DIM / 10;\n    app.stage.addChild(fraction);\n    stencil = new Stencil();\n    stencil.lineStyle(4, 0xff3b55);\n    stencil.x = 0;\n    stencil.y = 0;\n    app.stage.addChild(stencil);\n    let l1 = new Line([0, 0], [100, 100]);\n    let l2 = new Line([0, 100], [100, 0]);\n    stencil.lineTo(100, 100);\n    stencil.moveTo(0, 100);\n    stencil.lineTo(100, 0);\n  } // Call load script\n\n\n  load(); // Not sure where else to put this.\n\n  app.resize = frame => resize(frame);\n\n  app.resizable = true;\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/gridnodes.js"],"names":["PIXI","blueGradient","CONST","QuestionMark","TweenMax","TimelineLite","Power2","Elastic","CSSPlugin","TweenLite","TimelineMax","Fraction","Draggable","isObject","ASSETS","init","app","setup","LINE_PERCENTAGE","WINDOW_WIDTH","width","BAR_HEIGHT","height","WINDOW_HEIGHT","H_W_RATIO","LANDSCAPE","ARENA_WIDTH","ARENA_HEIGHT","SQUARE_DIM","SQUARE_AREA","stencil","Nodes","CurrentPolygon","fraction","BLUE_TEXTURE","Texture","from","GLASS_CIRCLE","DOT_TEXTURE","makeBackground","sprite","Sprite","BLUE_GRADIENT","x","y","interactive","stage","addChild","draw","Stencil","Graphics","constructor","nodes","console","log","clear","lineStyle","moveTo","n","lineTo","linesIntersect","l1","l2","m1","m","m2","b1","b","b2","xIntersect","yIntersect","yOf","inYRange1","yMin","yMax","inXRange1","xMin","xMax","inYRange2","inXRange2","Line","p1","p2","x1","y1","x2","y2","Math","max","min","xOf","polyToLines","poly","length","lines","map","p","i","doesNewLineCrossCurrentLines","newLine","contains","forEach","l","Node","on","pointerDown","pointerUp","pointerUpOutside","anchor","set","activated","texture","first","generatePolygon","push","scale","xS","yS","minX","minY","flatPolygon","a","polygonArea","f","decimalToFrac","graphics","beginFill","drawPolygon","endFill","d","hitArea","Polygon","t","renderer","generateTexture","dx","dy","dim","j","w","dec","abs","resize","newFrame","flex","updateLayoutParams","area","frame","load","features","props","backGround","resizable"],"mappings":"AAAA,OAAO,KAAKA,IAAZ,MAAsB,SAAtB;AACA,OAAOC,YAAP,MAAyB,6BAAzB;AACA,OAAO,KAAKC,KAAZ,MAAuB,YAAvB;AACA,OAAOC,YAAP,MAAyB,4BAAzB;AACA,SAASC,QAAT,EAAmBC,YAAnB,EAAiCC,MAAjC,EAAyCC,OAAzC,EAAkDC,SAAlD,EAA6DC,SAA7D,EAAwEC,WAAxE,QAA2F,eAA3F;AACA,SAAQC,QAAR,EAAkBC,SAAlB,QAAkC,UAAlC;AACA,SAASC,QAAT,QAAyB,MAAzB;AACA,MAAMC,MAAM,GAAGZ,KAAK,CAACY,MAArB;AAGA,OAAO,MAAMC,IAAI,GAAG,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAElC;AACA,QAAMC,eAAe,GAAG,GAAxB;AACA,MAAIC,YAAY,GAAGF,KAAK,CAACG,KAAzB;AACA,MAAIC,UAAU,GAAGJ,KAAK,CAACK,MAAN,GAAa,EAA9B;AACA,MAAIC,aAAa,GAAGN,KAAK,CAACK,MAA1B;AACA,MAAIE,SAAS,GAAGP,KAAK,CAACK,MAAN,GAAaL,KAAK,CAACG,KAAnC;AACA,MAAIK,SAAS,GAAGD,SAAS,GAAG,IAAE,CAA9B;AACA,MAAIE,WAAW,GAAGD,SAAS,GAAG,IAAE,CAAF,GAAIR,KAAK,CAACK,MAAb,GAAsBL,KAAK,CAACG,KAAvD;AACA,MAAIO,YAAY,GAAGF,SAAS,GAAGR,KAAK,CAACK,MAAT,GAAkB,IAAE,CAAF,GAAIL,KAAK,CAACG,KAAxD;AACA,MAAIQ,UAAU,GAAGD,YAAY,GAAC,GAA9B;AACA,MAAIE,WAAW,GAAGD,UAAU,GAACA,UAA7B;AAEA,MAAIE,OAAJ;AACA,MAAIC,KAAK,GAAG,EAAZ;AACA,MAAIC,cAAc,GAAG,EAArB;AACA,MAAIC,QAAJ,CAjBkC,CAmBhC;;AACF,QAAMC,YAAY,GAAG,IAAIlC,IAAI,CAACmC,OAAL,CAAaC,IAAjB,CAAsBlC,KAAK,CAACY,MAAN,CAAauB,YAAnC,CAArB;AACA,QAAMC,WAAW,GAAG,IAAItC,IAAI,CAACmC,OAAL,CAAaC,IAAjB,CAAsBtB,MAAM,CAACuB,YAA7B,CAApB;;AAEA,WAASE,cAAT,GAAyB;AACvB;AACA,SAAKC,MAAL,GAAc,IAAIxC,IAAI,CAACyC,MAAL,CAAYL,IAAhB,CAAqBlC,KAAK,CAACY,MAAN,CAAa4B,aAAlC,CAAd;AACA,SAAKF,MAAL,CAAYpB,KAAZ,GAAoBD,YAApB;AACA,SAAKqB,MAAL,CAAYlB,MAAZ,GAAqBC,aAArB;AACA,SAAKiB,MAAL,CAAYG,CAAZ,GAAgB,CAAhB;AACA,SAAKH,MAAL,CAAYI,CAAZ,GAAgB,CAAhB;AACA,SAAKJ,MAAL,CAAYK,WAAZ,GAA0B,IAA1B;AAEA7B,IAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmB,KAAKP,MAAxB;;AAEA,SAAKQ,IAAL,GAAY,MAAM;AACd,WAAKR,MAAL,CAAYpB,KAAZ,GAAoBD,YAApB;AACA,WAAKqB,MAAL,CAAYlB,MAAZ,GAAqBC,aAArB;AACH,KAHD;AAID;;AAED,QAAM0B,OAAN,SAAsBjD,IAAI,CAACkD,QAA3B,CAAoC;AAClCC,IAAAA,WAAW,GAAE;AACX;AACD;;AAEDH,IAAAA,IAAI,CAACI,KAAD,EAAO;AACTC,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AAEAD,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBF,KAApB;AACA,WAAKG,KAAL;AACA,WAAKC,SAAL,CAAe,CAAf,EAAiB,QAAjB;AACA,WAAKC,MAAL,CAAYL,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,CAAZ,EAAwBA,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,CAAxB;;AACA,WAAK,IAAIM,CAAT,IAAcN,KAAd,EAAoB;AAClB,YAAIT,CAAC,GAAGe,CAAC,CAAC,CAAD,CAAT;AACA,YAAId,CAAC,GAAGc,CAAC,CAAC,CAAD,CAAT;AACA,aAAKC,MAAL,CAAYhB,CAAZ,EAAcC,CAAd;AACD;AACF;;AAjBiC;;AAoBpC,WAASgB,cAAT,CAAwBC,EAAxB,EAA2BC,EAA3B,EAA8B;AAC5B,QAAIC,EAAE,GAAGF,EAAE,CAACG,CAAZ;AACA,QAAIC,EAAE,GAAGH,EAAE,CAACE,CAAZ;AACA,QAAIE,EAAE,GAAGL,EAAE,CAACM,CAAZ;AACA,QAAIC,EAAE,GAAGN,EAAE,CAACK,CAAZ;AAEA,QAAIE,UAAU,GAAG,CAACN,EAAE,GAAGE,EAAN,KAAWG,EAAE,GAACF,EAAd,CAAjB;AACA,QAAII,UAAU,GAAGT,EAAE,CAACU,GAAH,CAAOF,UAAP,CAAjB;AAEA,QAAIG,SAAS,GAAIF,UAAU,GAAGT,EAAE,CAACY,IAAjB,IAA2BH,UAAU,GAAGT,EAAE,CAACa,IAA3D;AACA,QAAIC,SAAS,GAAIN,UAAU,GAAGR,EAAE,CAACe,IAAjB,IAA2BN,UAAU,GAAGT,EAAE,CAACgB,IAA3D;AACA,QAAIC,SAAS,GAAIR,UAAU,GAAGR,EAAE,CAACW,IAAjB,IAA2BH,UAAU,GAAGR,EAAE,CAACY,IAA3D;AACA,QAAIK,SAAS,GAAIV,UAAU,GAAGP,EAAE,CAACc,IAAjB,IAA2BP,UAAU,GAAGP,EAAE,CAACe,IAA3D;AAEA,WAAQF,SAAS,IAAII,SAAb,IAA0BP,SAA1B,IAAuCM,SAA/C;AACD;AAID;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA,QAAME,IAAN,CAAW;AACT7B,IAAAA,WAAW,CAAC8B,EAAD,EAAIC,EAAJ,EAAO;AAChB,WAAKC,EAAL,GAAWF,EAAE,CAAC,CAAD,CAAb;AACA,WAAKG,EAAL,GAAUH,EAAE,CAAC,CAAD,CAAZ;AACA,WAAKI,EAAL,GAAWH,EAAE,CAAC,CAAD,CAAb;AACA,WAAKI,EAAL,GAAUJ,EAAE,CAAC,CAAD,CAAZ;AAEA,WAAKR,IAAL,GAAYa,IAAI,CAACC,GAAL,CAAS,KAAKJ,EAAd,EAAiB,KAAKE,EAAtB,CAAZ;AACA,WAAKb,IAAL,GAAYc,IAAI,CAACE,GAAL,CAAS,KAAKL,EAAd,EAAiB,KAAKE,EAAtB,CAAZ;AACA,WAAKT,IAAL,GAAYU,IAAI,CAACC,GAAL,CAAS,KAAKL,EAAd,EAAiB,KAAKE,EAAtB,CAAZ;AACA,WAAKT,IAAL,GAAYW,IAAI,CAACE,GAAL,CAAS,KAAKN,EAAd,EAAiB,KAAKE,EAAtB,CAAZ;AAEA,WAAKJ,EAAL,GAAUA,EAAV;AACA,WAAKC,EAAL,GAAUA,EAAV;AAEA,WAAKlB,CAAL,GAAS,CAAC,KAAKsB,EAAL,GAAQ,KAAKF,EAAd,KAAmB,KAAKC,EAAL,GAAQ,KAAKF,EAAhC,CAAT;AACA,WAAKhB,CAAL,GAAS,KAAKiB,EAAL,GAAU,KAAKpB,CAAL,GAAO,KAAKmB,EAA/B;AACD;;AAEDZ,IAAAA,GAAG,CAAC5B,CAAD,EAAG;AACJ,aAAO,KAAKqB,CAAL,GAAOrB,CAAP,GAAS,KAAKwB,CAArB;AACD;;AAEDuB,IAAAA,GAAG,CAAC9C,CAAD,EAAG;AACJ,aAAO,CAACA,CAAC,GAAC,KAAKuB,CAAR,IAAW,KAAKH,CAAvB;AACD;;AAzBQ;;AA6BX,WAAS2B,WAAT,CAAqBC,IAArB,EAA0B;AACtB,QAAIlC,CAAC,GAAGkC,IAAI,CAACC,MAAb;AACA,QAAIC,KAAK,GAAGF,IAAI,CAACG,GAAL,CAAS,CAACC,CAAD,EAAGC,CAAH,KAAO;AAC1B,aAAQ,IAAIjB,IAAJ,CAASgB,CAAT,EAAWJ,IAAI,CAAC,CAACK,CAAC,GAAC,CAAH,IAAMvC,CAAP,CAAf,CAAR;AACD,KAFW,CAAZ;AAGH;;AAED,WAASwC,4BAAT,CAAsCJ,KAAtC,EAA4CK,OAA5C,EAAoD;AAClD,QAAIC,QAAQ,GAAG,KAAf;AACAN,IAAAA,KAAK,CAACO,OAAN,CAAcC,CAAC,IAAI;AACjB,UAAI1C,cAAc,CAAC0C,CAAD,EAAGH,OAAH,CAAlB,EAA8B;AAC5B,eAAO,IAAP;AACD;AACF,KAJD;AAKA,WAAOC,QAAP;AACD;;AAGD,QAAMG,IAAN,SAAmBvG,IAAI,CAACyC,MAAxB,CAA+B;AAC7BU,IAAAA,WAAW,GAAE;AACX;AACA,WAAKqD,EAAL,CAAQ,aAAR,EAAsB,KAAKC,WAA3B;AACA,WAAKD,EAAL,CAAQ,WAAR,EAAoB,KAAKE,SAAzB;AACA,WAAKF,EAAL,CAAQ,kBAAR,EAA2B,KAAKG,gBAAhC;AACA,WAAKC,MAAL,CAAYC,GAAZ,CAAgB,GAAhB;AACA,WAAKC,SAAL,GAAiB,KAAjB;AACA,WAAKjE,WAAL,GAAmB,IAAnB;AACA,WAAKkE,OAAL,GAAezE,WAAf;AACD;;AAEDmE,IAAAA,WAAW,GAAE;AACX,UAAI,KAAKO,KAAT,EAAe;AACb,aAAKA,KAAL,GAAa,KAAb;AACAlF,QAAAA,OAAO,CAACyB,KAAR;AACA,aAAK0D,eAAL;AACD,OAJD,MAIO;AACL,YAAIjF,cAAc,CAAC6D,MAAf,IAAyB,CAA7B,EAA+B;AAC7B,eAAKmB,KAAL,GAAa,IAAb;AACD;;AACDhF,QAAAA,cAAc,CAACkF,IAAf,CAAoB,CAAC,KAAKvE,CAAN,EAAQ,KAAKC,CAAb,CAApB;AACA,aAAKkE,SAAL,GAAiB,IAAjB;AACA,aAAKK,KAAL,CAAWxE,CAAX,GAAe,KAAKwE,KAAL,CAAWxE,CAAX,GAAa,GAA5B;AACA,aAAKwE,KAAL,CAAWvE,CAAX,GAAe,KAAKuE,KAAL,CAAWvE,CAAX,GAAa,GAA5B;AACAd,QAAAA,OAAO,CAACkB,IAAR,CAAahB,cAAb;AACAhB,QAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmB,IAAnB;AACD;AACF;;AAED4D,IAAAA,gBAAgB,GAAE,CAEjB;;AAEDD,IAAAA,SAAS,GAAE,CAEV;;AAEDO,IAAAA,eAAe,GAAE;AACflF,MAAAA,KAAK,CAACsE,OAAN,CAAc3C,CAAC,IAAE;AACf,YAAIA,CAAC,CAACoD,SAAN,EAAgB;AACdpD,UAAAA,CAAC,CAACyD,KAAF,CAAQxE,CAAR,GAAYe,CAAC,CAACyD,KAAF,CAAQxE,CAAR,GAAU,GAAtB;AACAe,UAAAA,CAAC,CAACyD,KAAF,CAAQvE,CAAR,GAAYc,CAAC,CAACyD,KAAF,CAAQvE,CAAR,GAAU,GAAtB;AACAc,UAAAA,CAAC,CAACoD,SAAF,GAAc,KAAd;AACD;AACF,OAND;AAQA,UAAIM,EAAE,GAAGpF,cAAc,CAAC+D,GAAf,CAAmBC,CAAC,IAAGA,CAAC,CAAC,CAAD,CAAxB,CAAT;AACA,UAAIqB,EAAE,GAAGrF,cAAc,CAAC+D,GAAf,CAAmBC,CAAC,IAAGA,CAAC,CAAC,CAAD,CAAxB,CAAT;AACA,UAAIsB,IAAI,GAAG/B,IAAI,CAACE,GAAL,CAAS,GAAG2B,EAAZ,CAAX;AACA,UAAIG,IAAI,GAAGhC,IAAI,CAACE,GAAL,CAAS,GAAG4B,EAAZ,CAAX;AAEA,UAAIG,WAAW,GAAG,EAAlB;AACAxF,MAAAA,cAAc,CAACqE,OAAf,CAAuBL,CAAC,IAAE;AACxBwB,QAAAA,WAAW,CAACN,IAAZ,CAAiBlB,CAAC,CAAC,CAAD,CAAD,GAAKsB,IAAtB;AACAE,QAAAA,WAAW,CAACN,IAAZ,CAAiBlB,CAAC,CAAC,CAAD,CAAD,GAAKuB,IAAtB;AACD,OAHD;AAKA,UAAIE,CAAC,GAAGC,WAAW,CAAC1F,cAAD,CAAX,GAA4BH,WAApC;AACA,UAAI8F,CAAC,GAAGC,aAAa,CAACH,CAAD,CAArB;AACApE,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBmE,CAAvB;AACApE,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBsE,aAAa,CAACH,CAAD,CAAtC;AAEAxF,MAAAA,QAAQ,CAAC4E,GAAT,CAAac,CAAC,CAAC,CAAD,CAAd,EAAkBA,CAAC,CAAC,CAAD,CAAnB;AAGA,UAAIE,QAAQ,GAAG,IAAI7H,IAAI,CAACkD,QAAT,EAAf;AACA2E,MAAAA,QAAQ,CAACC,SAAT,CAAmB,QAAnB;AACAD,MAAAA,QAAQ,CAACrE,SAAT,CAAmB,CAAnB,EAAqB,QAArB;AACAqE,MAAAA,QAAQ,CAACE,WAAT,CAAqBP,WAArB;AACAK,MAAAA,QAAQ,CAACG,OAAT;AAEA,UAAIC,CAAC,GAAG,IAAIrH,SAAJ,EAAR;AACAqH,MAAAA,CAAC,CAACC,OAAF,GAAY,IAAIlI,IAAI,CAACmI,OAAT,CAAiBX,WAAjB,CAAZ;AACA,UAAIY,CAAC,GAAGpH,GAAG,CAACqH,QAAJ,CAAaC,eAAb,CAA6BT,QAA7B,CAAR;AACAI,MAAAA,CAAC,CAAClB,OAAF,GAAYqB,CAAZ;AACAH,MAAAA,CAAC,CAACtF,CAAF,GAAM2E,IAAN;AACAW,MAAAA,CAAC,CAACrF,CAAF,GAAM2E,IAAN;AACAvG,MAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmBkF,CAAnB;AACD;;AA/E4B;;AAkF/B,WAASpB,GAAT,CAAaY,CAAb,EAAetD,CAAf,EAAiB;AACf,QAAIoE,EAAE,GAAG3G,UAAU,IAAE6F,CAAC,GAAC,CAAJ,CAAnB;AACA,QAAIe,EAAE,GAAG5G,UAAU,IAAEuC,CAAC,GAAC,CAAJ,CAAnB;AACA,QAAIsE,GAAG,GAAG7G,UAAU,GAAC,EAArB;;AACA,SAAK,IAAIqE,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACwB,CAAf,EAAiBxB,CAAC,EAAlB,EAAqB;AACnB,WAAK,IAAIyC,CAAC,GAAC,CAAX,EAAaA,CAAC,GAACjB,CAAf,EAAiBiB,CAAC,EAAlB,EAAqB;AACnB,YAAIhF,CAAC,GAAG,IAAI6C,IAAJ,EAAR;AACAxE,QAAAA,KAAK,CAACmF,IAAN,CAAWxD,CAAX;AACAA,QAAAA,CAAC,CAACf,CAAF,GAAMxB,YAAY,GAAC,CAAb,GAAiBS,UAAU,GAAC,CAA5B,GAAgCqE,CAAC,GAACsC,EAAxC;AACA7E,QAAAA,CAAC,CAACd,CAAF,GAAMrB,aAAa,GAAC,CAAd,GAAkBK,UAAU,GAAC,CAA7B,GAA+B8G,CAAC,GAACF,EAAvC;AACA9E,QAAAA,CAAC,CAACiF,CAAF,GAAMJ,EAAE,GAAC,EAAT;AACA7E,QAAAA,CAAC,CAACpC,MAAF,GAAWmH,GAAX;AACA/E,QAAAA,CAAC,CAACtC,KAAF,GAAUqH,GAAV;AACAzH,QAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmBW,CAAnB;AACD;AACF;AACF;;AAGD,WAASkE,aAAT,CAAuBgB,GAAvB,EAA2B;AACzB,SAAK,IAAI3C,CAAC,GAAC,CAAX,EAAaA,CAAC,GAAC,GAAf,EAAmBA,CAAC,EAApB,EAAuB;AACrB,WAAK,IAAIyC,CAAC,GAAC,CAAX,EAAaA,CAAC,IAAEzC,CAAhB,EAAkByC,CAAC,EAAnB,EAAsB;AACpB,YAAInD,IAAI,CAACsD,GAAL,CAASH,CAAC,GAACzC,CAAF,GAAM2C,GAAf,IAAsB,KAA1B,EAAiC;AAC/B,iBAAO,CAACF,CAAD,EAAGzC,CAAH,CAAP;AACD;AACF;AACF;AACF,GAtRiC,CAwRlC;;;AACA,WAAS6C,MAAT,CAAgBC,QAAhB,EAAyBC,IAAzB,EAA8B;AAC5B;AACAC,IAAAA,kBAAkB,CAACF,QAAD,CAAlB;AACA/H,IAAAA,GAAG,CAACqH,QAAJ,CAAaS,MAAb,CAAoB3H,YAApB,EAAiCI,aAAjC;AACD;;AAGD,WAASmG,WAAT,CAAqB9B,IAArB,EAA2B;AACxB,QAAIsD,IAAI,GAAG,CAAX;AACA,QAAI9B,EAAE,GAAGxB,IAAI,CAACG,GAAL,CAASC,CAAC,IAAGA,CAAC,CAAC,CAAD,CAAd,CAAT;AACA,QAAIqB,EAAE,GAAGzB,IAAI,CAACG,GAAL,CAASC,CAAC,IAAGA,CAAC,CAAC,CAAD,CAAd,CAAT,CAHwB,CAKvB;;AACA,QAAItC,CAAC,GAAGkC,IAAI,CAACC,MAAb;AACA,QAAI6C,CAAC,GAAGhF,CAAC,GAAG,CAAZ;;AACA,SAAK,IAAIuC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvC,CAApB,EAAuBuC,CAAC,EAAxB,EAA4B;AACxBiD,MAAAA,IAAI,GAAGA,IAAI,GAAG,CAAC9B,EAAE,CAACsB,CAAD,CAAF,GAAQtB,EAAE,CAACnB,CAAD,CAAX,KAAmBoB,EAAE,CAACqB,CAAD,CAAF,GAAQrB,EAAE,CAACpB,CAAD,CAA7B,CAAd;AACAyC,MAAAA,CAAC,GAAGzC,CAAJ,CAFwB,CAEhB;AACX,KAXsB,CAavB;;;AACA,WAAOV,IAAI,CAACsD,GAAL,CAASK,IAAI,GAAG,CAAhB,CAAP;AACH;;AAED,WAASD,kBAAT,CAA4BF,QAA5B,EAAqC;AACnC,QAAII,KAAJ;;AACA,QAAIJ,QAAJ,EAAa;AACXI,MAAAA,KAAK,GAAGJ,QAAR;AACD,KAFD,MAEO;AACLI,MAAAA,KAAK,GAAG;AAAC/H,QAAAA,KAAK,EAAED,YAAR;AAAqBG,QAAAA,MAAM,EAAEC;AAA7B,OAAR;AACD;;AACDJ,IAAAA,YAAY,GAAGgI,KAAK,CAAC/H,KAArB;AACAG,IAAAA,aAAa,GAAG4H,KAAK,CAAC7H,MAAtB;AACAE,IAAAA,SAAS,GAAG2H,KAAK,CAAC7H,MAAN,GAAa6H,KAAK,CAAC/H,KAA/B;AACAK,IAAAA,SAAS,GAAGD,SAAS,GAAG,IAAE,CAA1B;AACAE,IAAAA,WAAW,GAAGD,SAAS,GAAG,IAAE,CAAF,GAAI0H,KAAK,CAAC7H,MAAb,GAAsB6H,KAAK,CAAC/H,KAAnD;AACAO,IAAAA,YAAY,GAAGF,SAAS,GAAG0H,KAAK,CAAC7H,MAAT,GAAkB,IAAE,CAAF,GAAI6H,KAAK,CAAC/H,KAApD;AACD,GA9TiC,CAgUlC;;;AACA,WAASgI,IAAT,GAAe;AACb/F,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,QAAI+F,QAAQ,GAAG,EAAf;;AACA,QAAIpI,KAAK,CAACqI,KAAN,CAAYD,QAAhB,EAAyB;AACvBA,MAAAA,QAAQ,GAAGpI,KAAK,CAACqI,KAAN,CAAYD,QAAvB;AACD;;AAED,QAAIE,UAAU,GAAG,IAAIhH,cAAJ,EAAjB;AAEAsE,IAAAA,GAAG,CAAC,CAAD,EAAG,CAAH,CAAH;AAGA5E,IAAAA,QAAQ,GAAG,IAAItB,QAAJ,CAAa,CAAb,EAAe,CAAf,EAAiB,GAAjB,CAAX;AACAsB,IAAAA,QAAQ,CAACU,CAAT,GAAaf,UAAU,GAAC,EAAxB;AACAK,IAAAA,QAAQ,CAACW,CAAT,GAAahB,UAAU,GAAC,EAAxB;AACAZ,IAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmBd,QAAnB;AAEAH,IAAAA,OAAO,GAAG,IAAImB,OAAJ,EAAV;AACAnB,IAAAA,OAAO,CAAC0B,SAAR,CAAkB,CAAlB,EAAoB,QAApB;AACA1B,IAAAA,OAAO,CAACa,CAAR,GAAY,CAAZ;AACAb,IAAAA,OAAO,CAACc,CAAR,GAAY,CAAZ;AACA5B,IAAAA,GAAG,CAAC8B,KAAJ,CAAUC,QAAV,CAAmBjB,OAAnB;AAEA,QAAI+B,EAAE,GAAG,IAAImB,IAAJ,CAAS,CAAC,CAAD,EAAG,CAAH,CAAT,EAAe,CAAC,GAAD,EAAK,GAAL,CAAf,CAAT;AACA,QAAIlB,EAAE,GAAG,IAAIkB,IAAJ,CAAS,CAAC,CAAD,EAAG,GAAH,CAAT,EAAiB,CAAC,GAAD,EAAK,CAAL,CAAjB,CAAT;AAGAlD,IAAAA,OAAO,CAAC6B,MAAR,CAAe,GAAf,EAAmB,GAAnB;AACA7B,IAAAA,OAAO,CAAC2B,MAAR,CAAe,CAAf,EAAiB,GAAjB;AACA3B,IAAAA,OAAO,CAAC6B,MAAR,CAAe,GAAf,EAAmB,CAAnB;AAED,GAhWiC,CAkWlC;;;AACAyF,EAAAA,IAAI,GAnW8B,CAoWlC;;AACApI,EAAAA,GAAG,CAAC8H,MAAJ,GAAcK,KAAD,IAAWL,MAAM,CAACK,KAAD,CAA9B;;AACAnI,EAAAA,GAAG,CAACwI,SAAJ,GAAgB,IAAhB;AACD,CAvWM","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport blueGradient from \"../assets/blue-gradient.png\";\nimport * as CONST from \"./const.js\";\nimport QuestionMark from '../assets/QuestionMark.png'\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport {Fraction, Draggable} from \"./api.js\"\nimport { isObject } from \"util\";\nconst ASSETS = CONST.ASSETS\n\n\nexport const init = (app, setup) => {\n\n  // Layout Parameters\n  const LINE_PERCENTAGE = 0.8\n  let WINDOW_WIDTH = setup.width\n  let BAR_HEIGHT = setup.height/15\n  let WINDOW_HEIGHT = setup.height\n  let H_W_RATIO = setup.height/setup.width\n  let LANDSCAPE = H_W_RATIO < 3/4\n  let ARENA_WIDTH = LANDSCAPE ? 4/3*setup.height : setup.width\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3/4*setup.width\n  let SQUARE_DIM = ARENA_HEIGHT*0.6\n  let SQUARE_AREA = SQUARE_DIM*SQUARE_DIM\n  \n  let stencil;\n  let Nodes = []\n  let CurrentPolygon = []\n  let fraction;\n\n    // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.GLASS_CIRCLE)\n  const DOT_TEXTURE = new PIXI.Texture.from(ASSETS.GLASS_CIRCLE)\n\n  function makeBackground(){\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH\n    this.sprite.height = WINDOW_HEIGHT\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.interactive = true\n\n    app.stage.addChild(this.sprite)\n\n    this.draw = () => {\n        this.sprite.width = WINDOW_WIDTH\n        this.sprite.height = WINDOW_HEIGHT\n    }\n  }\n\n  class Stencil extends PIXI.Graphics {\n    constructor(){\n      super()\n    }\n\n    draw(nodes){\n      console.log(\"draw called\")\n\n      console.log(\"nodes\",nodes)\n      this.clear()\n      this.lineStyle(4,0xff3b55)\n      this.moveTo(nodes[0][0],nodes[0][1])\n      for (let n of nodes){\n        let x = n[0]\n        let y = n[1]\n        this.lineTo(x,y)\n      }\n    }\n  }\n\n  function linesIntersect(l1,l2){\n    let m1 = l1.m\n    let m2 = l2.m \n    let b1 = l1.b\n    let b2 = l2.b\n\n    let xIntersect = (m1 - m2)/(b2-b1)\n    let yIntersect = l1.yOf(xIntersect)\n    \n    let inYRange1 = (yIntersect > l1.yMin) && (yIntersect < l1.yMax)\n    let inXRange1 = (xIntersect > l1.xMin) && (yIntersect < l1.xMax)\n    let inYRange2 = (yIntersect > l2.yMin) && (yIntersect < l2.yMax)\n    let inXRange2 = (xIntersect > l2.xMin) && (xIntersect < l2.xMax)\n    \n    return (inXRange1 && inXRange2 && inYRange1 && inYRange2)\n  }\n\n\n\n  /*\n  function intersects(lineOnePointPair,lineTwoPointPair){\n    let x11 = lineOnePointPair[0][0]\n    let y11 = lineOnePointPair[0][1]\n    let x21 = lineOnePointPair[1][0]\n    let y21 = lineOnePointPair[1][1]\n    let x12 = lineTwoPointPair[0][0]\n    let y12 = lineTwoPointPair[0][1]\n    let x22 = lineTwoPointPair[1][0]\n    let y22 = lineTwoPointPair[1][1]\n\n    let yMax1 = Math.max(y11,y21)\n    let yMin1 = Math.min(y11,y21)\n    let xMax1 = Math.max(x11,x21)\n    let xMin1 = Math.min(x11,x21)\n\n    let yMax2 = Math.max(y12,y22)\n    let yMin2 = Math.min(y12,y22)\n    let xMax2 = Math.max(x12,x22)\n    let xMin2 = Math.min(x12,x22)\n\n\n    let m1 = (y21 - y11)/(x21-x11)\n    let m2 = (y22 - y12)/(x22-x12)\n    let b1 = y11 - m1*x11\n    let b2 = y12 - m2*x12\n    \n    const y1 = x=>m1*x+b1\n    const y2 = x=>m2*x+b2\n\n    let xIntersect = (m1 - m2)/(b2-b1)\n    let yIntersect = y1(xIntersect)\n    \n    let inYRange1 = (yIntersect > yMin1) && (yIntersect < yMax1)\n    let inXRange1 = (xIntersect > xMin1) && (yIntersect < xMax1)\n    let inYRange2 = (yIntersect > yMin2) && (yIntersect < yMax2)\n    let inXRange2 = (xIntersect > xMin2) && (xIntersect < xMax2)\n    \n    return (inXRange1 && inXRange2 && inYRange1 && inYRange2)\n\n  }\n  */\n\n  class Line {\n    constructor(p1,p2){\n      this.x1  = p1[0]\n      this.y1 = p1[1]\n      this.x2  = p2[0]\n      this.y2 = p2[1]\n  \n      this.yMax = Math.max(this.y1,this.y2)\n      this.yMin = Math.min(this.y1,this.y2)\n      this.xMax = Math.max(this.x1,this.x2)\n      this.xMin = Math.min(this.x1,this.x2)\n\n      this.p1 = p1\n      this.p2 = p2\n\n      this.m = (this.y2-this.y1)/(this.x2-this.x1)\n      this.b = this.y1 - this.m*this.x1\n    }\n\n    yOf(x){\n      return this.m*x+this.b\n    }\n\n    xOf(y){\n      return (y-this.b)/this.m\n    }\n\n  }\n\n  function polyToLines(poly){\n      let n = poly.length\n      let lines = poly.map((p,i)=>{\n        return  new Line(p,poly[(i+1)%n])\n      })\n  }\n\n  function doesNewLineCrossCurrentLines(lines,newLine){\n    let contains = false\n    lines.forEach(l => {\n      if (linesIntersect(l,newLine)){\n        return true\n      }\n    })\n    return contains\n  }\n\n\n  class Node extends PIXI.Sprite {\n    constructor(){\n      super()\n      this.on('pointerdown',this.pointerDown)\n      this.on('pointerup',this.pointerUp)\n      this.on('pointerupoutside',this.pointerUpOutside)\n      this.anchor.set(0.5)\n      this.activated = false\n      this.interactive = true\n      this.texture = DOT_TEXTURE\n    }\n\n    pointerDown(){\n      if (this.first){\n        this.first = false\n        stencil.clear()\n        this.generatePolygon()\n      } else {\n        if (CurrentPolygon.length == 0){\n          this.first = true\n        }\n        CurrentPolygon.push([this.x,this.y])\n        this.activated = true\n        this.scale.x = this.scale.x*1.2\n        this.scale.y = this.scale.y*1.2\n        stencil.draw(CurrentPolygon)\n        app.stage.addChild(this)\n      }\n    }\n\n    pointerUpOutside(){\n\n    }\n\n    pointerUp(){\n      \n    }\n\n    generatePolygon(){\n      Nodes.forEach(n=>{\n        if (n.activated){\n          n.scale.x = n.scale.x/1.2\n          n.scale.y = n.scale.y/1.2\n          n.activated = false\n        }\n      })\n\n      let xS = CurrentPolygon.map(p=> p[0])\n      let yS = CurrentPolygon.map(p=> p[1])\n      let minX = Math.min(...xS)\n      let minY = Math.min(...yS)\n\n      let flatPolygon = []\n      CurrentPolygon.forEach(p=>{\n        flatPolygon.push(p[0]-minX)\n        flatPolygon.push(p[1]-minY)\n      })\n\n      let a = polygonArea(CurrentPolygon)/SQUARE_AREA\n      let f = decimalToFrac(a)\n      console.log(\"polyarea\",a)\n      console.log(\"areatofrac\",decimalToFrac(a))\n\n      fraction.set(f[0],f[1])\n      \n\n      var graphics = new PIXI.Graphics();\n      graphics.beginFill(0xff3b55);\n      graphics.lineStyle(2,0xffffff)\n      graphics.drawPolygon(flatPolygon);\n      graphics.endFill();\n\n      let d = new Draggable()\n      d.hitArea = new PIXI.Polygon(flatPolygon)\n      let t = app.renderer.generateTexture(graphics)\n      d.texture = t\n      d.x = minX\n      d.y = minY\n      app.stage.addChild(d)   \n    }\n  }\n\n  function set(a,b){\n    let dx = SQUARE_DIM/(a-1)\n    let dy = SQUARE_DIM/(b-1)\n    let dim = SQUARE_DIM/15\n    for (let i=0;i<a;i++){\n      for (let j=0;j<a;j++){\n        let n = new Node()\n        Nodes.push(n)\n        n.x = WINDOW_WIDTH/2 - SQUARE_DIM/2 + i*dx \n        n.y = WINDOW_HEIGHT/2 - SQUARE_DIM/2+j*dy\n        n.w = dx/10\n        n.height = dim\n        n.width = dim\n        app.stage.addChild(n)\n      }\n    }\n  }\n\n\n  function decimalToFrac(dec){\n    for (let i=1;i<100;i++){\n      for (let j=0;j<=i;j++){\n        if (Math.abs(j/i - dec) < 0.001) {\n          return [j,i]\n        }\n      }\n    }\n  }\n\n  // Called on resize\n  function resize(newFrame,flex){\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame)\n    app.renderer.resize(WINDOW_WIDTH,WINDOW_HEIGHT)\n  }\n\n\n  function polygonArea(poly) {\n     let area = 0\n     let xS = poly.map(p=> p[0])\n     let yS = poly.map(p=> p[1])\n \n      // Calculate value of shoelace formula \n      let n = poly.length\n      let j = n - 1 \n      for (let i = 0; i < n; i++) { \n          area = area + (xS[j] + xS[i]) * (yS[j] - yS[i]);\n          j = i;  // j is previous vertex to i \n      } \n    \n      // Return absolute value \n      return Math.abs(area / 2)\n  } \n\n  function updateLayoutParams(newFrame){\n    let frame;\n    if (newFrame){\n      frame = newFrame\n    } else {\n      frame = {width: WINDOW_WIDTH,height: WINDOW_HEIGHT}\n    }\n    WINDOW_WIDTH = frame.width\n    WINDOW_HEIGHT = frame.height\n    H_W_RATIO = frame.height/frame.width\n    LANDSCAPE = H_W_RATIO < 3/4\n    ARENA_WIDTH = LANDSCAPE ? 4/3*frame.height : frame.width\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3/4*frame.width\n  }\n\n  // Loading Script\n  function load(){\n    console.log('load called')\n    let features = {}\n    if (setup.props.features){\n      features = setup.props.features\n    }\n\n    let backGround = new makeBackground()\n\n    set(4,4)\n\n\n    fraction = new Fraction(0,1,100)\n    fraction.x = SQUARE_DIM/10\n    fraction.y = SQUARE_DIM/10\n    app.stage.addChild(fraction)\n\n    stencil = new Stencil()\n    stencil.lineStyle(4,0xff3b55)\n    stencil.x = 0 \n    stencil.y = 0\n    app.stage.addChild(stencil)\n\n    let l1 = new Line([0,0],[100,100])\n    let l2 = new Line([0,100],[100,0])\n    \n\n    stencil.lineTo(100,100)\n    stencil.moveTo(0,100)\n    stencil.lineTo(100,0)\n\n  }\n\n  // Call load script\n  load()\n  // Not sure where else to put this.\n  app.resize = (frame) => resize(frame)\n  app.resizable = true\n};\n"]},"metadata":{},"sourceType":"module"}