{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nconst createjs = window.createjs;\nexport const init = (app, setup) => {\n  const WINDOW_HEIGHT = setup.height;\n  const WINDOW_WIDTH = setup.width;\n  const DIM = WINDOW_WIDTH / 12;\n  const JIJI_CONT_LEFT = 3 * DIM;\n  const JIJI_CONT_TOP = DIM;\n  const WINDOW_CENTER_X = WINDOW_WIDTH / 2;\n  const WINDOW_CENTER_Y = WINDOW_HEIGHT / 2;\n  const CONTAINER_WIDTH = DIM;\n  const CONTAINER_HEIGHT = DIM;\n  const CONTAINER_CENTER_X = DIM;\n  const CONTAINER_CENTER_Y = 2.5 * DIM;\n  const CONTAINER_TOP = CONTAINER_CENTER_Y - CONTAINER_WIDTH / 2;\n  const CONTAINER_BOTTOM = CONTAINER_CENTER_Y + CONTAINER_WIDTH / 2;\n  const CONTAINER_LEFT = CONTAINER_CENTER_X - CONTAINER_WIDTH / 2;\n  const CONTAINER_RIGHT = CONTAINER_CENTER_X + CONTAINER_WIDTH / 2;\n  let backGround = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n  backGround.width = WINDOW_WIDTH;\n  backGround.height = WINDOW_HEIGHT;\n  backGround.x = 0;\n  backGround.y = 0;\n  backGround.alpha = 0;\n  app.stage.addChild(backGround);\n  createjs.Tween.get(backGround).to({\n    alpha: 1\n  }, 500, createjs.Ease.getPowInOut(4));\n  let constructorBlock;\n  let jijis = [];\n  let plusJiji;\n  let minusJiji;\n  let jijiDIM;\n  let cuttingTool;\n  let deleteTool;\n  let resetTool;\n  let blocks = [];\n  let jijiIcon;\n  let activeBlock;\n  let cutterContainer = new PIXI.Container();\n  let fractions = [];\n  let horizontalLines = [];\n  let verticalLines = [];\n  let vPartitions = 1;\n  let hPartitions = 1;\n  let colorIndex = 0;\n  let vPlus;\n  let vMinus;\n  let hPlus;\n  let hMinus;\n  let cont;\n  let cutting = false;\n  let blockBeingCut;\n  let cutOperators = []; // ENUM\n\n  const OBJ_TYPE = {\n    BLOCK: 0,\n    CUT: 1,\n    DELETE: 2\n  };\n\n  const jiji_width = () => {\n    return jijis.length < 7 ? DIM : DIM * 7 / jijis.length;\n  };\n\n  const v_part_dim = () => {\n    return CONTAINER_HEIGHT / hPartitions;\n  };\n\n  const h_part_dim = () => {\n    return CONTAINER_WIDTH / vPartitions;\n  };\n\n  const jiji_left = () => {\n    let w = jiji_width();\n    return WINDOW_WIDTH / 2 - 1.2 * w * jijis.length / 2;\n  }; // Init\n  //createMenuButtons()\n  //layoutMenu()\n  //initVerticalLines(1)\n\n\n  constructorBlock = createBlockConstructor();\n  app.stage.addChild(constructorBlock);\n  constructorBlock.x = DIM / 2;\n  constructorBlock.y = DIM / 2;\n  initHorizontalLines(1);\n  animateVerticalLines(0);\n  animateHorizontalLines(1);\n  createBlockConstructor();\n  drawPlusMinusButtons();\n  vPlus = createCircleButton(\"Ok\", 0xffffff);\n  hPlus = createCircleButton(\"+\", 0xffffff);\n  hMinus = createCircleButton(\"-\", 0xffffff);\n  cont = createContainer(CONTAINER_WIDTH);\n  createCutterContainer();\n  cutOperators = [vPlus, hPlus, hMinus];\n  animateOperatorAlpha(0);\n  vPlus.alpha = 0;\n  hPlus.alpha = 0;\n  hMinus.alpha = 0;\n  initJijis(2); // Rouge Init\n\n  resetTool = createReset();\n  resetTool.interactive = true;\n  resetTool.on(\"pointerdown\", reset);\n  app.stage.addChild(resetTool);\n  resetTool.x = WINDOW_WIDTH - DIM / 2;\n  resetTool.y = DIM / 2;\n  deleteTool = createTrashCan();\n  app.stage.addChild(deleteTool);\n  deleteTool.x = DIM;\n  deleteTool.y = 4.5 * DIM;\n  cont.x = CONTAINER_CENTER_X;\n  cont.y = CONTAINER_CENTER_Y;\n  vPlus.y = CONTAINER_TOP - DIM / 4;\n  vPlus.x = CONTAINER_CENTER_X;\n  hPlus.x = CONTAINER_RIGHT + DIM / 4;\n  hPlus.y = CONTAINER_CENTER_Y;\n  hMinus.x = CONTAINER_LEFT - DIM / 4;\n  hMinus.y = CONTAINER_CENTER_Y;\n  hPlus.on(\"pointerdown\", () => animateHorizontalLines(1));\n  hMinus.on(\"pointerdown\", () => animateHorizontalLines(-1));\n  vPlus.on(\"pointerdown\", () => cutBlock(blockBeingCut, hPartitions)); // Factory Functions\n\n  function createReset() {\n    let reset = new PIXI.Sprite.from(CONST.ASSETS.RESET);\n    reset.width = DIM / 2;\n    reset.height = DIM / 2;\n    reset.anchor.set(0.5);\n    return reset;\n  }\n\n  function createTrashCan() {\n    let trashCan = new PIXI.Sprite.from(CONST.ASSETS.TRASH);\n    trashCan.width = DIM / 2;\n    trashCan.height = DIM / 2;\n    trashCan.anchor.set(0.5);\n    return trashCan;\n  }\n\n  function createJijiAsset() {\n    let blockSprite = new PIXI.Sprite.from(CONST.ASSETS.JIJI);\n    let w = jiji_width();\n    blockSprite.width = w;\n    blockSprite.height = w;\n    blockSprite.anchor.set(0.5);\n    return blockSprite;\n  }\n\n  function initJijis(n) {\n    let startX = JIJI_CONT_LEFT;\n\n    for (let i = 0; i < n; i++) {\n      let jiji = createJijiAsset();\n      jijis.push(jiji);\n      app.stage.addChild(jiji);\n      jiji.x = startX + i * jiji.width;\n      jiji.y = JIJI_CONT_TOP;\n    }\n  }\n\n  function incJiji(n) {\n    console.log(\"INCING JIJI\");\n    console.log(\"n\", n);\n\n    if (n == 1) {\n      if (jijis.length < 8) {\n        let jiji = createJijiAsset();\n        jiji.alpha = 0;\n        jiji.y = DIM;\n        jiji.x = WINDOW_WIDTH / 2;\n        createjs.Tween.get(jiji).to({\n          alpha: 1\n        }, 1000, createjs.Ease.getPowInOut(4));\n        jijis.push(jiji);\n        app.stage.addChild(jiji);\n      }\n    } else if (n == -1) {\n      if (jijis.length > 2) {\n        let toRemove = jijis.pop();\n        createjs.Tween.get(toRemove).to({\n          alpha: 0\n        }, 1000, createjs.Ease.getPowInOut(4)).call(() => {\n          app.stage.removeChild(toRemove);\n        });\n      }\n    }\n\n    layoutJijis();\n  }\n\n  function layoutJijis() {\n    console.log(\"hello!!!\");\n    console.log(\"jiji's length\", jijis.length);\n    let w = jiji_width();\n    let left = WINDOW_WIDTH / 2 - 1.2 * w * jijis.length / 2;\n    console.log(\"left\");\n    jijis.forEach((e, i) => {\n      createjs.Tween.get(e).to({\n        x: left + 1.2 * w * i + w / 2\n      }, 1000, createjs.Ease.getPowInOut(4));\n      createjs.Tween.get(e).to({\n        width: w,\n        height: w\n      }, 1000, createjs.Ease.getPowInOut(4));\n    });\n  }\n\n  function newJiji() {\n    let newJiji = createJijiAsset();\n    app.stage.addChild(newJiji);\n    jijis.push(newJiji);\n  }\n\n  function reset() {\n    for (let b of blocks) {\n      app.stage.removeChild(b);\n    }\n\n    for (let f of fractions) {\n      app.stage.removeChild(f);\n    }\n\n    blocks = [];\n    fractions = [];\n  }\n\n  function nearestJiji(xVal) {\n    let delta = 100000;\n    let nearestX;\n    console.log(\"xVal\", xVal);\n    jijis.forEach(e => {\n      console.log(\"e.x,nearestX\", e.x);\n\n      if (Math.abs(e.x - xVal) < delta) {\n        console.log(\"nearest x!!!!\");\n        delta = Math.abs(e.x - xVal);\n        nearestX = e.x;\n      }\n    });\n    return nearestX;\n  } //\n\n\n  function drawPlusMinusButtons() {\n    plusJiji = createCircleButton(\"+\", 0xffffff);\n    minusJiji = createCircleButton(\"-\", 0xffffff);\n    jijiIcon = createJijiAsset();\n    jijiIcon.width = DIM / 3;\n    jijiIcon.height = DIM / 3;\n    plusJiji.interactive = true;\n    minusJiji.interactive = true;\n    plusJiji.on(\"pointerdown\", () => {\n      incJiji(1);\n    });\n    minusJiji.on(\"pointerdown\", () => {\n      incJiji(-1);\n    });\n    app.stage.addChild(plusJiji);\n    app.stage.addChild(minusJiji);\n    app.stage.addChild(jijiIcon);\n    plusJiji.x = 3 * DIM / 2;\n    plusJiji.y = 3.5 * DIM;\n    jijiIcon.y = 3.5 * DIM;\n    jijiIcon.x = DIM;\n    minusJiji.x = DIM / 2;\n    minusJiji.y = 3.5 * DIM;\n  }\n\n  function createCutterContainer() {\n    cutterContainer.interactive = true;\n    cutterContainer.TYPE = OBJ_TYPE.CUT;\n\n    for (let l of horizontalLines) {\n      console.log(\"adding child\");\n      cutterContainer.addChild(l);\n      console.log(l.y);\n    }\n\n    hPlus.alpha = 0;\n    vPlus.alpha = 0;\n    hMinus.alpha = 0;\n    cutterContainer.addChild(hPlus);\n    cutterContainer.addChild(vPlus);\n    cutterContainer.addChild(hMinus);\n    cutterContainer.addChild(cont);\n    cutterContainer.on(\"pointerdown\", onPolyTouched);\n    cutterContainer.on(\"pointerup\", onPolyMoveEnd);\n    cutterContainer.on(\"pointermove\", onPolyTouchMoved);\n    cutterContainer.x = CONTAINER_LEFT;\n    cutterContainer.y = CONTAINER_TOP;\n    cutterContainer.pivot.x = cutterContainer.x;\n    cutterContainer.pivot.y = cutterContainer.y;\n    cutterContainer.start = [cutterContainer.x, cutterContainer.y];\n    app.stage.addChild(cutterContainer);\n    return cutterContainer;\n  }\n\n  function cutBlock(block, pieces) {\n    let h = block.height / pieces;\n    let w = block.width;\n    console.log(\"w,y,x,y\", h, w, block.x, block.y);\n\n    for (let i = 0; i < pieces; i++) {\n      let newBlock = createBlock(w, h);\n      newBlock.isFrac = true;\n      newBlock.type = OBJ_TYPE.BLOCK;\n      newBlock.x = block.x;\n      newBlock.y = block.y - block.height / 2 + h / 2 + h * i;\n      newBlock.on(\"pointerdown\", onPolyTouched);\n      newBlock.on(\"pointerup\", onPolyMoveEnd);\n      newBlock.on(\"pointermove\", onPolyTouchMoved);\n      fractions.push(newBlock);\n      app.stage.addChild(newBlock);\n    }\n\n    let i = blocks.indexOf(block);\n    blocks.splice(i, 1);\n    app.stage.removeChild(block);\n    animateOperatorAlpha(0);\n    hPartitions = 2;\n    animateHorizontalLines(0);\n    createjs.Tween.get(cutterContainer).to({\n      x: cutterContainer.start[0],\n      y: cutterContainer.start[1]\n    }, 500, createjs.Ease.getPowInOut(4)).call(() => {\n      cutting = false;\n    });\n  } // Helpers\n\n\n  function bringLinesToFront() {\n    let lines = [...verticalLines, ...horizontalLines]; //lines.forEach(l =>  app.stage.addChild(l))\n  } // Constructors\n\n\n  function createTextBox(text) {\n    let h = DIM / 4;\n    let w = DIM / 4;\n    var circle = new PIXI.Graphics();\n    circle.drawRoundedRect(0, 0, 4 * h, h, 1);\n    circle.endFill();\n    let circleTexture = app.renderer.generateTexture(circle);\n    let circleSprite = new PIXI.Sprite(circleTexture);\n    circleSprite.alpha = 0.5;\n    circleSprite.anchor.set(0.5);\n    let pinContainer = new PIXI.Container();\n    pinContainer.addChild(circleSprite);\n    let operator = new PIXI.Text(text, {\n      fontFamily: \"Chalkboard SE\",\n      fontSize: DIM / 2,\n      fill: 0x000000,\n      align: \"center\"\n    });\n    operator.anchor.set(0.5);\n    operator.x = 0;\n    operator.y = 0;\n    pinContainer.addChild(operator);\n    pinContainer.interactive = true;\n    return pinContainer;\n  }\n\n  function createCircleButton(text, color) {\n    let h = DIM / 4;\n    let w = DIM / 4;\n    var circle = new PIXI.Graphics();\n    circle.beginFill(color);\n    circle.drawCircle(DIM / 5, DIM / 5, DIM / 5);\n    circle.endFill();\n    let circleTexture = app.renderer.generateTexture(circle);\n    let circleSprite = new PIXI.Sprite(circleTexture);\n    circleSprite.alpha = 0.5;\n    circleSprite.anchor.set(0.5);\n    let pinContainer = new PIXI.Container();\n    pinContainer.addChild(circleSprite);\n    let operator = new PIXI.Text(text, {\n      fontFamily: \"Chalkboard SE\",\n      fontSize: DIM / 4,\n      fill: 0x000000,\n      align: \"center\"\n    });\n    operator.anchor.set(0.5);\n    operator.x = 0;\n    operator.y = 0;\n    pinContainer.addChild(operator);\n    pinContainer.interactive = true;\n    return pinContainer;\n  }\n\n  function createContainer(width) {\n    let containerGraphic = new PIXI.Graphics();\n    containerGraphic.lineStyle(2, 0x000000);\n    containerGraphic.moveTo(0, 0);\n    containerGraphic.lineTo(0, width);\n    containerGraphic.lineTo(width, width);\n    containerGraphic.lineTo(width, 0);\n    containerGraphic.lineTo(0, 0);\n    containerGraphic.interactive = true;\n    containerGraphic.x = 1;\n    containerGraphic.y = 1;\n    let containerTexture = app.renderer.generateTexture(containerGraphic);\n    let containerSprite = new PIXI.Sprite(containerTexture);\n    containerSprite.anchor.set(0.5);\n    containerSprite.width = containerGraphic.width;\n    containerSprite.height = containerGraphic.height;\n    return containerSprite;\n  }\n\n  function initVerticalLines(partition) {\n    for (let i = 0; i < 11; i++) {\n      let g = new PIXI.Graphics();\n      g.lineStyle(2, 0x000000);\n      g.lineTo(0, CONTAINER_WIDTH);\n      g.y = CONTAINER_TOP;\n      g.x = CONTAINER_LEFT;\n      verticalLines.push(g);\n      app.stage.addChild(g);\n    }\n  }\n\n  function initHorizontalLines(partition) {\n    for (let i = 0; i < 11; i++) {\n      let g = new PIXI.Graphics();\n      g.lineStyle(2, 0x000000);\n      g.lineTo(CONTAINER_WIDTH, 0);\n      g.y = CONTAINER_BOTTOM;\n      g.x = CONTAINER_LEFT;\n      horizontalLines.push(g);\n    }\n  }\n\n  function animateVerticalLines(inc) {\n    console.log(\"animating verticalLines\");\n    vPartitions += inc;\n\n    if (vPartitions != 0 && vPartitions != 11) {\n      colorIndex += 1;\n      console.log(\"color Index\", colorIndex);\n      let spacing = CONTAINER_WIDTH / vPartitions;\n      verticalLines.forEach((l, i) => {\n        app.stage.addChild(l);\n\n        if (i > vPartitions) {\n          createjs.Tween.get(l).to({\n            x: CONTAINER_RIGHT\n          }, 500, createjs.Ease.getPowInOut(4));\n        } else {\n          createjs.Tween.get(l).to({\n            x: i * spacing + CONTAINER_LEFT\n          }, 500, createjs.Ease.getPowInOut(4));\n        }\n      });\n    } else {\n      vPartitions -= inc;\n    }\n  }\n\n  function animateHorizontalLines(inc) {\n    hPartitions += inc;\n\n    if (hPartitions != 0 && hPartitions != 11) {\n      colorIndex += 1;\n      let spacing = CONTAINER_WIDTH / hPartitions;\n      horizontalLines.forEach((l, i) => {\n        if (i > hPartitions) {\n          console.log(\"containerbottom\", CONTAINER_BOTTOM);\n          console.log(\"cutterContainerxy\", cutterContainer.x, cutterContainer.y);\n          createjs.Tween.get(l).to({\n            y: CONTAINER_BOTTOM\n          }, 500, createjs.Ease.getPowInOut(4));\n        } else {\n          createjs.Tween.get(l).to({\n            y: i * spacing + CONTAINER_TOP\n          }, 500, createjs.Ease.getPowInOut(4));\n        }\n      });\n    } else {\n      hPartitions -= inc;\n    }\n  }\n\n  function onFracStart(event) {\n    bringLinesToFront();\n    let touchedAtX = event.data.global.x;\n    let touchedAtY = event.data.global.y;\n    this.deltaTouch = [this.x - touchedAtX, this.y - touchedAtY];\n    app.stage.addChild(this);\n    this.data = event.data;\n    this.dragging = true;\n  } // Pass it the level and it will layout the buttons for that new level.\n\n\n  function createBlockConstructor() {\n    var graphics = new PIXI.Graphics();\n    graphics.beginFill(CONST.COLORS.BLUE);\n    graphics.drawRoundedRect(0, 0, DIM, DIM, 2);\n    graphics.endFill();\n    graphics.color = CONST.COLORS.BLUE; //graphics.alpha = 0.8\n\n    graphics.interactive = true;\n    console.log(\"graphics dims\", graphics.width, graphics.height);\n    graphics.on(\"pointerdown\", () => {\n      newBlock(graphics.width, graphics.height, constructorBlock.x + constructorBlock.width / 2, constructorBlock.y + constructorBlock.height / 2);\n    });\n    return graphics;\n  }\n\n  function newBlock(w, h, x, y) {\n    let newBlock = createBlock(w, h);\n    app.stage.addChild(newBlock);\n    newBlock.x = x;\n    newBlock.y = y;\n    createjs.Tween.get(newBlock).to({\n      x: WINDOW_CENTER_X + blocks.length * 10,\n      y: CONTAINER_CENTER_Y + blocks.length * 10\n    }, 1000, createjs.Ease.getPowInOut(4)).call(() => {\n      newBlock.on(\"pointerdown\", onPolyTouched);\n      newBlock.on(\"pointerup\", onPolyMoveEnd);\n      newBlock.on(\"pointermove\", onPolyTouchMoved);\n    });\n    blocks.push(newBlock);\n  }\n\n  function createBlock(w, h) {\n    let graphics = new PIXI.Graphics();\n    graphics.lineStyle(1, 0xffffff);\n    graphics.beginFill(CONST.COLORS.BLUE);\n    graphics.drawRoundedRect(0, 0, w, h, 3);\n    graphics.endFill();\n    graphics.x = 0.5;\n    graphics.y = 0.5;\n    graphics.alpha = 0.8;\n    let texture = app.renderer.generateTexture(graphics);\n    let sprite = new PIXI.Sprite(texture);\n    sprite.anchor.set(0.5);\n    sprite.interactive = true;\n    sprite.TYPE = OBJ_TYPE.BLOCK;\n    return sprite;\n  }\n\n  function animateOperatorAlpha(a) {\n    for (let o of cutOperators) {\n      if (a == 0) {\n        o.interactive = false;\n      } else {\n        o.interactive = true;\n      }\n\n      createjs.Tween.get(o).to({\n        alpha: a\n      }, 500, createjs.Ease.getPowInOut(4));\n    }\n  }\n\n  function onPolyTouched(event) {\n    if (this.TYPE == OBJ_TYPE.CUT) {\n      cutting = true;\n    }\n\n    let touchedAtX = event.data.global.x;\n    let touchedAtY = event.data.global.y;\n    app.stage.addChild(this);\n    this.dragging = true;\n    this.wasDragged = false;\n    this.deltaTouch = [this.x - touchedAtX, this.y - touchedAtY];\n    this.dragStartedAt = this.y;\n    this.data = event.data;\n  }\n\n  function onPolyMoveEnd() {\n    this.dragging = false;\n    this.data = null;\n    this.deltaTouch = [];\n\n    switch (this.TYPE) {\n      case OBJ_TYPE.DELETE:\n        createjs.Tween.get(this).to({\n          x: this.start[0],\n          y: this.start[1]\n        }, 500, createjs.Ease.getPowInOut(4));\n        console.log(\"blocks\", blocks);\n        let blocksInThis = blocks.filter(e => {\n          console.log(\"c.center?\", e.center);\n          let p = new PIXI.Point(this.x, this.y);\n          console.log(\"isitinrect?\", pointInRect(p, e));\n          return pointInRect(p, e);\n        });\n        console.log(\"blocksInthis\", blocksInThis);\n\n      case OBJ_TYPE.CUT:\n        let blocksInCutter = blocks.filter(e => {\n          console.log(\"c.center?\", e.center);\n          let p = new PIXI.Point(this.x + CONTAINER_HEIGHT / 2, this.y + CONTAINER_HEIGHT / 2);\n          console.log(\"isitinrect?\", pointInRect(p, e));\n          return pointInRect(p, e) && !e.isFrac;\n        });\n\n        if (blocksInCutter.length == 0) {\n          animateOperatorAlpha(0);\n          createjs.Tween.get(this).to({\n            x: this.start[0],\n            y: this.start[1]\n          }, 500, createjs.Ease.getPowInOut(4)).call(() => {\n            cutting = false;\n          });\n        } else {\n          blockBeingCut = blocksInCutter[0];\n          animateOperatorAlpha(1);\n          createjs.Tween.get(this).to({\n            x: blocksInCutter[0].x - CONTAINER_WIDTH / 2,\n            y: blocksInCutter[0].y - CONTAINER_HEIGHT / 2\n          }, 500, createjs.Ease.getPowInOut(4));\n        }\n\n      case OBJ_TYPE.BLOCK:\n        if (!cutting) {\n          console.log(\"this is a block\");\n          let testPoint = new PIXI.Point(this.x, this.y);\n          let inDelete = pointInRect(testPoint, deleteTool);\n\n          if (inDelete) {\n            console.log(\"in delete?\");\n            let i = blocks.indexOf(this);\n            blocks.splice(i, 1);\n            app.stage.removeChild(this);\n          } else {\n            let newX = nearestJiji(this.x);\n            console.log(\"newX\", newX);\n            createjs.Tween.get(this).to({\n              x: newX\n            }, 300, createjs.Ease.getPowInOut(4));\n          }\n        }\n\n    }\n  }\n\n  function onPolyTouchMoved() {\n    if (this.dragging) {\n      this.wasDragged = true;\n      var newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch[0];\n      this.y = newPosition.y + this.deltaTouch[1];\n    }\n  } // Helpers\n\n\n  function pointInRect(p, rect) {\n    // This is for a rect with anchor in center\n    let top = rect.y - rect.height / 2;\n    let bottom = rect.y + rect.height / 2;\n    let left = rect.x - rect.width / 2;\n    let right = rect.x + rect.width / 2;\n    let c1 = p.x < right;\n    let c2 = p.x > left;\n    let c3 = p.y < bottom;\n    let c4 = p.y > top;\n    return c1 && c2 && c3 && c4;\n  }\n\n  layoutJijis();\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/sharingtool.js"],"names":["PIXI","CONST","createjs","window","init","app","setup","WINDOW_HEIGHT","height","WINDOW_WIDTH","width","DIM","JIJI_CONT_LEFT","JIJI_CONT_TOP","WINDOW_CENTER_X","WINDOW_CENTER_Y","CONTAINER_WIDTH","CONTAINER_HEIGHT","CONTAINER_CENTER_X","CONTAINER_CENTER_Y","CONTAINER_TOP","CONTAINER_BOTTOM","CONTAINER_LEFT","CONTAINER_RIGHT","backGround","Sprite","from","ASSETS","BLUE_GRADIENT","x","y","alpha","stage","addChild","Tween","get","to","Ease","getPowInOut","constructorBlock","jijis","plusJiji","minusJiji","jijiDIM","cuttingTool","deleteTool","resetTool","blocks","jijiIcon","activeBlock","cutterContainer","Container","fractions","horizontalLines","verticalLines","vPartitions","hPartitions","colorIndex","vPlus","vMinus","hPlus","hMinus","cont","cutting","blockBeingCut","cutOperators","OBJ_TYPE","BLOCK","CUT","DELETE","jiji_width","length","v_part_dim","h_part_dim","jiji_left","w","createBlockConstructor","initHorizontalLines","animateVerticalLines","animateHorizontalLines","drawPlusMinusButtons","createCircleButton","createContainer","createCutterContainer","animateOperatorAlpha","initJijis","createReset","interactive","on","reset","createTrashCan","cutBlock","RESET","anchor","set","trashCan","TRASH","createJijiAsset","blockSprite","JIJI","n","startX","i","jiji","push","incJiji","console","log","toRemove","pop","call","removeChild","layoutJijis","left","forEach","e","newJiji","b","f","nearestJiji","xVal","delta","nearestX","Math","abs","TYPE","l","onPolyTouched","onPolyMoveEnd","onPolyTouchMoved","pivot","start","block","pieces","h","newBlock","createBlock","isFrac","type","indexOf","splice","bringLinesToFront","lines","createTextBox","text","circle","Graphics","drawRoundedRect","endFill","circleTexture","renderer","generateTexture","circleSprite","pinContainer","operator","Text","fontFamily","fontSize","fill","align","color","beginFill","drawCircle","containerGraphic","lineStyle","moveTo","lineTo","containerTexture","containerSprite","initVerticalLines","partition","g","inc","spacing","onFracStart","event","touchedAtX","data","global","touchedAtY","deltaTouch","dragging","graphics","COLORS","BLUE","texture","sprite","a","o","wasDragged","dragStartedAt","blocksInThis","filter","center","p","Point","pointInRect","blocksInCutter","testPoint","inDelete","newX","newPosition","getLocalPosition","parent","rect","top","bottom","right","c1","c2","c3","c4"],"mappings":"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","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nconst createjs = window.createjs\n\n\nexport const init = (app, setup) => {\n\nconst WINDOW_HEIGHT = setup.height\nconst WINDOW_WIDTH = setup.width\nconst DIM = WINDOW_WIDTH / 12;\nconst JIJI_CONT_LEFT = 3 * DIM;\nconst JIJI_CONT_TOP = DIM;\nconst WINDOW_CENTER_X = WINDOW_WIDTH / 2;\nconst WINDOW_CENTER_Y = WINDOW_HEIGHT / 2;\nconst CONTAINER_WIDTH = DIM;\nconst CONTAINER_HEIGHT = DIM;\nconst CONTAINER_CENTER_X = DIM;\nconst CONTAINER_CENTER_Y = 2.5 * DIM;\nconst CONTAINER_TOP = CONTAINER_CENTER_Y - CONTAINER_WIDTH / 2;\nconst CONTAINER_BOTTOM = CONTAINER_CENTER_Y + CONTAINER_WIDTH / 2;\nconst CONTAINER_LEFT = CONTAINER_CENTER_X - CONTAINER_WIDTH / 2;\nconst CONTAINER_RIGHT = CONTAINER_CENTER_X + CONTAINER_WIDTH / 2;\n\nlet backGround = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\nbackGround.width = WINDOW_WIDTH;\nbackGround.height = WINDOW_HEIGHT;\nbackGround.x = 0;\nbackGround.y = 0;\nbackGround.alpha = 0;\napp.stage.addChild(backGround);\ncreatejs.Tween.get(backGround).to(\n  {\n    alpha: 1\n  },\n  500,\n  createjs.Ease.getPowInOut(4)\n);\n\nlet constructorBlock;\nlet jijis = [];\nlet plusJiji;\nlet minusJiji;\nlet jijiDIM;\nlet cuttingTool;\nlet deleteTool;\nlet resetTool;\nlet blocks = [];\nlet jijiIcon;\nlet activeBlock;\nlet cutterContainer = new PIXI.Container();\nlet fractions = [];\nlet horizontalLines = [];\nlet verticalLines = [];\nlet vPartitions = 1;\nlet hPartitions = 1;\nlet colorIndex = 0;\n\nlet vPlus;\nlet vMinus;\nlet hPlus;\nlet hMinus;\nlet cont;\nlet cutting = false;\nlet blockBeingCut;\nlet cutOperators = [];\n\n// ENUM\nconst OBJ_TYPE = {\n  BLOCK: 0,\n  CUT: 1,\n  DELETE: 2\n};\n\nconst jiji_width = () => {\n  return jijis.length < 7 ? DIM : (DIM * 7) / jijis.length;\n};\n\nconst v_part_dim = () => {\n  return CONTAINER_HEIGHT / hPartitions;\n};\n\nconst h_part_dim = () => {\n  return CONTAINER_WIDTH / vPartitions;\n};\n\nconst jiji_left = () => {\n  let w = jiji_width();\n  return WINDOW_WIDTH / 2 - (1.2 * w * jijis.length) / 2;\n};\n\n// Init\n//createMenuButtons()\n//layoutMenu()\n//initVerticalLines(1)\nconstructorBlock = createBlockConstructor();\napp.stage.addChild(constructorBlock);\nconstructorBlock.x = DIM / 2;\nconstructorBlock.y = DIM / 2;\ninitHorizontalLines(1);\nanimateVerticalLines(0);\nanimateHorizontalLines(1);\ncreateBlockConstructor();\ndrawPlusMinusButtons();\nvPlus = createCircleButton(\"Ok\", 0xffffff);\nhPlus = createCircleButton(\"+\", 0xffffff);\nhMinus = createCircleButton(\"-\", 0xffffff);\ncont = createContainer(CONTAINER_WIDTH);\ncreateCutterContainer();\ncutOperators = [vPlus, hPlus, hMinus];\nanimateOperatorAlpha(0);\nvPlus.alpha = 0;\nhPlus.alpha = 0;\nhMinus.alpha = 0;\ninitJijis(2);\n\n// Rouge Init\n\nresetTool = createReset();\nresetTool.interactive = true;\nresetTool.on(\"pointerdown\", reset);\napp.stage.addChild(resetTool);\nresetTool.x = WINDOW_WIDTH - DIM / 2;\nresetTool.y = DIM / 2;\n\ndeleteTool = createTrashCan();\napp.stage.addChild(deleteTool);\ndeleteTool.x = DIM;\ndeleteTool.y = 4.5 * DIM;\n\ncont.x = CONTAINER_CENTER_X;\ncont.y = CONTAINER_CENTER_Y;\n\nvPlus.y = CONTAINER_TOP - DIM / 4;\nvPlus.x = CONTAINER_CENTER_X;\n\nhPlus.x = CONTAINER_RIGHT + DIM / 4;\nhPlus.y = CONTAINER_CENTER_Y;\n\nhMinus.x = CONTAINER_LEFT - DIM / 4;\nhMinus.y = CONTAINER_CENTER_Y;\n\nhPlus.on(\"pointerdown\", () => animateHorizontalLines(1));\nhMinus.on(\"pointerdown\", () => animateHorizontalLines(-1));\nvPlus.on(\"pointerdown\", () => cutBlock(blockBeingCut, hPartitions));\n\n// Factory Functions\n\nfunction createReset() {\n  let reset = new PIXI.Sprite.from(CONST.ASSETS.RESET);\n  reset.width = DIM / 2;\n  reset.height = DIM / 2;\n  reset.anchor.set(0.5);\n  return reset;\n}\n\nfunction createTrashCan() {\n  let trashCan = new PIXI.Sprite.from(CONST.ASSETS.TRASH);\n  trashCan.width = DIM / 2;\n  trashCan.height = DIM / 2;\n  trashCan.anchor.set(0.5);\n  return trashCan;\n}\n\nfunction createJijiAsset() {\n  let blockSprite = new PIXI.Sprite.from(CONST.ASSETS.JIJI);\n  let w = jiji_width();\n  blockSprite.width = w;\n  blockSprite.height = w;\n  blockSprite.anchor.set(0.5);\n  return blockSprite;\n}\n\nfunction initJijis(n) {\n  let startX = JIJI_CONT_LEFT;\n  for (let i = 0; i < n; i++) {\n    let jiji = createJijiAsset();\n    jijis.push(jiji);\n    app.stage.addChild(jiji);\n    jiji.x = startX + i * jiji.width;\n    jiji.y = JIJI_CONT_TOP;\n  }\n}\n\nfunction incJiji(n) {\n  console.log(\"INCING JIJI\");\n  console.log(\"n\", n);\n  if (n == 1) {\n    if (jijis.length < 8) {\n      let jiji = createJijiAsset();\n      jiji.alpha = 0;\n      jiji.y = DIM;\n      jiji.x = WINDOW_WIDTH / 2;\n      createjs.Tween.get(jiji).to(\n        {\n          alpha: 1\n        },\n        1000,\n        createjs.Ease.getPowInOut(4)\n      );\n      jijis.push(jiji);\n      app.stage.addChild(jiji);\n    }\n  } else if (n == -1) {\n    if (jijis.length > 2) {\n      let toRemove = jijis.pop();\n      createjs.Tween.get(toRemove)\n        .to(\n          {\n            alpha: 0\n          },\n          1000,\n          createjs.Ease.getPowInOut(4)\n        )\n        .call(() => {\n          app.stage.removeChild(toRemove);\n        });\n    }\n  }\n  layoutJijis();\n}\n\nfunction layoutJijis() {\n  console.log(\"hello!!!\");\n  console.log(\"jiji's length\", jijis.length);\n  let w = jiji_width();\n  let left = WINDOW_WIDTH / 2 - (1.2 * w * jijis.length) / 2;\n  console.log(\"left\");\n  jijis.forEach((e, i) => {\n    createjs.Tween.get(e).to(\n      {\n        x: left + 1.2 * w * i + w / 2\n      },\n      1000,\n      createjs.Ease.getPowInOut(4)\n    );\n    createjs.Tween.get(e).to(\n      {\n        width: w,\n        height: w\n      },\n      1000,\n      createjs.Ease.getPowInOut(4)\n    );\n  });\n}\n\nfunction newJiji() {\n  let newJiji = createJijiAsset();\n  app.stage.addChild(newJiji);\n  jijis.push(newJiji);\n}\n\nfunction reset() {\n  for (let b of blocks) {\n    app.stage.removeChild(b);\n  }\n  for (let f of fractions) {\n    app.stage.removeChild(f);\n  }\n  blocks = [];\n  fractions = [];\n}\n\nfunction nearestJiji(xVal) {\n  let delta = 100000;\n  let nearestX;\n  console.log(\"xVal\", xVal);\n  jijis.forEach(e => {\n    console.log(\"e.x,nearestX\", e.x);\n    if (Math.abs(e.x - xVal) < delta) {\n      console.log(\"nearest x!!!!\");\n      delta = Math.abs(e.x - xVal);\n      nearestX = e.x;\n    }\n  });\n  return nearestX;\n}\n\n//\nfunction drawPlusMinusButtons() {\n  plusJiji = createCircleButton(\"+\", 0xffffff);\n  minusJiji = createCircleButton(\"-\", 0xffffff);\n  jijiIcon = createJijiAsset();\n  jijiIcon.width = DIM / 3;\n  jijiIcon.height = DIM / 3;\n  plusJiji.interactive = true;\n  minusJiji.interactive = true;\n  plusJiji.on(\"pointerdown\", () => {\n    incJiji(1);\n  });\n  minusJiji.on(\"pointerdown\", () => {\n    incJiji(-1);\n  });\n  app.stage.addChild(plusJiji);\n  app.stage.addChild(minusJiji);\n  app.stage.addChild(jijiIcon);\n  plusJiji.x = (3 * DIM) / 2;\n  plusJiji.y = 3.5 * DIM;\n  jijiIcon.y = 3.5 * DIM;\n  jijiIcon.x = DIM;\n  minusJiji.x = DIM / 2;\n  minusJiji.y = 3.5 * DIM;\n}\n\nfunction createCutterContainer() {\n  cutterContainer.interactive = true;\n  cutterContainer.TYPE = OBJ_TYPE.CUT;\n  for (let l of horizontalLines) {\n    console.log(\"adding child\");\n    cutterContainer.addChild(l);\n    console.log(l.y);\n  }\n  hPlus.alpha = 0;\n  vPlus.alpha = 0;\n  hMinus.alpha = 0;\n  cutterContainer.addChild(hPlus);\n  cutterContainer.addChild(vPlus);\n  cutterContainer.addChild(hMinus);\n  cutterContainer.addChild(cont);\n  cutterContainer.on(\"pointerdown\", onPolyTouched);\n  cutterContainer.on(\"pointerup\", onPolyMoveEnd);\n  cutterContainer.on(\"pointermove\", onPolyTouchMoved);\n  cutterContainer.x = CONTAINER_LEFT;\n  cutterContainer.y = CONTAINER_TOP;\n  cutterContainer.pivot.x = cutterContainer.x;\n  cutterContainer.pivot.y = cutterContainer.y;\n  cutterContainer.start = [cutterContainer.x, cutterContainer.y];\n  app.stage.addChild(cutterContainer);\n  return cutterContainer;\n}\n\nfunction cutBlock(block, pieces) {\n  let h = block.height / pieces;\n  let w = block.width;\n  console.log(\"w,y,x,y\", h, w, block.x, block.y);\n  for (let i = 0; i < pieces; i++) {\n    let newBlock = createBlock(w, h);\n    newBlock.isFrac = true;\n    newBlock.type = OBJ_TYPE.BLOCK;\n    newBlock.x = block.x;\n    newBlock.y = block.y - block.height / 2 + h / 2 + h * i;\n    newBlock.on(\"pointerdown\", onPolyTouched);\n    newBlock.on(\"pointerup\", onPolyMoveEnd);\n    newBlock.on(\"pointermove\", onPolyTouchMoved);\n    fractions.push(newBlock);\n    app.stage.addChild(newBlock);\n  }\n\n  let i = blocks.indexOf(block);\n  blocks.splice(i, 1);\n  app.stage.removeChild(block);\n  animateOperatorAlpha(0);\n  hPartitions = 2;\n  animateHorizontalLines(0);\n  createjs.Tween.get(cutterContainer)\n    .to(\n      {\n        x: cutterContainer.start[0],\n        y: cutterContainer.start[1]\n      },\n      500,\n      createjs.Ease.getPowInOut(4)\n    )\n    .call(() => {\n      cutting = false;\n    });\n}\n\n// Helpers\n\nfunction bringLinesToFront() {\n  let lines = [...verticalLines, ...horizontalLines];\n  //lines.forEach(l =>  app.stage.addChild(l))\n}\n\n// Constructors\n\nfunction createTextBox(text) {\n  let h = DIM / 4;\n  let w = DIM / 4;\n\n  var circle = new PIXI.Graphics();\n  circle.drawRoundedRect(0, 0, 4 * h, h, 1);\n  circle.endFill();\n\n  let circleTexture = app.renderer.generateTexture(circle);\n  let circleSprite = new PIXI.Sprite(circleTexture);\n  circleSprite.alpha = 0.5;\n  circleSprite.anchor.set(0.5);\n\n  let pinContainer = new PIXI.Container();\n  pinContainer.addChild(circleSprite);\n\n  let operator = new PIXI.Text(text, {\n    fontFamily: \"Chalkboard SE\",\n    fontSize: DIM / 2,\n    fill: 0x000000,\n    align: \"center\"\n  });\n  operator.anchor.set(0.5);\n  operator.x = 0;\n  operator.y = 0;\n  pinContainer.addChild(operator);\n  pinContainer.interactive = true;\n\n  return pinContainer;\n}\n\nfunction createCircleButton(text, color) {\n  let h = DIM / 4;\n  let w = DIM / 4;\n\n  var circle = new PIXI.Graphics();\n  circle.beginFill(color);\n  circle.drawCircle(DIM / 5, DIM / 5, DIM / 5);\n  circle.endFill();\n\n  let circleTexture = app.renderer.generateTexture(circle);\n  let circleSprite = new PIXI.Sprite(circleTexture);\n  circleSprite.alpha = 0.5;\n  circleSprite.anchor.set(0.5);\n\n  let pinContainer = new PIXI.Container();\n  pinContainer.addChild(circleSprite);\n\n  let operator = new PIXI.Text(text, {\n    fontFamily: \"Chalkboard SE\",\n    fontSize: DIM / 4,\n    fill: 0x000000,\n    align: \"center\"\n  });\n  operator.anchor.set(0.5);\n  operator.x = 0;\n  operator.y = 0;\n  pinContainer.addChild(operator);\n  pinContainer.interactive = true;\n\n  return pinContainer;\n}\n\nfunction createContainer(width) {\n  let containerGraphic = new PIXI.Graphics();\n  containerGraphic.lineStyle(2, 0x000000);\n  containerGraphic.moveTo(0, 0);\n  containerGraphic.lineTo(0, width);\n  containerGraphic.lineTo(width, width);\n  containerGraphic.lineTo(width, 0);\n  containerGraphic.lineTo(0, 0);\n  containerGraphic.interactive = true;\n  containerGraphic.x = 1;\n  containerGraphic.y = 1;\n\n  let containerTexture = app.renderer.generateTexture(containerGraphic);\n  let containerSprite = new PIXI.Sprite(containerTexture);\n  containerSprite.anchor.set(0.5);\n  containerSprite.width = containerGraphic.width;\n  containerSprite.height = containerGraphic.height;\n  return containerSprite;\n}\n\nfunction initVerticalLines(partition) {\n  for (let i = 0; i < 11; i++) {\n    let g = new PIXI.Graphics();\n    g.lineStyle(2, 0x000000);\n    g.lineTo(0, CONTAINER_WIDTH);\n    g.y = CONTAINER_TOP;\n    g.x = CONTAINER_LEFT;\n    verticalLines.push(g);\n    app.stage.addChild(g);\n  }\n}\n\nfunction initHorizontalLines(partition) {\n  for (let i = 0; i < 11; i++) {\n    let g = new PIXI.Graphics();\n    g.lineStyle(2, 0x000000);\n    g.lineTo(CONTAINER_WIDTH, 0);\n    g.y = CONTAINER_BOTTOM;\n    g.x = CONTAINER_LEFT;\n    horizontalLines.push(g);\n  }\n}\n\nfunction animateVerticalLines(inc) {\n  console.log(\"animating verticalLines\");\n  vPartitions += inc;\n  if (vPartitions != 0 && vPartitions != 11) {\n    colorIndex += 1;\n\n    console.log(\"color Index\", colorIndex);\n\n    let spacing = CONTAINER_WIDTH / vPartitions;\n\n    verticalLines.forEach((l, i) => {\n      app.stage.addChild(l);\n      if (i > vPartitions) {\n        createjs.Tween.get(l).to(\n          {\n            x: CONTAINER_RIGHT\n          },\n          500,\n          createjs.Ease.getPowInOut(4)\n        );\n      } else {\n        createjs.Tween.get(l).to(\n          {\n            x: i * spacing + CONTAINER_LEFT\n          },\n          500,\n          createjs.Ease.getPowInOut(4)\n        );\n      }\n    });\n  } else {\n    vPartitions -= inc;\n  }\n}\n\nfunction animateHorizontalLines(inc) {\n  hPartitions += inc;\n  if (hPartitions != 0 && hPartitions != 11) {\n    colorIndex += 1;\n\n    let spacing = CONTAINER_WIDTH / hPartitions;\n\n    horizontalLines.forEach((l, i) => {\n      if (i > hPartitions) {\n        console.log(\"containerbottom\", CONTAINER_BOTTOM);\n        console.log(\"cutterContainerxy\", cutterContainer.x, cutterContainer.y);\n        createjs.Tween.get(l).to(\n          {\n            y: CONTAINER_BOTTOM\n          },\n          500,\n          createjs.Ease.getPowInOut(4)\n        );\n      } else {\n        createjs.Tween.get(l).to(\n          {\n            y: i * spacing + CONTAINER_TOP\n          },\n          500,\n          createjs.Ease.getPowInOut(4)\n        );\n      }\n    });\n  } else {\n    hPartitions -= inc;\n  }\n}\n\nfunction onFracStart(event) {\n  bringLinesToFront();\n  let touchedAtX = event.data.global.x;\n  let touchedAtY = event.data.global.y;\n  this.deltaTouch = [this.x - touchedAtX, this.y - touchedAtY];\n  app.stage.addChild(this);\n  this.data = event.data;\n  this.dragging = true;\n}\n\n// Pass it the level and it will layout the buttons for that new level.\nfunction createBlockConstructor() {\n  var graphics = new PIXI.Graphics();\n  graphics.beginFill(CONST.COLORS.BLUE);\n  graphics.drawRoundedRect(0, 0, DIM, DIM, 2);\n  graphics.endFill();\n  graphics.color = CONST.COLORS.BLUE;\n  //graphics.alpha = 0.8\n  graphics.interactive = true;\n  console.log(\"graphics dims\", graphics.width, graphics.height);\n  graphics.on(\"pointerdown\", () => {\n    newBlock(\n      graphics.width,\n      graphics.height,\n      constructorBlock.x + constructorBlock.width / 2,\n      constructorBlock.y + constructorBlock.height / 2\n    );\n  });\n  return graphics;\n}\n\nfunction newBlock(w, h, x, y) {\n  let newBlock = createBlock(w, h);\n  app.stage.addChild(newBlock);\n  newBlock.x = x;\n  newBlock.y = y;\n  createjs.Tween.get(newBlock)\n    .to(\n      {\n        x: WINDOW_CENTER_X + blocks.length * 10,\n        y: CONTAINER_CENTER_Y + blocks.length * 10\n      },\n      1000,\n      createjs.Ease.getPowInOut(4)\n    )\n    .call(() => {\n      newBlock.on(\"pointerdown\", onPolyTouched);\n      newBlock.on(\"pointerup\", onPolyMoveEnd);\n      newBlock.on(\"pointermove\", onPolyTouchMoved);\n    });\n  blocks.push(newBlock);\n}\n\nfunction createBlock(w, h) {\n  let graphics = new PIXI.Graphics();\n  graphics.lineStyle(1, 0xffffff);\n  graphics.beginFill(CONST.COLORS.BLUE);\n  graphics.drawRoundedRect(0, 0, w, h, 3);\n  graphics.endFill();\n  graphics.x = 0.5;\n  graphics.y = 0.5;\n  graphics.alpha = 0.8\n  let texture = app.renderer.generateTexture(graphics);\n  let sprite = new PIXI.Sprite(texture);\n  sprite.anchor.set(0.5);\n  sprite.interactive = true;\n  sprite.TYPE = OBJ_TYPE.BLOCK;\n  return sprite;\n}\n\nfunction animateOperatorAlpha(a) {\n  for (let o of cutOperators) {\n    if (a == 0) {\n      o.interactive = false;\n    } else {\n      o.interactive = true;\n    }\n    createjs.Tween.get(o).to(\n      {\n        alpha: a\n      },\n      500,\n      createjs.Ease.getPowInOut(4)\n    );\n  }\n}\n\nfunction onPolyTouched(event) {\n  if (this.TYPE == OBJ_TYPE.CUT) {\n    cutting = true;\n  }\n\n  let touchedAtX = event.data.global.x;\n  let touchedAtY = event.data.global.y;\n\n  app.stage.addChild(this);\n  this.dragging = true;\n  this.wasDragged = false;\n  this.deltaTouch = [this.x - touchedAtX, this.y - touchedAtY];\n  this.dragStartedAt = this.y;\n  this.data = event.data;\n}\n\nfunction onPolyMoveEnd() {\n  this.dragging = false;\n  this.data = null;\n  this.deltaTouch = [];\n\n  switch (this.TYPE) {\n    case OBJ_TYPE.DELETE:\n      createjs.Tween.get(this).to(\n        {\n          x: this.start[0],\n          y: this.start[1]\n        },\n        500,\n        createjs.Ease.getPowInOut(4)\n      );\n      console.log(\"blocks\", blocks);\n      let blocksInThis = blocks.filter(e => {\n        console.log(\"c.center?\", e.center);\n        let p = new PIXI.Point(this.x, this.y);\n        console.log(\"isitinrect?\", pointInRect(p, e));\n        return pointInRect(p, e);\n      });\n      console.log(\"blocksInthis\", blocksInThis);\n    case OBJ_TYPE.CUT:\n      let blocksInCutter = blocks.filter(e => {\n        console.log(\"c.center?\", e.center);\n        let p = new PIXI.Point(\n          this.x + CONTAINER_HEIGHT / 2,\n          this.y + CONTAINER_HEIGHT / 2\n        );\n        console.log(\"isitinrect?\", pointInRect(p, e));\n        return pointInRect(p, e) && !e.isFrac;\n      });\n      if (blocksInCutter.length == 0) {\n        animateOperatorAlpha(0);\n        createjs.Tween.get(this)\n          .to(\n            {\n              x: this.start[0],\n              y: this.start[1]\n            },\n            500,\n            createjs.Ease.getPowInOut(4)\n          )\n          .call(() => {\n            cutting = false;\n          });\n      } else {\n        blockBeingCut = blocksInCutter[0];\n        animateOperatorAlpha(1);\n        createjs.Tween.get(this).to(\n          {\n            x: blocksInCutter[0].x - CONTAINER_WIDTH / 2,\n            y: blocksInCutter[0].y - CONTAINER_HEIGHT / 2\n          },\n          500,\n          createjs.Ease.getPowInOut(4)\n        );\n      }\n    case OBJ_TYPE.BLOCK:\n      if (!cutting) {\n        console.log(\"this is a block\");\n        let testPoint = new PIXI.Point(this.x, this.y);\n        let inDelete = pointInRect(testPoint, deleteTool);\n        if (inDelete) {\n          console.log(\"in delete?\");\n          let i = blocks.indexOf(this);\n          blocks.splice(i, 1);\n          app.stage.removeChild(this);\n        } else {\n          let newX = nearestJiji(this.x);\n          console.log(\"newX\", newX);\n          createjs.Tween.get(this).to(\n            {\n              x: newX\n            },\n            300,\n            createjs.Ease.getPowInOut(4)\n          );\n        }\n      }\n  }\n}\n\nfunction onPolyTouchMoved() {\n  if (this.dragging) {\n    this.wasDragged = true;\n    var newPosition = this.data.getLocalPosition(this.parent);\n    this.x = newPosition.x + this.deltaTouch[0];\n    this.y = newPosition.y + this.deltaTouch[1];\n  }\n}\n\n// Helpers\nfunction pointInRect(p, rect) {\n  // This is for a rect with anchor in center\n  let top = rect.y - rect.height / 2;\n  let bottom = rect.y + rect.height / 2;\n  let left = rect.x - rect.width / 2;\n  let right = rect.x + rect.width / 2;\n\n  let c1 = p.x < right;\n  let c2 = p.x > left;\n  let c3 = p.y < bottom;\n  let c4 = p.y > top;\n\n  return c1 && c2 && c3 && c4;\n}\n\nlayoutJijis();\n\n\n};\n"]},"metadata":{},"sourceType":"module"}