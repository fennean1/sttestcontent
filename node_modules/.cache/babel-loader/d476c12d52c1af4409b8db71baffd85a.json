{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nconst ASSETS = CONST.ASSETS;\nexport const init = (app, setup) => {\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE);\n  const LINE_PERCENTAGE = 0.8;\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN);\n  const MEASURE_PIN_TEXTURE = new PIXI.Texture.from(ASSETS.MEASURE_PIN); // Global Vars \n\n  let Features;\n  let FirstRow;\n  let Background;\n  let ActiveID;\n  const labels = {\n    1: \"One Whole\",\n    2: \"One Half\",\n    3: \"One Third\",\n    4: \"Fourth\",\n    5: \"5th\",\n    6: \"6th\",\n    7: \"7th\",\n    8: \"8th\",\n    9: \"9th\",\n    10: \"10th\",\n    11: \"11th\",\n    12: \"12th\"\n  }; // Layout Parameters\n\n  let WINDOW_WIDTH = setup.width;\n  let WINDOW_HEIGHT = setup.height;\n  let BAR_HEIGHT = WINDOW_HEIGHT / 15;\n  let BAR_WIDTH = WINDOW_WIDTH * 0.8;\n  let ANCHORS = [];\n  let ROWS = []; //\n\n  function makeBackground() {\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH;\n    this.sprite.height = WINDOW_HEIGHT;\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup', globalPointerUp);\n    this.sprite.interactive = true;\n    app.stage.addChild(this.sprite);\n\n    this.draw = () => {\n      this.sprite.width = WINDOW_WIDTH;\n      this.sprite.height = WINDOW_HEIGHT;\n    };\n  }\n\n  class Row extends PIXI.Container {\n    constructor(num, den, width, ID) {\n      super(); // This\n\n      this.incDenonimator = inc => {\n        this.frameGraphics.clear();\n        this.frameGraphics.lineStyle(3, 0x000000);\n        this.frameGraphics.drawRoundedRect(0, 0, this.width - 3, BAR_HEIGHT, 1);\n        const frameTexture = app.renderer.generateTexture(this.frameGraphics); // New sprite starts as frame and then gets animated.\n\n        let s = new PIXI.Sprite(frameTexture);\n        this.addChild(s);\n        s.x = 0;\n\n        const onUpdate = () => {\n          this.draw();\n        };\n\n        if (inc > 0) {\n          const onComplete = () => {\n            s.on('pointerdown', this.spritePointerDown);\n            s.on('pointerup', this.spritePointerUp);\n            s.on('pointermove', this.spritePointerMoved);\n            s.interactive = true;\n            s.active = false;\n            this.sprites.push(s);\n          };\n\n          TweenMax.to(this, 0.25, {\n            denominator: this.denominator + 1,\n            onUpdate: onUpdate,\n            onComplete: onComplete\n          });\n        } else if (inc < 0) {\n          let removeme = this.sprites.pop();\n          this.removeChild(removeme);\n\n          const onComplete = () => {\n            this.removeChild(s);\n            this.sprites.forEach(s => {\n              s.label.x = this.width / this.denominator / 2;\n              s.label.text = labels[this.denominator];\n            });\n          };\n\n          TweenMax.to(this, 0.25, {\n            denominator: this.denominator - 1,\n            onUpdate: onUpdate,\n            onComplete: onComplete\n          });\n        }\n      };\n\n      this.interactive = true; // Default values\n\n      this.numerator = num;\n      this.denominator = den;\n      this.trueWidth = width;\n      this.id = ID;\n      this.sprites = [];\n      this.blockWidth = width / this.denominator; // Init Graphics A\n\n      this.graphicsA = new PIXI.Graphics();\n      this.graphicsA.beginFill(0xffffff);\n      this.graphicsA.lineStyle(3, 0x000000);\n      this.graphicsA.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      this.textureA = app.renderer.generateTexture(this.graphicsA); // Init Graphics B\n\n      this.graphicsB = new PIXI.Graphics();\n      this.graphicsB.beginFill(0xff4772);\n      this.graphicsB.lineStyle(3, 0x000000);\n      this.graphicsB.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      this.textureB = app.renderer.generateTexture(this.graphicsB); // Dummy frame for when animating between different fractional parts.\n\n      this.frameGraphics = new PIXI.Graphics(); // Generate Row\n\n      for (let i = 0; i < this.denominator; i++) {\n        let label = new PIXI.Text();\n        label.text = labels[this.denominator];\n        label.anchor.set(0.5);\n        label.x = this.blockWidth / 2;\n        label.y = BAR_HEIGHT / 2;\n        let s = new PIXI.Sprite.from(this.textureA);\n        s.on('pointerdown', this.spritePointerDown);\n        s.on('pointerup', this.spritePointerUp);\n        s.on('pointermove', this.spritePointerMoved);\n        s.interactive = true;\n        s.active = false;\n        s.buttonMode = true;\n        s.x = i * BAR_WIDTH / this.denominator;\n        s.y = 0;\n        s.addChild(label);\n        s.label = label;\n        this.sprites.push(s);\n        this.addChild(s);\n      } //  Attached methods\n\n\n      this.on('pointerdown', this.pointerDown);\n      this.on('pointerup', this.pointerUp);\n      this.on('pointermove', this.pointerMove);\n    }\n\n    draw(width) {\n      if (width) {\n        this.trueWidth = width;\n      }\n\n      console.log(this);\n      this.blockWidth = this.trueWidth / this.denominator;\n      this.graphicsA.clear();\n      this.graphicsA.beginFill(0xffffff);\n      this.graphicsA.lineStyle(3, 0x000000);\n      this.graphicsA.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      this.textureA = app.renderer.generateTexture(this.graphicsA);\n      this.graphicsB.clear();\n      this.graphicsB.beginFill(0xff4772);\n      this.graphicsB.lineStyle(3, 0x000000);\n      this.graphicsB.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      this.textureB = app.renderer.generateTexture(this.graphicsB);\n\n      for (let i = 0; i < this.sprites.length; i++) {\n        if (this.sprites[i].active) {\n          this.sprites[i].texture = this.textureA;\n        } else {\n          this.sprites[i].texture = this.textureB;\n        }\n\n        this.sprites[i].x = this.blockWidth * i;\n        this.sprites[i].y = 0;\n      }\n    }\n\n    spritePointerDown(event) {\n      this.touched = true;\n      this.dragged = false;\n    }\n\n    spritePointerMoved(event) {\n      if (this.touched) {\n        console.log(\"pointermove\");\n        this.dragged = true;\n      }\n    }\n\n    spritePointerUp(event) {\n      console.log(\"spritepointerup\");\n      this.touched = false;\n      console.log('this.draggeed', this.dragged);\n\n      if (!this.parent.dragged && this.id == ActiveID) {\n        this.dragged = false;\n        this.active = !this.active;\n        this.alpha = 0.2;\n        this.texture = this.active ? this.parent.textureB : this.parent.textureA;\n        TweenLite.to(this, 0.4, {\n          alpha: 1\n        });\n      }\n    }\n\n    pointerDown(event) {\n      console.log(\"pointerdown\");\n      app.stage.addChild(this);\n      ActiveID = this.id;\n      this.data = event.data;\n      this.startIndex = Math.round(this.y / BAR_HEIGHT);\n      this.startWidth = this.width;\n      this.dragStartY = event.data.global.y;\n      this.touching = true;\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      };\n    }\n\n    pointerUp(event) {\n      console.log(\"pointer up\");\n\n      if (this.dragged) {\n        let j = this.startIndex;\n        let i = Math.round(this.y / BAR_HEIGHT);\n        console.log(\"i,j\", i, j);\n        ROWS.splice(j, 1);\n        ROWS.splice(i, 0, this);\n        ROWS.forEach((r, i) => {\n          TweenLite.to(r, 0.2, {\n            y: ANCHORS[i]\n          });\n        });\n      }\n\n      this.dragged = false;\n      this.touching = false;\n    }\n\n    pointerMove(event) {\n      if (this.touching) {\n        this.y = event.data.global.y + this.deltaTouch.y;\n        this.dragged = true;\n      }\n    }\n\n  }\n\n  function globalPointerUp() {\n    ROWS.forEach(r => {\n      r.dragged = false;\n      r.touched = false;\n      r.sprites.map(s => {\n        s.dragged = false;\n        s.touched = false;\n      });\n    });\n  } // Called on resize\n\n\n  function resize(newFrame, flex) {\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame); //Row.draw()\n  }\n\n  function updateLayoutParams(newFrame) {\n    let frame;\n\n    if (newFrame) {\n      frame = newFrame;\n    } else {\n      frame = {\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT\n      };\n    }\n  } // Loading Script\n\n\n  function load() {\n    if (setup.props.features) {\n      Features = setup.props.features;\n    }\n\n    Background = new makeBackground();\n\n    for (let i = 0; i < 12; i++) {\n      let newRow = new Row(0, i + 1, BAR_WIDTH, 0);\n      newRow.y = i * BAR_HEIGHT;\n      ANCHORS.push(i * BAR_HEIGHT);\n      console.log(\"i*barHeight\", i * BAR_HEIGHT);\n      ROWS.push(newRow);\n      app.stage.addChild(newRow);\n    }\n  } // Functions attached to app: (need to be destroyed)\n\n\n  app.resize = frame => resize(frame);\n\n  app.resizable = true;\n  load();\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/newfractionstacks.js"],"names":["PIXI","CONST","TweenMax","TimelineLite","Power2","Elastic","CSSPlugin","TweenLite","TimelineMax","ASSETS","init","app","setup","BLUE_TEXTURE","Texture","from","BLUE_CIRCLE","LINE_PERCENTAGE","PIN_TEXTURE","SHARP_PIN","MEASURE_PIN_TEXTURE","MEASURE_PIN","Features","FirstRow","Background","ActiveID","labels","WINDOW_WIDTH","width","WINDOW_HEIGHT","height","BAR_HEIGHT","BAR_WIDTH","ANCHORS","ROWS","makeBackground","sprite","Sprite","BLUE_GRADIENT","x","y","on","globalPointerUp","interactive","stage","addChild","draw","Row","Container","constructor","num","den","ID","incDenonimator","inc","frameGraphics","clear","lineStyle","drawRoundedRect","frameTexture","renderer","generateTexture","s","onUpdate","onComplete","spritePointerDown","spritePointerUp","spritePointerMoved","active","sprites","push","to","denominator","removeme","pop","removeChild","forEach","label","text","numerator","trueWidth","id","blockWidth","graphicsA","Graphics","beginFill","textureA","graphicsB","textureB","i","Text","anchor","set","buttonMode","pointerDown","pointerUp","pointerMove","console","log","length","texture","event","touched","dragged","parent","alpha","data","startIndex","Math","round","startWidth","dragStartY","global","touching","deltaTouch","j","splice","r","map","resize","newFrame","flex","updateLayoutParams","frame","load","props","features","newRow","resizable"],"mappings":"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","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nconst ASSETS = CONST.ASSETS\n\nexport const init = (app, setup) => {\n\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE)\n  const LINE_PERCENTAGE = 0.8\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN)\n  const MEASURE_PIN_TEXTURE = new PIXI.Texture.from(ASSETS.MEASURE_PIN)\n\n// Global Vars \n  let Features;\n  let FirstRow;\n  let Background;\n  let ActiveID;\n\n  const labels = {\n    1: \"One Whole\",\n    2: \"One Half\",\n    3: \"One Third\",\n    4: \"Fourth\",\n    5: \"5th\",\n    6: \"6th\",\n    7: \"7th\",\n    8: \"8th\",\n    9: \"9th\",\n    10: \"10th\",\n    11: \"11th\",\n    12: \"12th\"\n  };\n\n\n  // Layout Parameters\n  let WINDOW_WIDTH = setup.width\n  let WINDOW_HEIGHT = setup.height\n  let BAR_HEIGHT = WINDOW_HEIGHT/15\n  let BAR_WIDTH = WINDOW_WIDTH*0.8\n  let ANCHORS = []\n  let ROWS = []\n  \n\n  //\n\n\n\n  function makeBackground(){\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH\n    this.sprite.height = WINDOW_HEIGHT\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup',globalPointerUp)\n    this.sprite.interactive = true\n\n    app.stage.addChild(this.sprite)\n\n    this.draw = () => {\n        this.sprite.width = WINDOW_WIDTH\n        this.sprite.height = WINDOW_HEIGHT\n    }\n  }\n\n  class Row extends PIXI.Container {\n\n    constructor(num,den,width,ID) {\n      super()\n\n      // This\n      this.interactive = true\n\n        // Default values\n      this.numerator = num\n      this.denominator = den\n      this.trueWidth = width\n      this.id = ID\n      this.sprites = []\n      this.blockWidth = width / this.denominator\n\n\n      // Init Graphics A\n      this.graphicsA = new PIXI.Graphics()\n      this.graphicsA.beginFill(0xffffff)\n      this.graphicsA.lineStyle(3,0x000000) \n      this.graphicsA.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      this.textureA = app.renderer.generateTexture(this.graphicsA)\n\n      // Init Graphics B\n      this.graphicsB  = new PIXI.Graphics()\n      this.graphicsB.beginFill(0xff4772)\n      this.graphicsB.lineStyle(3,0x000000) \n      this.graphicsB.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      this.textureB = app.renderer.generateTexture(this.graphicsB)\n\n      // Dummy frame for when animating between different fractional parts.\n      this.frameGraphics = new PIXI.Graphics()    \n  \n      // Generate Row\n      for (let i = 0;i<this.denominator;i++) {\n        let label = new PIXI.Text()\n        label.text = labels[this.denominator]\n        label.anchor.set(0.5)\n        label.x = this.blockWidth/2\n        label.y = BAR_HEIGHT/2\n        let s = new PIXI.Sprite.from(this.textureA)\n        s.on('pointerdown',this.spritePointerDown)\n        s.on('pointerup',this.spritePointerUp)\n        s.on('pointermove',this.spritePointerMoved)\n        s.interactive = true\n        s.active = false\n        s.buttonMode = true\n        s.x = i*BAR_WIDTH/this.denominator\n        s.y = 0\n        s.addChild(label)\n        s.label = label\n        this.sprites.push(s)\n        this.addChild(s)\n      }\n            //  Attached methods\n      this.on('pointerdown',this.pointerDown)\n      this.on('pointerup',this.pointerUp)\n      this.on('pointermove',this.pointerMove)\n\n    }\n  \n\n    incDenonimator = (inc) => {\n      this.frameGraphics.clear()\n      this.frameGraphics.lineStyle(3,0x000000) \n      this.frameGraphics.drawRoundedRect(0,0,this.width-3,BAR_HEIGHT,1)\n      const frameTexture = app.renderer.generateTexture(this.frameGraphics)\n      \n      // New sprite starts as frame and then gets animated.\n      let s = new PIXI.Sprite(frameTexture)\n      this.addChild(s)\n      s.x  = 0\n      const onUpdate = ()=>{this.draw()}\n      if (inc > 0){\n        const onComplete = ()=>{\n          s.on('pointerdown',this.spritePointerDown)\n          s.on('pointerup',this.spritePointerUp)\n          s.on('pointermove',this.spritePointerMoved)\n          s.interactive = true\n          s.active = false\n          this.sprites.push(s)\n        }\n        TweenMax.to(this, 0.25, {denominator: this.denominator+1,onUpdate: onUpdate,onComplete: onComplete})\n      } else if (inc < 0) {\n        let removeme  = this.sprites.pop()\n        this.removeChild(removeme)\n        const onComplete = ()=>{\n          this.removeChild(s)\n          this.sprites.forEach(s=>{\n            s.label.x = this.width/this.denominator/2\n            s.label.text = labels[this.denominator]})\n        }\n        TweenMax.to(this, 0.25, {denominator: this.denominator-1,onUpdate: onUpdate,onComplete: onComplete})\n      }\n    }\n\n    draw(width) {\n\n      if (width) {\n        this.trueWidth = width\n      }\n\n      console.log(this)\n\n      this.blockWidth = (this.trueWidth)/this.denominator\n\n      this.graphicsA.clear()\n      this.graphicsA.beginFill(0xffffff)\n      this.graphicsA.lineStyle(3,0x000000) \n      this.graphicsA.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      this.textureA = app.renderer.generateTexture(this.graphicsA)\n\n      this.graphicsB.clear()\n      this.graphicsB.beginFill(0xff4772)\n      this.graphicsB.lineStyle(3,0x000000) \n      this.graphicsB.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      this.textureB = app.renderer.generateTexture(this.graphicsB)\n\n      for (let i = 0;i<this.sprites.length;i++){\n        if (this.sprites[i].active){\n          this.sprites[i].texture = this.textureA\n        } else {\n          this.sprites[i].texture = this.textureB\n        }\n\n        this.sprites[i].x = this.blockWidth*i\n        this.sprites[i].y = 0\n      }\n    }\n\n    spritePointerDown(event){\n      this.touched = true\n      this.dragged = false\n    }\n\n    spritePointerMoved(event) {\n      if (this.touched){\n        console.log(\"pointermove\")\n        this.dragged = true\n      }\n    }\n\n    spritePointerUp(event){\n      console.log(\"spritepointerup\")\n         this.touched = false\n         console.log('this.draggeed',this.dragged)\n     if (!this.parent.dragged && this.id == ActiveID) {\n        this.dragged = false\n        this.active = !this.active\n        this.alpha = 0.2\n        this.texture = this.active ? this.parent.textureB : this.parent.textureA\n        TweenLite.to(this,0.4,{alpha: 1})\n       }\n    }\n\n \n   pointerDown(event) {\n     console.log(\"pointerdown\")\n      app.stage.addChild(this)\n      ActiveID = this.id\n      this.data = event.data\n      this.startIndex = Math.round(this.y/BAR_HEIGHT)\n      this.startWidth = this.width\n      this.dragStartY = event.data.global.y\n      this.touching = true\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n    }\n \n   pointerUp(event) {\n    console.log(\"pointer up\")\n\n    if (this.dragged){\n      let j = this.startIndex\n      let i = Math.round(this.y/BAR_HEIGHT)\n      console.log(\"i,j\",i,j)\n      ROWS.splice(j,1)\n      ROWS.splice(i,0,this)\n      ROWS.forEach((r,i)=> {\n        TweenLite.to(r,0.2,{y: ANCHORS[i]})\n      })\n    } \n      this.dragged = false\n      this.touching = false\n    }\n\n    pointerMove(event) {\n      if (this.touching){\n        this.y = event.data.global.y + this.deltaTouch.y\n        this.dragged = true\n      }\n    }\n  }\n\n\n\n  function globalPointerUp(){\n    ROWS.forEach(r=>{\n      r.dragged = false\n      r.touched = false\n      r.sprites.map(s=>{\n        s.dragged = false\n        s.touched = false})\n    })\n  }\n  \n  // Called on resize\n  function resize(newFrame,flex){\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame)\n    //Row.draw()\n  }\n\n  function updateLayoutParams(newFrame){\n    let frame;\n    if (newFrame){\n      frame = newFrame\n    } else {\n      frame = {width: WINDOW_WIDTH,height: WINDOW_HEIGHT}\n    }\n  }\n\n  // Loading Script\n  function load(){\n    if (setup.props.features){\n      Features = setup.props.features\n    }\n\n    Background = new makeBackground()\n\n\n    for (let i = 0;i<12;i++){\n      let newRow = new Row(0,i+1,BAR_WIDTH,0)\n      newRow.y = i*BAR_HEIGHT\n      ANCHORS.push(i*BAR_HEIGHT)\n      console.log(\"i*barHeight\",i*BAR_HEIGHT)\n      ROWS.push(newRow)\n      app.stage.addChild(newRow)\n    }\n  }\n\n  // Functions attached to app: (need to be destroyed)\n  app.resize = (frame) => resize(frame)\n  app.resizable = true\n\n  load()\n};\n"]},"metadata":{},"sourceType":"module"}