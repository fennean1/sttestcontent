{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport { SSL_OP_TLS_BLOCK_PADDING_BUG, SSL_OP_SSLEAY_080_CLIENT_DH_BUG } from \"constants\";\nimport { number } from \"prop-types\";\nimport { tsExpressionWithTypeArguments, thisExpression } from \"@babel/types\";\nconst ASSETS = CONST.ASSETS;\nexport const init = (app, setup) => {\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE);\n  const LINE_PERCENTAGE = 0.8;\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN);\n  let ActiveRow;\n  let A;\n  let B; // Initial State\n\n  let state = {\n    valA: 8,\n    valB: 8,\n    lineMax: 20\n  };\n  let FirstRow;\n  ActiveRow = FirstRow;\n  var Rows = [FirstRow]; // Layout Parameters\n\n  let WINDOW_WIDTH = setup.width;\n  let WINDOW_HEIGHT = setup.height;\n  let H_W_RATIO = setup.height / setup.width;\n  let LANDSCAPE = H_W_RATIO < 3 / 4;\n  let ARENA_WIDTH = LANDSCAPE ? 4 / 3 * setup.height : setup.width;\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3 / 4 * setup.width;\n  let LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n  let LINE_THICKNESS = LINE_WIDTH / 200;\n  let TICK_THICKNESS = 2 * LINE_THICKNESS / 3;\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n  let DX = LINE_WIDTH / state.lineMax;\n  let LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n  let STRIP_HEIGHT = LINE_WIDTH / 12; // Reference to entities.\n\n  let backGround;\n  let numberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin; // Constructors (should not be called on re-draw)\n\n  function makeNumberLine() {\n    this.tickSpan = 1;\n    this.labelSpan = 1;\n    this.max = state.lineMax;\n    this.ticks = []; // size 120\n\n    this.labels = [];\n    this.line = new PIXI.Graphics();\n\n    this.init = n => {\n      this.line.lineStyle(LINE_THICKNESS, 0x000000);\n      this.line.x = ARENA_WIDTH / 2 - LINE_WIDTH / 2;\n      this.line.y = ARENA_HEIGHT / 2;\n      this.line.lineTo(LINE_WIDTH, 0);\n      this.draw();\n      app.stage.addChild(this.line);\n\n      for (let i = 0; i < 120; i++) {\n        let newTick = new PIXI.Graphics();\n        newTick.lineStyle(LINE_THICKNESS, 0x000000);\n        newTick.x = this.line.x;\n        newTick.y = this.line.y - LINE_THICKNESS / 2;\n        newTick.lineTo(0, MINOR_TICK_HEIGHT);\n        app.stage.addChild(newTick);\n        this.ticks.push(newTick); // Setup Labels Here\n\n        let newLabel = new PIXI.Text(i, {\n          fontFamily: \"Arial\",\n          fontSize: DX / 2,\n          fill: \"0x000000\",\n          align: \"center\"\n        });\n        newLabel.anchor.x = 0.5;\n        this.labels.push(newLabel);\n        newLabel.x = this.line.x + DX * i;\n        newLabel.y = this.line.y + MINOR_TICK_HEIGHT;\n        app.stage.addChild(newLabel);\n      }\n\n      this.increment(0);\n    };\n\n    this.getSetup = () => {// update tickspan etc. based on line max.\n    };\n\n    this.increment = inc => {\n      // Animation go here\n      this.max += inc; // Update State - (Context Specific)\n\n      state.lineMax = this.max;\n      updateLayoutParams();\n      this.ticks.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n        }\n      });\n      this.labels.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 0\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 1\n          });\n        }\n      });\n    };\n\n    this.draw = () => {\n      this.line.width = LINE_WIDTH;\n      this.line.height = LINE_THICKNESS;\n      this.line.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      this.line.y = WINDOW_HEIGHT / 2;\n      this.ticks.forEach((e, i) => {\n        e.width = TICK_THICKNESS;\n        e.height = MINOR_TICK_HEIGHT;\n        e.y = this.line.y - LINE_THICKNESS / 2;\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.x;\n        }\n      });\n      this.labels.forEach((e, i) => {\n        e.y = this.line.y + MINOR_TICK_HEIGHT;\n        e.style.fontSize = DX / 2;\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.x;\n        }\n      });\n    };\n\n    this.init();\n  }\n\n  function makeBackground() {\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH;\n    this.sprite.height = WINDOW_HEIGHT;\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup', globalPointerUp);\n    this.sprite.interactive = true;\n    app.stage.addChild(this.sprite);\n\n    this.draw = () => {\n      this.sprite.width = WINDOW_WIDTH;\n      this.sprite.height = WINDOW_HEIGHT;\n    };\n  }\n\n  function makePin(id) {\n    this.sprite = new PIXI.Sprite();\n    this.sprite.id = id;\n    this.sprite.texture = PIN_TEXTURE;\n    this.sprite.interactive = true;\n    this.sprite.anchor.x = 0.5;\n    this.sprite.on('pointerdown', onDragStart);\n    this.sprite.on('pointermove', onDragMove);\n    this.sprite.on('pointerup', onDragEnd);\n    this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    this.sprite.val = 8;\n    app.stage.addChild(this.sprite);\n\n    this.sprite.round = () => {\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x;\n      let n = Math.round(rawLineX / DX); // Setting\n\n      this.sprite.x = numberLine.line.x + n * DX;\n      this.sprite.val = n; // There's gotta be a better pattern than this\n\n      if (this.sprite.id == 0) {\n        state.valA = this.sprite.val;\n      } else if (this.sprite.id == 1) {\n        state.valB = this.sprite.val;\n      }\n    };\n\n    this.draw = () => {\n      this.sprite.width = STRIP_HEIGHT;\n      this.sprite.height = STRIP_HEIGHT;\n      this.sprite.y = WINDOW_HEIGHT / 2 + MINOR_TICK_HEIGHT + DX / 2;\n      this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2 + this.sprite.val * DX;\n    };\n\n    this.draw();\n  } // Pin Drag Functions\n\n\n  function onDragStart(event) {\n    app.stage.addChild(this);\n    this.deltaTouch = {\n      x: this.x - event.data.global.x,\n      y: this.y - event.data.global.y\n    };\n    this.dragging = true;\n    this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round();\n    FirstRow.draw(this.x - LINE_START);\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let width = this.x - LINE_START;\n      FirstRow.draw(width);\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x; // Keep within number line bounds.\n\n      if (this.x < WINDOW_WIDTH / 2 - LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      } else if (this.x > WINDOW_WIDTH / 2 + LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 + LINE_WIDTH / 2;\n      }\n    }\n  }\n\n  function makeArrowButton(inc) {\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW);\n    button.inc = inc;\n    button.interactive = true;\n    button.anchor.set(0.5);\n    button.on('pointerdown', () => {\n      numberLine.increment(inc);\n      resize(null, false);\n    });\n    app.stage.addChild(button);\n\n    button.draw = () => {\n      if (button.inc == -5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 + 1 / 2 * button.width;\n        button.rotation = Math.PI;\n      } else if (button.inc == 5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 - 1 / 2 * button.width;\n      }\n    };\n\n    return button;\n  }\n\n  app.stage.on('pointerdown', resizeLine); //app.stage.interactive = true\n\n  function resizeLine(event) {\n    let g = new PIXI.Graphics();\n    g.lineStyle(3, 0x000000);\n    g.drawRoundedRect(0, 0, FirstRow.width, 50, 1);\n    let R = app.renderer.generateTexture(g);\n    let s = new PIXI.Sprite();\n    FirstRow.container.addChild(s);\n    s.texture = R;\n    s.x = LINE_START;\n\n    let onComplete = () => {\n      FirstRow.sprites.push(s);\n      FirstRow.draw();\n    };\n\n    TweenMax.to(FirstRow, 0.5, {\n      denominator: FirstRow.denominator + 1,\n      onUpdate: FirstRow.draw,\n      onComplete: onComplete\n    });\n  }\n\n  function Row(num, den, width) {\n    // Internal Params\n    let touching = true; // Default values\n\n    this.numerator = num;\n    this.denominator = den;\n    this.width = width;\n    this.container = new PIXI.Container();\n    this.container.width = width;\n    this.container.interactive = true;\n    console.log(\"window height\", WINDOW_HEIGHT);\n    this.container.y = 0;\n    this.sprites = [];\n    this.blockWidth = width / this.denominator;\n    this.container.leftWhisker = new PIXI.Graphics();\n    this.container.rightWhisker = new PIXI.Graphics();\n    this.blockA = new PIXI.Graphics();\n    this.blockA.lineStyle(3, 0x000000);\n    this.blockA.drawRoundedRect(0, 0, this.blockWidth, 50, 1);\n    A = app.renderer.generateTexture(this.blockA);\n    this.blockB = new PIXI.Graphics();\n    this.blockB.beginFill(0xff4772);\n    this.blockB.lineStyle(3, 0x000000);\n    this.blockB.drawRoundedRect(0, 0, this.blockWidth, 50, 1);\n    B = app.renderer.generateTexture(this.blockB);\n\n    this.draw = width => {\n      if (width) {\n        this.width = width;\n      }\n\n      this.blockWidth = this.width / this.denominator;\n      this.blockA.clear();\n      this.blockA.lineStyle(3, 0x000000);\n      this.blockA.drawRoundedRect(0, 0, this.blockWidth, 50, 1);\n      A = app.renderer.generateTexture(this.blockA);\n      this.blockB.clear();\n      this.blockB.beginFill(0xff4772);\n      this.blockB.lineStyle(3, 0x000000);\n      this.blockB.drawRoundedRect(0, 0, this.blockWidth, 50, 1);\n      B = app.renderer.generateTexture(this.blockB);\n\n      for (let i = 0; i < this.sprites.length; i++) {\n        if (this.sprites[i].active) {\n          this.sprites[i].texture = B;\n        } else {\n          this.sprites[i].texture = A;\n        }\n\n        this.sprites[i].x = LINE_START + this.blockWidth * i;\n        this.sprites[i].y = 0;\n      }\n    };\n\n    for (let i = 0; i < this.denominator; i++) {\n      console.log(\"balls\");\n      let s = new PIXI.Sprite.from(A);\n      s.on('pointerdown', spritePointerDown);\n      s.on('pointerup', spritePointerUp);\n      s.on('pointermove', spritePointerMoved);\n      s.interactive = true;\n      s.active = false;\n      s.x = i * LINE_WIDTH / this.denominator;\n      s.y = WINDOW_HEIGHT / 2 - 50;\n      this.sprites.push(s);\n      this.container.addChild(s);\n    } //  Attached methods\n\n\n    this.container.on('pointerdown', containerPointerDown);\n    this.container.on('pointerup', containerPointerUp);\n    this.container.on('pointermove', containerPointerMove); // Add children\n\n    app.stage.addChild(this.container);\n    this.width = this.container.width;\n\n    function spritePointerDown(event) {\n      this.touched = true;\n      this.dragged = false;\n    }\n\n    function spritePointerMoved(event) {\n      if (this.touched) {\n        console.log(\"pointermove\");\n        this.dragged = true;\n      }\n    }\n\n    function spritePointerUp(event) {\n      this.touched = false;\n      console.log('this.draggeed', this.dragged);\n\n      if (!this.dragged) {\n        this.dragged = false;\n        this.active = !this.active;\n        this.alpha = 0.2;\n        this.texture = this.active ? B : A;\n        TweenLite.to(this, 0.4, {\n          alpha: 1\n        });\n      }\n    }\n\n    function containerPointerDown(event) {\n      this.data = event.data;\n      this.startWidth = this.width;\n      this.dragStartY = event.data.global.y;\n      this.touching = true;\n      touching = true;\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      };\n    }\n\n    function containerPointerUp(event) {\n      this.touching = false;\n      touching = false;\n    }\n\n    function containerPointerMove(event) {\n      if (this.touching) {\n        const newPosition = this.data.getLocalPosition(this.parent);\n        this.y = event.data.global.y + this.deltaTouch.y;\n        this.dragged = true;\n        this.leftWhisker.clear();\n        this.leftWhisker.lineStyle(3, 0x000000);\n        this.leftWhisker.moveTo(LINE_START, 0);\n        this.leftWhisker.lineTo(LINE_START, WINDOW_HEIGHT / 2 - this.y);\n        this.rightWhisker.clear();\n        this.rightWhisker.lineStyle(3, 0x000000);\n        this.rightWhisker.moveTo(pinA.x, WINDOW_HEIGHT / 2 - this.y);\n        this.rightWhisker.lineTo(pinA.x, WINDOW_HEIGHT / 2);\n        this.addChild(this.leftWhisker);\n        this.addChild(this.rightWhisker);\n      }\n    }\n\n    this.draw(width);\n  }\n\n  function globalPointerUp() {\n    // Ughhh...\n    FirstRow.container.touching = false;\n    pinA.sprite.dragging = false; //pinA.sprite.round()\n    //pinB.sprite.round()\n    //stripA.draw()\n    //stripB.draw()\n    //stripALabel.draw()\n    //stripBLabel.draw()\n  } // Called on resize\n\n\n  function resize(newFrame, flex) {\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame);\n    app.renderer.resize(WINDOW_WIDTH, WINDOW_HEIGHT);\n    numberLine.draw();\n    backGround.draw();\n    pinA.draw();\n    incButton.draw();\n    decButton.draw();\n  }\n\n  function updateLayoutParams(newFrame) {\n    let frame;\n\n    if (newFrame) {\n      frame = newFrame;\n    } else {\n      frame = {\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT\n      };\n    }\n\n    WINDOW_WIDTH = frame.width;\n    WINDOW_HEIGHT = frame.height;\n    H_W_RATIO = frame.height / frame.width;\n    LANDSCAPE = H_W_RATIO < 3 / 4;\n    ARENA_WIDTH = LANDSCAPE ? 4 / 3 * frame.height : frame.width;\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3 / 4 * frame.width;\n    LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n    LINE_THICKNESS = LINE_WIDTH / 200;\n    TICK_THICKNESS = LINE_THICKNESS / 2;\n    MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n    DX = LINE_WIDTH / state.lineMax;\n    LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    STRIP_HEIGHT = LINE_WIDTH / 12;\n  } // Loading Script\n\n\n  function load() {\n    let features = {\n      'strips': true\n    };\n\n    if (setup.props.features) {\n      features = setup.props.features;\n    }\n\n    backGround = new makeBackground();\n    numberLine = new makeNumberLine();\n    pinA = new makePin(0); //pinB = new makePin(1)\n    //stripA = new makeStrip(0)\n    //stripB = new makeStrip(1)\n    //stripALabel = makeStripLabel(0)\n    //stripBLabel = makeStripLabel(1)\n\n    incButton = makeArrowButton(5);\n    decButton = makeArrowButton(-5); //stripALabel.draw()\n    //stripBLabel.draw()\n\n    incButton.draw();\n    decButton.draw();\n    FirstRow = new Row(3, 4, pinA.sprite.x - LINE_START);\n  } // Call load script\n\n\n  load(); // Not sure where else to put this.\n\n  app.resize = frame => resize(frame);\n\n  app.resizable = true;\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/fractionstacks.js"],"names":["PIXI","CONST","TweenMax","TimelineLite","Power2","Elastic","CSSPlugin","TweenLite","TimelineMax","SSL_OP_TLS_BLOCK_PADDING_BUG","SSL_OP_SSLEAY_080_CLIENT_DH_BUG","number","tsExpressionWithTypeArguments","thisExpression","ASSETS","init","app","setup","BLUE_TEXTURE","Texture","from","BLUE_CIRCLE","LINE_PERCENTAGE","PIN_TEXTURE","SHARP_PIN","ActiveRow","A","B","state","valA","valB","lineMax","FirstRow","Rows","WINDOW_WIDTH","width","WINDOW_HEIGHT","height","H_W_RATIO","LANDSCAPE","ARENA_WIDTH","ARENA_HEIGHT","LINE_WIDTH","LINE_THICKNESS","TICK_THICKNESS","MAJOR_TICK_HEIGHT","MINOR_TICK_HEIGHT","DX","LINE_START","STRIP_HEIGHT","backGround","numberLine","pinA","pinB","stripA","stripB","stripBLabel","stripALabel","incButton","decButton","activePin","makeNumberLine","tickSpan","labelSpan","max","ticks","labels","line","Graphics","n","lineStyle","x","y","lineTo","draw","stage","addChild","i","newTick","push","newLabel","Text","fontFamily","fontSize","fill","align","anchor","increment","getSetup","inc","updateLayoutParams","forEach","e","to","alpha","style","makeBackground","sprite","Sprite","BLUE_GRADIENT","on","globalPointerUp","interactive","makePin","id","texture","onDragStart","onDragMove","onDragEnd","val","round","rawLineX","Math","event","deltaTouch","data","global","dragging","newPosition","getLocalPosition","parent","makeArrowButton","button","ARROW","set","resize","rotation","PI","resizeLine","g","drawRoundedRect","R","renderer","generateTexture","s","container","onComplete","sprites","denominator","onUpdate","Row","num","den","touching","numerator","Container","console","log","blockWidth","leftWhisker","rightWhisker","blockA","blockB","beginFill","clear","length","active","spritePointerDown","spritePointerUp","spritePointerMoved","containerPointerDown","containerPointerUp","containerPointerMove","touched","dragged","startWidth","dragStartY","moveTo","newFrame","flex","frame","load","features","props","resizable"],"mappings":"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","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport { SSL_OP_TLS_BLOCK_PADDING_BUG, SSL_OP_SSLEAY_080_CLIENT_DH_BUG } from \"constants\";\nimport { number } from \"prop-types\";\nimport { tsExpressionWithTypeArguments, thisExpression } from \"@babel/types\";\nconst ASSETS = CONST.ASSETS\n\nexport const init = (app, setup) => {\n\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE)\n  const LINE_PERCENTAGE = 0.8\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN)\n\n  let ActiveRow;\n  let A;\n  let B;\n\n // Initial State\n  let state = {\n    valA: 8,\n    valB: 8,\n    lineMax: 20,\n  }\n\n  let FirstRow\n  ActiveRow = FirstRow\n\n  var Rows = [FirstRow]\n\n  // Layout Parameters\n  let WINDOW_WIDTH = setup.width\n  let WINDOW_HEIGHT = setup.height\n  let H_W_RATIO = setup.height/setup.width\n  let LANDSCAPE = H_W_RATIO < 3/4\n  let ARENA_WIDTH = LANDSCAPE ? 4/3*setup.height : setup.width\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3/4*setup.width\n  let LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n  let LINE_THICKNESS = LINE_WIDTH/200\n  let TICK_THICKNESS = 2*LINE_THICKNESS/3\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n  let DX = LINE_WIDTH/state.lineMax\n  let LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n  let STRIP_HEIGHT = LINE_WIDTH/12\n\n  // Reference to entities.\n  let backGround;\n  let numberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin;\n\n \n  // Constructors (should not be called on re-draw)\n  function makeNumberLine(){\n     this.tickSpan = 1\n     this.labelSpan = 1\n     this.max = state.lineMax\n     this.ticks = [] // size 120\n     this.labels = []\n     this.line = new PIXI.Graphics()\n\n     this.init = (n) => {\n        this.line.lineStyle(LINE_THICKNESS,0x000000)\n        this.line.x = ARENA_WIDTH/2-LINE_WIDTH/2\n        this.line.y = ARENA_HEIGHT/2\n        this.line.lineTo(LINE_WIDTH,0)\n        this.draw()\n        app.stage.addChild(this.line)\n\n        for (let i = 0;i<120;i++){\n            let newTick = new PIXI.Graphics()\n            newTick.lineStyle(LINE_THICKNESS,0x000000)\n            newTick.x = this.line.x \n            newTick.y = this.line.y - LINE_THICKNESS/2\n            newTick.lineTo(0,MINOR_TICK_HEIGHT)\n            app.stage.addChild(newTick)\n            this.ticks.push(newTick)\n\n            // Setup Labels Here\n            let newLabel = new PIXI.Text(i,{\n              fontFamily: \"Arial\",\n              fontSize: DX/2,\n              fill: \"0x000000\",\n              align: \"center\"\n            })\n            newLabel.anchor.x = 0.5\n            this.labels.push(newLabel)\n            newLabel.x = this.line.x + DX*i\n            newLabel.y = this.line.y + MINOR_TICK_HEIGHT\n            app.stage.addChild(newLabel)\n        }\n        this.increment(0)\n     }\n\n     this.getSetup = ()=> {\n         // update tickspan etc. based on line max.\n     }\n\n     this.increment = (inc) => {\n         // Animation go here\n         this.max += inc\n\n         // Update State - (Context Specific)\n         state.lineMax = this.max\n         updateLayoutParams()\n\n         this.ticks.forEach((e,i)=> {\n            if (i > this.max){\n                TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n            } else {\n                TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n            }\n         })\n\n         this.labels.forEach((e,i)=> {\n          if (i > this.max){\n              TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n              TweenLite.to(e,0.5,{alpha: 0})\n          } else {\n              TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n              TweenLite.to(e,0.5,{alpha: 1})\n          }\n       })\n     }\n\n     this.draw = () => {\n        this.line.width = LINE_WIDTH\n        this.line.height = LINE_THICKNESS\n        this.line.x = WINDOW_WIDTH/2 - LINE_WIDTH/2\n        this.line.y = WINDOW_HEIGHT/2\n        this.ticks.forEach((e,i)=> {\n            e.width = TICK_THICKNESS\n            e.height = MINOR_TICK_HEIGHT\n            e.y = this.line.y - LINE_THICKNESS/2\n            if (i > this.max){\n                e.x = LINE_WIDTH + this.line.x \n            } else {\n                e.x =  LINE_WIDTH/this.max*i + this.line.x\n            }\n         })\n         this.labels.forEach((e,i)=> {\n          e.y = this.line.y + MINOR_TICK_HEIGHT\n          e.style.fontSize = DX/2\n          if (i > this.max){\n              e.x = LINE_WIDTH + this.line.x \n          } else {\n              e.x =  LINE_WIDTH/this.max*i + this.line.x\n          }\n       })\n     }\n     this.init()\n  }\n\n  function makeBackground(){\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH\n    this.sprite.height = WINDOW_HEIGHT\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup',globalPointerUp)\n    this.sprite.interactive = true\n\n    app.stage.addChild(this.sprite)\n\n    this.draw = () => {\n        this.sprite.width = WINDOW_WIDTH\n        this.sprite.height = WINDOW_HEIGHT\n    }\n  }\n\n\n  function makePin(id){\n    this.sprite = new PIXI.Sprite()\n    this.sprite.id = id\n    this.sprite.texture = PIN_TEXTURE\n    this.sprite.interactive = true\n    this.sprite.anchor.x = 0.5\n    this.sprite.on('pointerdown',onDragStart)\n    this.sprite.on('pointermove',onDragMove)\n    this.sprite.on('pointerup',onDragEnd)\n    this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    this.sprite.val = 8\n    app.stage.addChild(this.sprite)\n\n    this.sprite.round = () => {\n\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x\n      let n = Math.round(rawLineX/DX)\n\n      // Setting\n      this.sprite.x = numberLine.line.x + n*DX\n      this.sprite.val = n\n\n      // There's gotta be a better pattern than this\n      if (this.sprite.id == 0){\n        state.valA = this.sprite.val\n      } else if (this.sprite.id == 1){\n        state.valB = this.sprite.val\n      }\n    }\n\n    this.draw = () => { \n      this.sprite.width = STRIP_HEIGHT\n      this.sprite.height = STRIP_HEIGHT\n      this.sprite.y = WINDOW_HEIGHT/2 + MINOR_TICK_HEIGHT + DX/2\n      this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2 + this.sprite.val*DX\n    }\n    this.draw()\n   }\n\n  // Pin Drag Functions\n  function onDragStart(event) {\n      app.stage.addChild(this)\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n      this.dragging = true;\n      this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round()\n    FirstRow.draw(this.x - LINE_START)\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let width = this.x - LINE_START\n      FirstRow.draw(width)\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x;\n\n      // Keep within number line bounds.\n      if (this.x < WINDOW_WIDTH/2-LINE_WIDTH/2){\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2-LINE_WIDTH/2\n      } else if (this.x > WINDOW_WIDTH/2+LINE_WIDTH/2) {\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2+LINE_WIDTH/2\n      }\n    }\n  }\n\n  function makeArrowButton(inc){\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW)\n    button.inc = inc\n    button.interactive = true\n    button.anchor.set(0.5)\n    button.on('pointerdown',()=>{\n      numberLine.increment(inc)\n      resize(null,false)\n    })\n    app.stage.addChild(button)\n\n    button.draw = () => {\n      if (button.inc == -5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2 + 1/2*button.width\n        button.rotation = Math.PI\n      } else if (button.inc == 5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2  - 1/2*button.width\n      }\n    }\n    return button\n  }\n\n  app.stage.on('pointerdown',resizeLine)\n  //app.stage.interactive = true\n\n  function resizeLine(event){\n    let g = new PIXI.Graphics()    \n    g.lineStyle(3,0x000000) \n    g.drawRoundedRect(0,0,FirstRow.width,50,1)\n    let R = app.renderer.generateTexture(g)\n\n    let s = new PIXI.Sprite()\n    FirstRow.container.addChild(s)\n    s.texture = R\n    s.x  = LINE_START\n    let onComplete = ()=>{\n      FirstRow.sprites.push(s)\n      FirstRow.draw()\n    }\n    TweenMax.to(FirstRow, 0.5, {denominator: FirstRow.denominator+1,onUpdate: FirstRow.draw,onComplete: onComplete})\n  }\n\n\n\n\n \n  function Row(num,den,width){\n\n    // Internal Params\n    let touching = true   \n    \n    // Default values\n    this.numerator = num\n    this.denominator = den\n    this.width = width\n\n  \n    this.container = new PIXI.Container()\n    this.container.width = width\n    this.container.interactive = true\n    console.log(\"window height\",WINDOW_HEIGHT)\n    this.container.y = 0\n    this.sprites = []\n  \n\n    this.blockWidth = width / this.denominator\n\n    this.container.leftWhisker = new PIXI.Graphics()\n    this.container.rightWhisker = new PIXI.Graphics()\n\n\n    this.blockA = new PIXI.Graphics()\n    this.blockA.lineStyle(3,0x000000) \n    this.blockA.drawRoundedRect(0,0,this.blockWidth,50,1)\n    A = app.renderer.generateTexture(this.blockA)\n\n    this.blockB = new PIXI.Graphics()\n    this.blockB.beginFill(0xff4772)\n    this.blockB.lineStyle(3,0x000000) \n    this.blockB.drawRoundedRect(0,0,this.blockWidth,50,1)\n    B = app.renderer.generateTexture(this.blockB)\n\n\n    this.draw = (width) => {\n\n      if (width) {\n        this.width = width\n      }\n      this.blockWidth = this.width/this.denominator\n\n      this.blockA.clear()\n      this.blockA.lineStyle(3,0x000000) \n      this.blockA.drawRoundedRect(0,0,this.blockWidth,50,1)\n      A = app.renderer.generateTexture(this.blockA)\n\n      this.blockB.clear()\n      this.blockB.beginFill(0xff4772)\n      this.blockB.lineStyle(3,0x000000) \n      this.blockB.drawRoundedRect(0,0,this.blockWidth,50,1)\n      B = app.renderer.generateTexture(this.blockB)\n\n      for (let i = 0;i<this.sprites.length;i++){\n        if (this.sprites[i].active){\n          this.sprites[i].texture = B\n        } else {\n          this.sprites[i].texture = A\n        }\n\n        this.sprites[i].x = LINE_START+this.blockWidth*i\n        this.sprites[i].y = 0\n      }\n    }\n\n    for (let i = 0;i<this.denominator;i++) {\n      console.log(\"balls\")\n      let s = new PIXI.Sprite.from(A)\n      s.on('pointerdown',spritePointerDown)\n      s.on('pointerup',spritePointerUp)\n      s.on('pointermove',spritePointerMoved)\n      s.interactive = true\n      s.active = false\n      s.x = i*LINE_WIDTH/this.denominator\n      s.y = WINDOW_HEIGHT/2 - 50\n      this.sprites.push(s)\n      this.container.addChild(s)\n    }\n      \n\n    //  Attached methods\n    this.container.on('pointerdown',containerPointerDown)\n    this.container.on('pointerup',containerPointerUp)\n    this.container.on('pointermove',containerPointerMove)\n\n    // Add children\n    app.stage.addChild(this.container)\n    this.width = this.container.width\n  \n\n    function spritePointerDown(event){\n      this.touched = true\n      this.dragged = false\n    }\n\n    function spritePointerMoved(event) {\n\n      if (this.touched){\n        console.log(\"pointermove\")\n        this.dragged = true\n      }\n    }\n\n    function spritePointerUp(event){\n         this.touched = false\n         console.log('this.draggeed',this.dragged)\n     if (!this.dragged) {\n        this.dragged = false\n        this.active = !this.active\n        this.alpha = 0.2\n        this.texture = this.active ? B : A\n        TweenLite.to(this,0.4,{alpha: 1})\n       }\n    }\n\n \n   function containerPointerDown(event) {\n      this.data = event.data\n      this.startWidth = this.width\n      this.dragStartY = event.data.global.y\n      this.touching = true\n      touching = true\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n    }\n\n \n   function containerPointerUp(event) {\n      this.touching = false\n      touching = false\n    }\n\n    function containerPointerMove(event) {\n      if (this.touching){\n        const newPosition = this.data.getLocalPosition(this.parent);\n        this.y = event.data.global.y + this.deltaTouch.y\n        this.dragged = true\n\n        this.leftWhisker.clear()\n        this.leftWhisker.lineStyle(3,0x000000)\n        this.leftWhisker.moveTo(LINE_START,0)\n        this.leftWhisker.lineTo(LINE_START,WINDOW_HEIGHT/2-this.y)\n   \n        this.rightWhisker.clear()\n        this.rightWhisker.lineStyle(3,0x000000)\n        this.rightWhisker.moveTo(pinA.x,WINDOW_HEIGHT/2-this.y)\n        this.rightWhisker.lineTo(pinA.x,WINDOW_HEIGHT/2)\n \n        this.addChild(this.leftWhisker)  \n        this.addChild(this.rightWhisker)  \n  \n      }\n    }\n\n\n    this.draw(width)\n\n  }\n\n  function globalPointerUp(){\n    // Ughhh...\n    FirstRow.container.touching = false\n    pinA.sprite.dragging = false\n  \n    //pinA.sprite.round()\n    //pinB.sprite.round()\n    //stripA.draw()\n    //stripB.draw()\n    //stripALabel.draw()\n    //stripBLabel.draw()\n  }\n  \n  // Called on resize\n  function resize(newFrame,flex){\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame)\n    app.renderer.resize(WINDOW_WIDTH,WINDOW_HEIGHT)\n    numberLine.draw()\n    backGround.draw()\n    pinA.draw()\n    incButton.draw()\n    decButton.draw()\n  }\n\n  function updateLayoutParams(newFrame){\n    let frame;\n    if (newFrame){\n      frame = newFrame\n    } else {\n      frame = {width: WINDOW_WIDTH,height: WINDOW_HEIGHT}\n    }\n    WINDOW_WIDTH = frame.width\n    WINDOW_HEIGHT = frame.height\n    H_W_RATIO = frame.height/frame.width\n    LANDSCAPE = H_W_RATIO < 3/4\n    ARENA_WIDTH = LANDSCAPE ? 4/3*frame.height : frame.width\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3/4*frame.width\n    LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n    LINE_THICKNESS = LINE_WIDTH/200\n    TICK_THICKNESS = LINE_THICKNESS/2\n    MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n    DX = LINE_WIDTH/state.lineMax\n    LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    STRIP_HEIGHT = LINE_WIDTH/12\n  }\n\n  // Loading Script\n  function load(){\n    let features = {'strips': true}\n    if (setup.props.features){\n      features = setup.props.features\n    }\n\n\n    backGround = new makeBackground()\n    numberLine = new makeNumberLine()\n    pinA = new makePin(0)\n    //pinB = new makePin(1)\n    //stripA = new makeStrip(0)\n    //stripB = new makeStrip(1)\n    //stripALabel = makeStripLabel(0)\n    //stripBLabel = makeStripLabel(1)\n    incButton = makeArrowButton(5)\n    decButton = makeArrowButton(-5)\n    //stripALabel.draw()\n    //stripBLabel.draw()\n    incButton.draw()\n    decButton.draw()\n    FirstRow = new Row(3,4,pinA.sprite.x - LINE_START)\n  }\n\n  // Call load script\n  load()\n  // Not sure where else to put this.\n  app.resize = (frame) => resize(frame)\n  app.resizable = true\n};\n"]},"metadata":{},"sourceType":"module"}