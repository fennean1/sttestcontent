{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport { SSL_OP_TLS_BLOCK_PADDING_BUG } from \"constants\";\nimport { number } from \"prop-types\";\nconst ASSETS = CONST.ASSETS;\nexport const init = (app, setup) => {\n  let features = {\n    'strips': true,\n    labels: true,\n    open: false\n  };\n\n  if (setup.props.features) {\n    features = setup.props.features;\n  } // Constants\n\n\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE);\n  const LINE_PERCENTAGE = 0.8;\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN); // Initial State\n\n  let state = {\n    valA: 1,\n    valB: 2,\n    lineMax: 20\n  }; // Layout Parameters\n\n  let WINDOW_WIDTH = setup.width;\n  let WINDOW_HEIGHT = setup.height;\n  let H_W_RATIO = setup.height / setup.width;\n  let LANDSCAPE = H_W_RATIO < 3 / 4;\n  let ARENA_WIDTH = LANDSCAPE ? 4 / 3 * setup.height : setup.width;\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3 / 4 * setup.width;\n  let LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n  let LINE_THICKNESS = LINE_WIDTH / 200;\n  let TICK_THICKNESS = 2 * LINE_THICKNESS / 3;\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n  let DX = LINE_WIDTH / state.lineMax;\n  let LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n  let STRIP_HEIGHT = LINE_WIDTH / 12; // Reference to entities.\n\n  let backGround;\n  let numberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin; // Constructors (should not be called on re-draw)\n\n  function makeNumberLine() {\n    this.tickSpan = 1;\n    this.labelSpan = 1;\n    this.max = state.lineMax;\n    this.ticks = []; // size 120\n\n    this.labels = [];\n    this.line = new PIXI.Graphics();\n\n    this.init = n => {\n      this.line.lineStyle(LINE_THICKNESS, 0x000000);\n      this.line.x = ARENA_WIDTH / 2 - LINE_WIDTH / 2;\n      this.line.y = ARENA_HEIGHT / 2;\n      this.line.lineTo(LINE_WIDTH, 0);\n      this.draw();\n      app.stage.addChild(this.line);\n\n      for (let i = 0; i < 120; i++) {\n        let newTick = new PIXI.Graphics();\n        newTick.lineStyle(LINE_THICKNESS, 0x000000);\n        newTick.x = this.line.x;\n        newTick.y = this.line.y - LINE_THICKNESS / 2;\n        newTick.lineTo(0, MINOR_TICK_HEIGHT);\n        app.stage.addChild(newTick);\n        this.ticks.push(newTick); // Setup Labels Here\n\n        let newLabel = new PIXI.Text(i, {\n          fontFamily: \"Arial\",\n          fontSize: DX / 2,\n          fill: \"0x000000\",\n          align: \"center\"\n        });\n        newLabel.anchor.x = 0.5;\n        this.labels.push(newLabel);\n        newLabel.x = this.line.x + DX * i;\n        newLabel.y = this.line.y + MINOR_TICK_HEIGHT;\n        app.stage.addChild(newLabel);\n      }\n\n      this.increment(0);\n    };\n\n    this.getSetup = () => {} // update tickspan etc. based on line max.\n    // Could be more efficient by sending object with key value pairs for easy checking. (object.assign?)\n    ;\n\n    this.keep = values => {\n      let obj = {\n        0: \"I am here\"\n      };\n      values.forEach(v => {\n        obj[v] = 'I am here.';\n      });\n\n      for (let i = 0; i < this.ticks.length; i++) {\n        let a = obj[i] ? 1 : 0;\n        console.log(\"a\", a);\n        this.ticks[i].alpha = a;\n        this.labels[i].alpha = a;\n      }\n    };\n\n    this.increment = inc => {\n      // Animation go here\n      this.max += inc; // Update State - (Context Specific)\n\n      state.lineMax = this.max;\n      updateLayoutParams();\n      this.ticks.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n        }\n      });\n      this.labels.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 0\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 1\n          });\n        }\n      });\n    };\n\n    this.draw = () => {\n      this.line.width = LINE_WIDTH;\n      this.line.height = LINE_THICKNESS;\n      this.line.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      this.line.y = WINDOW_HEIGHT / 2;\n      this.ticks.forEach((e, i) => {\n        e.width = TICK_THICKNESS;\n        e.height = MINOR_TICK_HEIGHT;\n        e.y = this.line.y - LINE_THICKNESS / 2;\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.x;\n        }\n      });\n      this.labels.forEach((e, i) => {\n        e.y = this.line.y + MINOR_TICK_HEIGHT;\n        e.style.fontSize = DX / 2;\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.xr;\n        }\n      });\n    };\n\n    this.init();\n  }\n\n  function makeBackground() {\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH;\n    this.sprite.height = WINDOW_HEIGHT;\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup', globalPointerUp);\n    this.sprite.interactive = true;\n    app.stage.addChild(this.sprite);\n\n    this.draw = () => {\n      this.sprite.width = WINDOW_WIDTH;\n      this.sprite.height = WINDOW_HEIGHT;\n    };\n  }\n\n  function makeStripLabel(n) {\n    let label = new PIXI.Text(n, {\n      fontFamily: \"Arial\",\n      fontSize: DX,\n      fill: \"0x000000\",\n      align: \"center\"\n    });\n    label.id = n;\n    label.anchor.set(0.5);\n\n    label.draw = () => {\n      let valA = state.valA,\n          valB = state.valB;\n\n      if (label.id == 0) {\n        label.x = LINE_START + (pinA.sprite.x - LINE_START) / 2;\n        label.style.fill = 0xffffff;\n        let txt = Math.round((pinA.sprite.x - LINE_START) / DX);\n        label.text = txt; // Hide if \"subtracting\"\n\n        if (pinA.sprite.x > pinB.sprite.x) {\n          label.x = LINE_START + (pinB.sprite.x - LINE_START) / 2;\n          label.text = Math.round((pinB.sprite.x - LINE_START) / DX);\n        }\n\n        if (stripA.graphic.width <= DX) {\n          label.y = WINDOW_HEIGHT / 2 - 1.5 * STRIP_HEIGHT;\n        } else {\n          label.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT / 2;\n        } // Hide for testing purposes\n        //label.alpha = 0\n\n      } else if (label.id == 1) {\n        label.x = (pinA.sprite.x + pinB.sprite.x) / 2;\n        label.y = label.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT / 2;\n        let txt = Math.round(Math.abs(pinA.sprite.x - pinB.sprite.x) / DX);\n        label.text = txt;\n\n        if (stripB.graphic.width <= DX) {\n          label.y = WINDOW_HEIGHT / 2 - 1.5 * STRIP_HEIGHT;\n        } else {\n          label.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT / 2;\n        }\n      }\n\n      label.style.fontSize = STRIP_HEIGHT / 2;\n    };\n\n    app.stage.addChild(label);\n    return label;\n  }\n\n  function makePin(id) {\n    this.sprite = new PIXI.Sprite();\n    this.sprite.id = id;\n    this.sprite.texture = PIN_TEXTURE;\n    this.sprite.interactive = true;\n    this.sprite.anchor.x = 0.5;\n    this.sprite.on('pointerdown', onDragStart);\n    this.sprite.on('pointermove', onDragMove);\n    this.sprite.on('pointerup', onDragEnd);\n    this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    this.sprite.val = id == 0 ? state.valA : state.valB;\n    app.stage.addChild(this.sprite);\n\n    this.sprite.round = () => {\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x;\n      let n = Math.round(rawLineX / DX); // Setting\n\n      this.sprite.x = numberLine.line.x + n * DX;\n      this.sprite.val = n; // There's gotta be a better pattern than this\n\n      if (this.sprite.id == 0) {\n        state.valA = this.sprite.val;\n      } else if (this.sprite.id == 1) {\n        state.valB = this.sprite.val;\n      } // CHECKPOINT!\n\n\n      if (features.open) {\n        numberLine.keep([state.valA, state.valB]);\n      }\n    };\n\n    this.draw = () => {\n      this.sprite.width = STRIP_HEIGHT;\n      this.sprite.height = STRIP_HEIGHT;\n      this.sprite.y = WINDOW_HEIGHT / 2 + MINOR_TICK_HEIGHT + DX / 2;\n      this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2 + this.sprite.val * DX;\n    };\n\n    this.draw();\n  } // Dragging...\n\n\n  function onDragStart(event) {\n    app.stage.addChild(this);\n    this.deltaTouch = {\n      x: this.x - event.data.global.x,\n      y: this.y - event.data.global.y\n    };\n    this.dragging = true;\n    this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round();\n    stripA.draw();\n    stripB.draw();\n    stripALabel.draw();\n    stripBLabel.draw();\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x; //this.y = newPosition.y + this.deltaTouch.y;\n\n      state.valA = Math.round((pinA.sprite.x - LINE_START) / DX);\n      state.valB = Math.round((pinB.sprite.x - LINE_START) / DX); //numberLine.keep([state.valA,state.valB])\n\n      stripA.draw();\n      stripB.draw();\n      stripALabel.draw();\n      stripBLabel.draw(); // Keep within number line bounds\n\n      if (this.x < WINDOW_WIDTH / 2 - LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      } else if (this.x > WINDOW_WIDTH / 2 + LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 + LINE_WIDTH / 2;\n      }\n    }\n  }\n\n  function makeArrowButton(inc) {\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW);\n    button.inc = inc;\n    button.interactive = true;\n    button.anchor.set(0.5);\n    button.on('pointerdown', () => {\n      numberLine.increment(inc);\n      resize(null, false);\n    }); //app.stage.addChild(button)\n\n    button.draw = () => {\n      if (button.inc == -5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 + 1 / 2 * button.width;\n        button.rotation = Math.PI;\n      } else if (button.inc == 5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 - 1 / 2 * button.width;\n      }\n    };\n\n    return button;\n  }\n\n  function makeStrip(id) {\n    this.graphic = new PIXI.Graphics();\n    app.stage.addChild(this.graphic);\n    this.graphic.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT;\n    this.id = id;\n\n    this.draw = flex => {\n      let t = LINE_THICKNESS / 2;\n      let valA = state.valA,\n          valB = state.valB;\n\n      if (this.id == 0) {\n        let _x = LINE_START;\n\n        let _y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT;\n\n        let _h = STRIP_HEIGHT - 1.5 * t;\n\n        let _w = Math.min(pinA.sprite.x, pinB.sprite.x) - LINE_START;\n\n        if (flex) {\n          TweenLite.to(this.graphic, 1, {\n            x: _x,\n            y: _y,\n            width: _w,\n            height: _h + t\n          });\n        } else {\n          this.graphic.clear();\n          this.graphic.lineStyle(t, CONST.COLORS.BLUE);\n          this.graphic.beginFill(CONST.COLORS.BLUE);\n          this.graphic.drawRoundedRect(0, 0, _w, _h, _h / 10);\n          this.graphic.width = _w;\n          this.graphic.height = _h + t;\n          this.graphic.x = _x;\n          this.graphic.y = _y;\n        }\n      } else if (this.id == 1) {\n        let w = Math.abs(pinA.sprite.x - pinB.sprite.x);\n        this.graphic.clear();\n\n        if (false) {\n          this.graphic.lineStyle(t, CONST.COLORS.BLUE);\n          this.graphic.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT;\n          this.graphic.drawRect(0, 0, w, STRIP_HEIGHT - 1.5 * t);\n        } else {\n          this.graphic.lineStyle(2, CONST.COLORS.ORANGE);\n          this.graphic.beginFill(CONST.COLORS.ORANGE);\n          this.graphic.y = WINDOW_HEIGHT / 2 - STRIP_HEIGHT - t / 4;\n          this.graphic.drawRoundedRect(0, 0, w, STRIP_HEIGHT - t, STRIP_HEIGHT / 10);\n\n          if (w == 0) {\n            this.graphic.alpha = 0;\n          } else {\n            this.graphic.alpha = 1;\n          }\n        }\n\n        this.graphic.x = Math.min(pinA.sprite.x, pinB.sprite.x);\n      }\n    };\n\n    this.draw(0, 8 * DX);\n  }\n\n  function globalPointerUp() {\n    // Ughhh...\n    pinA.sprite.dragging = false;\n    pinB.sprite.dragging = false;\n    pinA.sprite.round();\n    pinB.sprite.round();\n    stripA.draw();\n    stripB.draw();\n    stripALabel.draw();\n    stripBLabel.draw();\n  } // Called on resize\n\n\n  function resize(newFrame, flex) {\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame);\n    app.renderer.resize(WINDOW_WIDTH, WINDOW_HEIGHT);\n    numberLine.draw();\n    backGround.draw();\n    pinA.draw();\n    pinB.draw();\n    stripA.draw(flex);\n    stripB.draw();\n    stripALabel.draw();\n    stripBLabel.draw();\n    incButton.draw();\n    decButton.draw();\n  }\n\n  function updateLayoutParams(newFrame) {\n    let frame;\n\n    if (newFrame) {\n      frame = newFrame;\n    } else {\n      frame = {\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT\n      };\n    }\n\n    WINDOW_WIDTH = frame.width;\n    WINDOW_HEIGHT = frame.height;\n    H_W_RATIO = frame.height / frame.width;\n    LANDSCAPE = H_W_RATIO < 3 / 4;\n    ARENA_WIDTH = LANDSCAPE ? 4 / 3 * frame.height : frame.width;\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3 / 4 * frame.width;\n    LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n    LINE_THICKNESS = LINE_WIDTH / 200;\n    TICK_THICKNESS = LINE_THICKNESS / 2;\n    MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n    DX = LINE_WIDTH / state.lineMax;\n    LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    STRIP_HEIGHT = LINE_WIDTH / 12;\n  } // Loading Script\n\n\n  function load() {\n    backGround = new makeBackground();\n    numberLine = new makeNumberLine();\n    pinA = new makePin(0);\n    pinB = new makePin(1);\n    stripA = new makeStrip(0);\n    stripB = new makeStrip(1);\n    stripALabel = makeStripLabel(0);\n    stripBLabel = makeStripLabel(1);\n    incButton = makeArrowButton(5);\n    decButton = makeArrowButton(-5);\n    stripALabel.draw();\n    stripBLabel.draw();\n    incButton.draw();\n    decButton.draw(); // HELLO!\n\n    if (features.open) {\n      console.log(\"state\", state);\n      stripALabel.alpha = 0;\n      stripBLabel.alpha = 0;\n      numberLine.keep([state.valA, state.valB]);\n    }\n  } // Call load script\n\n\n  load(); // Not sure where else to put this.\n\n  app.resize = frame => resize(frame);\n\n  app.resizable = true;\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/numberlinestrips.js"],"names":["PIXI","CONST","TweenMax","TimelineLite","Power2","Elastic","CSSPlugin","TweenLite","TimelineMax","SSL_OP_TLS_BLOCK_PADDING_BUG","number","ASSETS","init","app","setup","features","labels","open","props","BLUE_TEXTURE","Texture","from","BLUE_CIRCLE","LINE_PERCENTAGE","PIN_TEXTURE","SHARP_PIN","state","valA","valB","lineMax","WINDOW_WIDTH","width","WINDOW_HEIGHT","height","H_W_RATIO","LANDSCAPE","ARENA_WIDTH","ARENA_HEIGHT","LINE_WIDTH","LINE_THICKNESS","TICK_THICKNESS","MAJOR_TICK_HEIGHT","MINOR_TICK_HEIGHT","DX","LINE_START","STRIP_HEIGHT","backGround","numberLine","pinA","pinB","stripA","stripB","stripBLabel","stripALabel","incButton","decButton","activePin","makeNumberLine","tickSpan","labelSpan","max","ticks","line","Graphics","n","lineStyle","x","y","lineTo","draw","stage","addChild","i","newTick","push","newLabel","Text","fontFamily","fontSize","fill","align","anchor","increment","getSetup","keep","values","obj","forEach","v","length","a","console","log","alpha","inc","updateLayoutParams","e","to","style","xr","makeBackground","sprite","Sprite","BLUE_GRADIENT","on","globalPointerUp","interactive","makeStripLabel","label","id","set","txt","Math","round","text","graphic","abs","makePin","texture","onDragStart","onDragMove","onDragEnd","val","rawLineX","event","deltaTouch","data","global","dragging","newPosition","getLocalPosition","parent","makeArrowButton","button","ARROW","resize","rotation","PI","makeStrip","flex","t","_x","_y","_h","_w","min","clear","COLORS","BLUE","beginFill","drawRoundedRect","w","drawRect","ORANGE","newFrame","renderer","frame","load","resizable"],"mappings":"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","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nimport { SSL_OP_TLS_BLOCK_PADDING_BUG } from \"constants\";\nimport { number } from \"prop-types\";\nconst ASSETS = CONST.ASSETS\n\nexport const init = (app, setup) => {\n\n\n  let features = {'strips': true,labels: true,open: false}\n  if (setup.props.features){\n    features = setup.props.features\n  }\n\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE)\n  const LINE_PERCENTAGE = 0.8\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN)\n\n\n // Initial State\n  let state = {\n    valA: 1,\n    valB: 2,\n    lineMax: 20,\n  }\n\n  // Layout Parameters\n  let WINDOW_WIDTH = setup.width\n  let WINDOW_HEIGHT = setup.height\n  let H_W_RATIO = setup.height/setup.width\n  let LANDSCAPE = H_W_RATIO < 3/4\n  let ARENA_WIDTH = LANDSCAPE ? 4/3*setup.height : setup.width\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3/4*setup.width\n  let LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n  let LINE_THICKNESS = LINE_WIDTH/200\n  let TICK_THICKNESS = 2*LINE_THICKNESS/3\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n  let DX = LINE_WIDTH/state.lineMax\n  let LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n  let STRIP_HEIGHT = LINE_WIDTH/12\n\n  // Reference to entities.\n  let backGround;\n  let numberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin;\n\n \n  // Constructors (should not be called on re-draw)\n  function makeNumberLine(){\n     this.tickSpan = 1\n     this.labelSpan = 1\n     this.max = state.lineMax\n     this.ticks = [] // size 120\n     this.labels = []\n     this.line = new PIXI.Graphics()\n\n     this.init = (n) => {\n        this.line.lineStyle(LINE_THICKNESS,0x000000)\n        this.line.x = ARENA_WIDTH/2-LINE_WIDTH/2\n        this.line.y = ARENA_HEIGHT/2\n        this.line.lineTo(LINE_WIDTH,0)\n        this.draw()\n        app.stage.addChild(this.line)\n\n        for (let i = 0;i<120;i++){\n            let newTick = new PIXI.Graphics()\n            newTick.lineStyle(LINE_THICKNESS,0x000000)\n            newTick.x = this.line.x \n            newTick.y = this.line.y - LINE_THICKNESS/2\n            newTick.lineTo(0,MINOR_TICK_HEIGHT)\n            app.stage.addChild(newTick)\n            this.ticks.push(newTick)\n\n            // Setup Labels Here\n            let newLabel = new PIXI.Text(i,{\n              fontFamily: \"Arial\",\n              fontSize: DX/2,\n              fill: \"0x000000\",\n              align: \"center\"\n            })\n            newLabel.anchor.x = 0.5\n            this.labels.push(newLabel)\n            newLabel.x = this.line.x + DX*i\n            newLabel.y = this.line.y + MINOR_TICK_HEIGHT\n            app.stage.addChild(newLabel)\n        }\n        this.increment(0)\n     }\n\n     this.getSetup = ()=> {\n         // update tickspan etc. based on line max.\n     }\n\n     // Could be more efficient by sending object with key value pairs for easy checking. (object.assign?)\n     this.keep = (values)=>{\n       let obj = {0: \"I am here\"};\n       values.forEach(v=>{obj[v] = 'I am here.'})\n       for (let i = 0;i<this.ticks.length;i++){\n        let a = obj[i] ? 1 : 0\n        console.log(\"a\",a)\n        this.ticks[i].alpha = a\n        this.labels[i].alpha = a\n       }\n     }\n\n     this.increment = (inc) => {\n         // Animation go here\n         this.max += inc\n\n         // Update State - (Context Specific)\n         state.lineMax = this.max\n         updateLayoutParams()\n\n         this.ticks.forEach((e,i)=> {\n            if (i > this.max){\n                TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n            } else {\n                TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n            }\n         })\n\n         this.labels.forEach((e,i)=> {\n          if (i > this.max){\n              TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n              TweenLite.to(e,0.5,{alpha: 0})\n          } else {\n              TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n              TweenLite.to(e,0.5,{alpha: 1})\n          }\n       })\n     }\n\n     this.draw = () => {\n        this.line.width = LINE_WIDTH\n        this.line.height = LINE_THICKNESS\n        this.line.x = WINDOW_WIDTH/2 - LINE_WIDTH/2\n        this.line.y = WINDOW_HEIGHT/2\n        this.ticks.forEach((e,i)=> {\n            e.width = TICK_THICKNESS\n            e.height = MINOR_TICK_HEIGHT\n            e.y = this.line.y - LINE_THICKNESS/2\n            if (i > this.max){\n                e.x = LINE_WIDTH + this.line.x \n            } else {\n                e.x =  LINE_WIDTH/this.max*i + this.line.x\n            }\n         })\n         this.labels.forEach((e,i)=> {\n          e.y = this.line.y + MINOR_TICK_HEIGHT\n          e.style.fontSize = DX/2\n          if (i > this.max){\n              e.x = LINE_WIDTH + this.line.x \n          } else {\n              e.x =  LINE_WIDTH/this.max*i + this.line.xr\n          }\n       })\n     }\n     this.init()\n  }\n\n  function makeBackground(){\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH\n    this.sprite.height = WINDOW_HEIGHT\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup',globalPointerUp)\n    this.sprite.interactive = true\n\n    app.stage.addChild(this.sprite)\n\n    this.draw = () => {\n        this.sprite.width = WINDOW_WIDTH\n        this.sprite.height = WINDOW_HEIGHT\n    }\n  }\n\n  function makeStripLabel(n){\n    let label = new PIXI.Text(n,{\n      fontFamily: \"Arial\",\n      fontSize: DX,\n      fill: \"0x000000\",\n      align: \"center\"\n    })\n\n    label.id = n\n    label.anchor.set(0.5)\n\n    label.draw = () => {\n      let {valA,valB} = state\n      if (label.id == 0){\n         label.x = LINE_START + (pinA.sprite.x - LINE_START)/2\n         label.style.fill = 0xffffff\n         let txt = Math.round((pinA.sprite.x - LINE_START)/DX)\n         label.text = txt\n         // Hide if \"subtracting\"\n         if (pinA.sprite.x > pinB.sprite.x){\n           label.x = LINE_START + (pinB.sprite.x - LINE_START)/2\n           label.text = Math.round((pinB.sprite.x - LINE_START)/DX)\n          }\n         if (stripA.graphic.width <= DX){\n           label.y = WINDOW_HEIGHT/2 - 1.5*STRIP_HEIGHT\n         } else {\n           label.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT/2\n         }\n         // Hide for testing purposes\n         //label.alpha = 0\n      } else if (label.id == 1) {\n         label.x = (pinA.sprite.x + pinB.sprite.x)/2\n         label.y = label.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT/2\n         let txt = Math.round(Math.abs(pinA.sprite.x - pinB.sprite.x)/DX)\n         label.text = txt\n         if (stripB.graphic.width <= DX ){\n          label.y = WINDOW_HEIGHT/2 - 1.5*STRIP_HEIGHT\n        } else {\n           label.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT/2\n        }\n      }\n      label.style.fontSize = STRIP_HEIGHT/2\n    }\n    app.stage.addChild(label)\n    return label\n  }\n\n  function makePin(id){\n    this.sprite = new PIXI.Sprite()\n    this.sprite.id = id\n    this.sprite.texture = PIN_TEXTURE\n    this.sprite.interactive = true\n    this.sprite.anchor.x = 0.5\n    this.sprite.on('pointerdown',onDragStart)\n    this.sprite.on('pointermove',onDragMove)\n    this.sprite.on('pointerup',onDragEnd)\n    this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    this.sprite.val = id == 0 ? state.valA : state.valB\n    app.stage.addChild(this.sprite)\n\n    this.sprite.round = () => {\n\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x\n      let n = Math.round(rawLineX/DX)\n\n      // Setting\n      this.sprite.x = numberLine.line.x + n*DX\n      this.sprite.val = n\n\n      // There's gotta be a better pattern than this\n      if (this.sprite.id == 0){\n        state.valA = this.sprite.val\n      } else if (this.sprite.id == 1){\n        state.valB = this.sprite.val\n      }\n\n      // CHECKPOINT!\n      if (features.open){\n        numberLine.keep([state.valA,state.valB])\n      }\n    }\n\n\n\n    this.draw = () => { \n      this.sprite.width = STRIP_HEIGHT\n      this.sprite.height = STRIP_HEIGHT\n      this.sprite.y = WINDOW_HEIGHT/2 + MINOR_TICK_HEIGHT + DX/2\n      this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2 + this.sprite.val*DX\n    }\n    this.draw()\n   }\n\n  // Dragging...\n\n  function onDragStart(event) {\n      app.stage.addChild(this)\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n      this.dragging = true;\n      this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round()\n    stripA.draw()\n    stripB.draw()\n    stripALabel.draw()\n    stripBLabel.draw()\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x;\n      //this.y = newPosition.y + this.deltaTouch.y;\n        state.valA = Math.round((pinA.sprite.x - LINE_START)/DX)\n        state.valB = Math.round((pinB.sprite.x - LINE_START)/DX)\n\n        //numberLine.keep([state.valA,state.valB])\n        stripA.draw()\n        stripB.draw()\n        stripALabel.draw()\n        stripBLabel.draw()\n\n      // Keep within number line bounds\n      if (this.x < WINDOW_WIDTH/2-LINE_WIDTH/2){\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2-LINE_WIDTH/2\n      } else if (this.x > WINDOW_WIDTH/2+LINE_WIDTH/2) {\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2+LINE_WIDTH/2\n      }\n    }\n  }\n\n  function makeArrowButton(inc){\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW)\n    button.inc = inc\n    button.interactive = true\n    button.anchor.set(0.5)\n    button.on('pointerdown',()=>{\n      numberLine.increment(inc)\n      resize(null,false)\n    })\n    //app.stage.addChild(button)\n\n    button.draw = () => {\n      if (button.inc == -5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2 + 1/2*button.width\n        button.rotation = Math.PI\n      } else if (button.inc == 5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2  - 1/2*button.width\n      }\n    }\n    return button\n  }\n \n  function makeStrip(id){\n    this.graphic = new PIXI.Graphics()\n    app.stage.addChild(this.graphic)\n    this.graphic.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT\n    this.id = id\n\n\n    this.draw = (flex) => { \n      let t = LINE_THICKNESS/2\n      let {valA,valB} = state\n      if (this.id == 0){\n          let _x = LINE_START\n          let _y = WINDOW_HEIGHT/2 - STRIP_HEIGHT\n          let _h = STRIP_HEIGHT-1.5*t\n          let _w = Math.min(pinA.sprite.x,pinB.sprite.x) - LINE_START\n          if (flex){\n            TweenLite.to(this.graphic,1,{x: _x,y: _y,width: _w,height: _h+t})\n          } else {\n            this.graphic.clear()\n            this.graphic.lineStyle(t,CONST.COLORS.BLUE)\n            this.graphic.beginFill(CONST.COLORS.BLUE)\n            this.graphic.drawRoundedRect(0,0,_w,_h,_h/10)\n            this.graphic.width = _w \n            this.graphic.height = _h + t\n            this.graphic.x = _x\n            this.graphic.y = _y\n          }\n      } else if (this.id == 1) {\n          let w = Math.abs(pinA.sprite.x - pinB.sprite.x)\n          this.graphic.clear()\n          if (false) {\n            this.graphic.lineStyle(t,CONST.COLORS.BLUE)\n            this.graphic.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT\n            this.graphic.drawRect(0,0,w,STRIP_HEIGHT-1.5*t)\n          } else {\n            this.graphic.lineStyle(2,CONST.COLORS.ORANGE)\n            this.graphic.beginFill(CONST.COLORS.ORANGE)\n            this.graphic.y = WINDOW_HEIGHT/2 - STRIP_HEIGHT - t/4\n            this.graphic.drawRoundedRect(0,0,w,STRIP_HEIGHT-t,STRIP_HEIGHT/10)\n            if(w == 0){\n              this.graphic.alpha = 0\n            } else {\n              this.graphic.alpha = 1\n            }\n          }\n          this.graphic.x = Math.min(pinA.sprite.x,pinB.sprite.x)\n      }\n      \n    }\n    this.draw(0,8*DX)\n  }\n\n  function globalPointerUp(){\n    // Ughhh...\n    pinA.sprite.dragging = false\n    pinB.sprite.dragging = false\n    pinA.sprite.round()\n    pinB.sprite.round()\n    stripA.draw()\n    stripB.draw()\n    stripALabel.draw()\n    stripBLabel.draw()\n  }\n  \n  // Called on resize\n  function resize(newFrame,flex){\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame)\n    app.renderer.resize(WINDOW_WIDTH,WINDOW_HEIGHT)\n    numberLine.draw()\n    backGround.draw()\n    pinA.draw()\n    pinB.draw()\n    stripA.draw(flex)\n    stripB.draw()\n    stripALabel.draw()\n    stripBLabel.draw()\n    incButton.draw()\n    decButton.draw()\n  }\n\n  function updateLayoutParams(newFrame){\n    let frame;\n    if (newFrame){\n      frame = newFrame\n    } else {\n      frame = {width: WINDOW_WIDTH,height: WINDOW_HEIGHT}\n    }\n    WINDOW_WIDTH = frame.width\n    WINDOW_HEIGHT = frame.height\n    H_W_RATIO = frame.height/frame.width\n    LANDSCAPE = H_W_RATIO < 3/4\n    ARENA_WIDTH = LANDSCAPE ? 4/3*frame.height : frame.width\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3/4*frame.width\n    LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n    LINE_THICKNESS = LINE_WIDTH/200\n    TICK_THICKNESS = LINE_THICKNESS/2\n    MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n    DX = LINE_WIDTH/state.lineMax\n    LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    STRIP_HEIGHT = LINE_WIDTH/12\n  }\n\n  // Loading Script\n  function load(){\n    backGround = new makeBackground()\n    numberLine = new makeNumberLine()\n    pinA = new makePin(0)\n    pinB = new makePin(1)\n    stripA = new makeStrip(0)\n    stripB = new makeStrip(1)\n    stripALabel = makeStripLabel(0)\n    stripBLabel = makeStripLabel(1)\n\n\n    incButton = makeArrowButton(5)\n    decButton = makeArrowButton(-5)\n    stripALabel.draw()\n    stripBLabel.draw()\n    incButton.draw()\n    decButton.draw()\n\n    // HELLO!\n    if (features.open){\n      console.log(\"state\",state)\n      stripALabel.alpha = 0\n      stripBLabel.alpha = 0\n      numberLine.keep([state.valA,state.valB])\n    }\n  }\n\n  // Call load script\n  load()\n  // Not sure where else to put this.\n  app.resize = (frame) => resize(frame)\n  app.resizable = true\n};\n"]},"metadata":{},"sourceType":"module"}