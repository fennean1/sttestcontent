{"ast":null,"code":"import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nconst ASSETS = CONST.ASSETS;\nexport const init = (app, setup) => {\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE);\n  const LINE_PERCENTAGE = 0.8;\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN);\n  const MEASURE_PIN_TEXTURE = new PIXI.Texture.from(ASSETS.MEASURE_PIN); // Initial State\n\n  let state = {\n    valA: 16,\n    valB: 16,\n    lineMax: 30\n  };\n  console.log(\"setupwidth\", setup.width);\n  console.log(\"windowheight\", window.innerHeight); // Layout Parameters\n\n  let WINDOW_WIDTH = setup.width;\n  let WINDOW_HEIGHT = setup.height;\n  let H_W_RATIO = setup.height / setup.width;\n  let LANDSCAPE = H_W_RATIO < 3 / 4;\n  let ARENA_WIDTH = LANDSCAPE ? 4 / 3 * setup.height : setup.width;\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3 / 4 * setup.width;\n  let LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n  let LINE_THICKNESS = LINE_WIDTH / 200;\n  let TICK_THICKNESS = 2 * LINE_THICKNESS / 3;\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n  let DX = LINE_WIDTH / state.lineMax;\n  let LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n  let STRIP_HEIGHT = LINE_WIDTH / 12;\n  let TOP_LINE_Y = WINDOW_HEIGHT / 4;\n  let BOTTOM_LINE_Y = WINDOW_HEIGHT * 3 / 4;\n  let BAR_HEIGHT = (BOTTOM_LINE_Y - TOP_LINE_Y) / 5;\n  let BAR_STEP = (BOTTOM_LINE_Y - TOP_LINE_Y) / 4;\n  let INC_BUTTONS_HEIGHT = BAR_HEIGHT * 0.7;\n  let DY = (BOTTOM_LINE_Y - TOP_LINE_Y - 4 * BAR_HEIGHT) / 3;\n  let Y1 = BOTTOM_LINE_Y - BAR_HEIGHT;\n  let Y2 = BOTTOM_LINE_Y - 2 * BAR_HEIGHT - DY;\n  let Y3 = BOTTOM_LINE_Y - 3 * BAR_HEIGHT - 2 * DY;\n  let Y4 = TOP_LINE_Y;\n  let ANCHORS = [Y1, Y2, Y3, Y4]; // RELEVENT\n\n  let ActiveRow;\n  let ActiveIndex = 0;\n  let FirstRow;\n  let SecondRow;\n  let ThirdRow;\n  let FourthRow;\n  var Rows;\n  let PlusButton = new PIXI.Sprite.from(ASSETS.PLUS_SQUARE);\n  PlusButton.interactive = true;\n  PlusButton.anchor.set(0.5);\n  PlusButton.on('pointerdown', () => {\n    PlusButton.interactive = false;\n    incActiveFrac(1);\n    setTimeout(() => {\n      PlusButton.interactive = true;\n    }, 300);\n  });\n  PlusButton.width = INC_BUTTONS_HEIGHT;\n  PlusButton.height = INC_BUTTONS_HEIGHT;\n  let MinusButton = new PIXI.Sprite.from(ASSETS.MINUS_SQUARE);\n  MinusButton.interactive = true;\n  MinusButton.anchor.set(0.5);\n  MinusButton.on('pointerdown', () => {\n    MinusButton.interactive = false;\n    incActiveFrac(-1);\n    setTimeout(() => {\n      MinusButton.interactive = true;\n    }, 300);\n  });\n  MinusButton.width = BAR_HEIGHT / 2.5;\n  MinusButton.height = BAR_HEIGHT / 2.5;\n\n  function placeButtons() {\n    let w = ActiveRow.container.width;\n    let h = ActiveRow.container.height;\n    let x = ActiveRow.container.x + w;\n    let y = ActiveRow.container.y;\n    PlusButton.width = INC_BUTTONS_HEIGHT;\n    PlusButton.height = INC_BUTTONS_HEIGHT;\n    MinusButton.width = INC_BUTTONS_HEIGHT;\n    MinusButton.height = INC_BUTTONS_HEIGHT;\n    PlusButton.x = x + BAR_HEIGHT / 2;\n    PlusButton.y = y + BAR_HEIGHT / 2;\n    MinusButton.x = x - w - BAR_HEIGHT / 2;\n    MinusButton.y = y + BAR_HEIGHT / 2;\n  }\n\n  let LeftWhisker = new PIXI.Graphics();\n  let RightWhisker = new PIXI.Graphics();\n  let MiddleWhisker = new PIXI.Graphics();\n  let A;\n  let B; // Reference to entities. - deprecated.\n\n  let backGround;\n  let numberLine;\n  let topNumberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin;\n\n  function incActiveFrac(inc) {\n    ActiveRow.incDenonimator(inc);\n  } // Constructors (should not be called on re-draw)\n\n\n  function makeNumberLine(flip) {\n    this.tickSpan = 1;\n    this.labelSpan = 1;\n    this.max = state.lineMax;\n    this.ticks = []; // size 120\n\n    this.labels = [];\n    this.line = new PIXI.Graphics();\n\n    this.init = n => {\n      this.line.lineStyle(LINE_THICKNESS, 0x000000);\n      this.line.x = LINE_START;\n      this.line.y = ARENA_HEIGHT / 2;\n      this.line.lineTo(LINE_WIDTH, 0);\n      app.stage.addChild(this.line);\n\n      for (let i = 0; i < 120; i++) {\n        let newTick = new PIXI.Graphics();\n        newTick.lineStyle(LINE_THICKNESS, 0x000000);\n        newTick.x = this.line.x;\n\n        if (flip) {\n          newTick.y = this.line.y + LINE_THICKNESS / 2;\n          newTick.lineTo(0, -MINOR_TICK_HEIGHT);\n        } else {\n          newTick.y = this.line.y - LINE_THICKNESS / 2;\n          newTick.lineTo(0, MINOR_TICK_HEIGHT);\n        }\n\n        app.stage.addChild(newTick);\n        this.ticks.push(newTick); // Setup Labels Here\n\n        let newLabel = new PIXI.Text(i, {\n          fontFamily: \"Arial\",\n          fontSize: DX / 2,\n          fill: \"0x000000\",\n          align: \"center\"\n        });\n        newLabel.anchor.x = 0.5;\n        this.labels.push(newLabel);\n        newLabel.x = this.line.x + DX * i;\n        newLabel.y = this.line.y + MINOR_TICK_HEIGHT;\n\n        if (flip) {\n          newLabel.y = this.line.y - 2 * MINOR_TICK_HEIGHT;\n          newLabel.anchor.y = 1;\n          newLabel.text.anchor.y = 0.5;\n        }\n\n        app.stage.addChild(newLabel);\n      }\n\n      this.increment(0);\n    };\n\n    this.getSetup = () => {// update tickspan etc. based on line max.\n    };\n\n    this.increment = inc => {\n      // Animation go here\n      this.max += inc; // Update State - (Context Specific)\n\n      state.lineMax = this.max;\n      updateLayoutParams();\n      this.ticks.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n        }\n      });\n      this.labels.forEach((e, i) => {\n        if (i > this.max) {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 0\n          });\n        } else {\n          TweenLite.to(e, 0.5, {\n            x: LINE_WIDTH / this.max * i + this.line.x\n          });\n          TweenLite.to(e, 0.5, {\n            alpha: 1\n          });\n        }\n      });\n    };\n\n    this.draw = () => {\n      let _y;\n\n      if (flip) {\n        _y = TOP_LINE_Y;\n      } else {\n        _y = BOTTOM_LINE_Y;\n      }\n\n      this.line.width = LINE_WIDTH;\n      this.line.height = LINE_THICKNESS;\n      this.line.x = LINE_START;\n      this.line.y = _y;\n      this.ticks.forEach((e, i) => {\n        e.width = TICK_THICKNESS;\n        e.height = MINOR_TICK_HEIGHT;\n        e.y = this.line.y - LINE_THICKNESS / 2;\n\n        if (flip) {\n          e.y = this.line.y + LINE_THICKNESS / 2;\n        }\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.x;\n        }\n      });\n      this.labels.forEach((e, i) => {\n        e.y = this.line.y + MINOR_TICK_HEIGHT;\n\n        if (flip) {\n          e.y = this.line.y - MINOR_TICK_HEIGHT;\n        }\n\n        e.style.fontSize = DX / 2;\n\n        if (i > this.max) {\n          e.x = LINE_WIDTH + this.line.x;\n        } else {\n          e.x = LINE_WIDTH / this.max * i + this.line.x;\n        }\n      });\n    };\n\n    this.init();\n  }\n\n  function makeBackground() {\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH;\n    this.sprite.height = WINDOW_HEIGHT;\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup', globalPointerUp);\n    this.sprite.interactive = true;\n    app.stage.addChild(this.sprite);\n\n    this.draw = () => {\n      this.sprite.width = WINDOW_WIDTH;\n      this.sprite.height = WINDOW_HEIGHT;\n    };\n  }\n\n  function makePin(id) {\n    this.sprite = new PIXI.Sprite();\n    this.sprite.id = id;\n    this.sprite.texture = PIN_TEXTURE;\n    this.sprite.interactive = true;\n    this.sprite.anchor.x = 0.5;\n    this.sprite.scale.y = id == 0 ? 1 : -1;\n\n    if (id == 0) {\n      this.sprite.on('pointerdown', onDragStart);\n      this.sprite.on('pointermove', onDragMove);\n      this.sprite.on('pointerup', onDragEnd);\n    } else if (id == 1) {\n      this.sprite.on('pointerdown', onBDragStart);\n      this.sprite.on('pointermove', onBDragMove);\n      this.sprite.on('pointerup', onBDragEnd);\n    }\n\n    this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    this.sprite.val = 16; // Removing pin B for now\n\n    if (id == 0) {\n      app.stage.addChild(this.sprite);\n    }\n\n    this.sprite.round = () => {\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x;\n      let n = Math.round(rawLineX / DX); // Setting\n\n      this.sprite.x = numberLine.line.x + n * DX;\n      this.sprite.val = n;\n      drawWhiskers(); // There's gotta be a better pattern than this\n\n      if (this.sprite.id == 0) {\n        state.valA = this.sprite.val;\n      } else if (this.sprite.id == 1) {\n        state.valB = this.sprite.val;\n      }\n    };\n\n    this.draw = () => {\n      this.sprite.width = STRIP_HEIGHT;\n      this.sprite.height = STRIP_HEIGHT;\n      this.sprite.y = BOTTOM_LINE_Y + MINOR_TICK_HEIGHT + DX / 2;\n      this.sprite.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2 + this.sprite.val * DX;\n    };\n\n    this.draw();\n  }\n\n  function onBDragStart(event) {\n    app.stage.addChild(this);\n    app.stage.addChild(MiddleWhisker);\n    this.deltaTouch = {\n      x: this.x - event.data.global.x,\n      y: this.y - event.data.global.y\n    };\n    this.dragging = true;\n    this.data = event.data;\n  }\n\n  function onBDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    drawWhiskers();\n    placeButtons();\n  }\n\n  function onBDragMove(event) {\n    if (this.dragging) {\n      drawWhiskers();\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x; // Keep within number line bounds.\n\n      if (this.x < WINDOW_WIDTH / 2 - LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      } else if (this.x > WINDOW_WIDTH / 2 + LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 + LINE_WIDTH / 2;\n      }\n    }\n  } // Pin Drag Functions\n\n\n  function onDragStart(event) {\n    app.stage.addChild(this);\n    this.deltaTouch = {\n      x: this.x - event.data.global.x,\n      y: this.y - event.data.global.y\n    };\n    this.dragging = true;\n    this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round();\n    ActiveRow.setValue();\n    ActiveRow.draw(this.x - LINE_START);\n    drawWhiskers();\n    placeButtons();\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let width = this.x - LINE_START;\n      ActiveRow.draw(width);\n      drawWhiskers();\n      placeButtons();\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x; // Keep within number line bounds.\n\n      if (this.x < WINDOW_WIDTH / 2 - LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n      } else if (this.x > WINDOW_WIDTH / 2 + LINE_WIDTH / 2) {\n        this.dragging = false;\n        this.x = WINDOW_WIDTH / 2 + LINE_WIDTH / 2;\n      }\n    }\n  }\n\n  function makeArrowButton(inc) {\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW);\n    button.inc = inc;\n    button.interactive = true;\n    button.anchor.set(0.5);\n    button.on('pointerdown', () => {\n      numberLine.increment(inc);\n      topNumberLine.increment(inc);\n      resize(null, false);\n    }); //app.stage.addChild(button)\n\n    button.draw = () => {\n      if (button.inc == -5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 + 1 / 2 * button.width;\n        button.rotation = Math.PI;\n      } else if (button.inc == 5) {\n        button.width = STRIP_HEIGHT / 2;\n        button.height = STRIP_HEIGHT / 2;\n        button.x = WINDOW_WIDTH - 1.1 * button.width;\n        button.y = WINDOW_HEIGHT / 2 - 1 / 2 * button.width;\n      }\n    };\n\n    return button;\n  }\n\n  app.stage.on('pointerdown', resizeLine);\n  app.stage.interactive = true;\n\n  function resizeLine(event) {}\n\n  function Row(num, den, width, ID) {\n    // Internal Params\n    let touching = true;\n    let activated = true;\n    this.value = 0; // Default values\n\n    this.numerator = num;\n    this.denominator = den;\n    this.width = width;\n    this.id = ID;\n    this.container = new PIXI.Container();\n    this.container.id = ID;\n    this.container.width = width;\n    this.container.interactive = true;\n    this.container.y = BOTTOM_LINE_Y - BAR_HEIGHT;\n    this.container.x = LINE_START;\n    this.sprites = [];\n    this.blockWidth = width / this.denominator;\n    this.blockA = new PIXI.Graphics();\n    this.blockA.lineStyle(3, 0x000000);\n    this.blockA.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n    let myA = app.renderer.generateTexture(this.blockA);\n    this.blockB = new PIXI.Graphics();\n    this.blockB.beginFill(0xff4772);\n    this.blockB.lineStyle(3, 0x000000);\n    this.blockB.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n    let myB = app.renderer.generateTexture(this.blockB);\n    let g = new PIXI.Graphics();\n\n    this.incDenonimator = inc => {\n      console.log(\"this denomonicator - inc\", this.denominator - inc);\n\n      if (this.denominator + inc >= 1) {\n        console.log(\"shouldn't exectuve if this.denominator is equal to 1\", this.denominator);\n        g.clear();\n        g.lineStyle(3, 0x000000);\n        g.drawRoundedRect(0, 0, this.width, BAR_HEIGHT, 1);\n        let R = app.renderer.generateTexture(g);\n        let s = new PIXI.Sprite();\n        this.container.addChild(s);\n        s.texture = R;\n        s.x = 0;\n\n        if (inc > 0) {\n          const onComplete = () => {\n            s.on('pointerdown', spritePointerDown);\n            s.on('pointerup', spritePointerUp);\n            s.on('pointermove', spritePointerMoved);\n            s.interactive = true;\n            s.active = false;\n            this.sprites.push(s);\n            this.draw();\n          };\n\n          TweenMax.to(this, 0.25, {\n            denominator: this.denominator + 1,\n            onUpdate: this.draw,\n            onComplete: onComplete\n          });\n        } else if (inc < 0) {\n          let removeme = this.sprites.pop();\n          this.container.removeChild(removeme);\n\n          const onComplete = () => {\n            this.draw();\n            this.container.removeChild(s);\n          };\n\n          TweenMax.to(this, 0.25, {\n            denominator: this.denominator - 1,\n            onUpdate: this.draw,\n            onComplete: onComplete\n          });\n        }\n      }\n    };\n\n    this.setValue = () => {\n      this.value = Math.round(this.width / LINE_WIDTH * state.lineMax);\n      console.log(\"this.value\", this.value);\n    };\n\n    this.draw = width => {\n      if (width) {\n        this.width = width;\n      }\n\n      this.blockWidth = this.width / this.denominator;\n      this.blockA.clear();\n      this.blockA.lineStyle(3, 0x000000);\n      this.blockA.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      myA = app.renderer.generateTexture(this.blockA);\n      this.blockB.clear();\n      this.blockB.beginFill(0xff4772);\n      this.blockB.lineStyle(3, 0x000000);\n      this.blockB.drawRoundedRect(0, 0, this.blockWidth, BAR_HEIGHT, 1);\n      myB = app.renderer.generateTexture(this.blockB);\n\n      for (let i = 0; i < this.sprites.length; i++) {\n        if (this.sprites[i].active) {\n          this.sprites[i].texture = myB;\n        } else {\n          this.sprites[i].texture = myA;\n        }\n\n        this.sprites[i].x = this.blockWidth * i;\n        this.sprites[i].y = 0;\n      } //.this.container.y = ANCHORS[this.id]\n\n    };\n\n    for (let i = 0; i < this.denominator; i++) {\n      console.log(\"balls\");\n      let s = new PIXI.Sprite.from(myA);\n      s.on('pointerdown', spritePointerDown);\n      s.on('pointerup', spritePointerUp);\n      s.on('pointermove', spritePointerMoved);\n      s.interactive = true;\n      s.active = false;\n      s.x = i * LINE_WIDTH / this.denominator;\n      s.y = WINDOW_HEIGHT / 2 - BAR_HEIGHT;\n      this.sprites.push(s);\n      this.container.addChild(s);\n    } //  Attached methods\n\n\n    this.container.on('pointerdown', containerPointerDown);\n    this.container.on('pointerup', containerPointerUp);\n    this.container.on('pointermove', containerPointerMove); // Add children\n\n    app.stage.addChild(this.container);\n    this.width = this.container.width;\n\n    function spritePointerDown(event) {\n      this.touched = true;\n      this.dragged = false;\n    }\n\n    function spritePointerMoved(event) {\n      if (this.touched) {\n        console.log(\"pointermove\");\n        this.dragged = true;\n      }\n    }\n\n    function spritePointerUp(event) {\n      this.touched = false;\n      console.log('this.draggeed', this.dragged);\n\n      if (!this.dragged && activated) {\n        this.dragged = false;\n        this.active = !this.active;\n        this.alpha = 0.2;\n        this.texture = this.active ? myB : myA;\n        TweenLite.to(this, 0.4, {\n          alpha: 1\n        });\n      }\n    }\n\n    function containerPointerDown(event) {\n      app.stage.addChild(this);\n      activated = this.id == ActiveIndex;\n      ActiveIndex = this.id;\n      ActiveRow = Rows[ActiveIndex];\n      disableAllRowsExceptActive();\n      drawWhiskers();\n      placeButtons();\n      pinA.sprite.x = this.width + LINE_START;\n      pinA.sprite.round();\n      this.data = event.data;\n      this.startWidth = this.width;\n      this.dragStartY = event.data.global.y;\n      this.touching = true;\n      touching = true;\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      };\n    }\n\n    function containerPointerUp(event) {\n      globalPointerUp();\n      this.touching = false;\n      touching = false;\n    }\n\n    function containerPointerMove(event) {\n      if (this.touching) {\n        const newPosition = this.data.getLocalPosition(this.parent);\n        this.y = event.data.global.y + this.deltaTouch.y; // Keep within number line bounds.\n\n        if (this.y < TOP_LINE_Y) {\n          this.dragging = false;\n          this.y = TOP_LINE_Y;\n        } else if (this.y > BOTTOM_LINE_Y - BAR_HEIGHT) {\n          this.dragging = false;\n          this.y = BOTTOM_LINE_Y - BAR_HEIGHT;\n        } //this.x = event.data.global.x + this.deltaTouch.x\n        //pinA.sprite.x = this.x + this.width\n\n\n        this.dragged = true;\n        drawWhiskers();\n        placeButtons();\n      }\n    }\n\n    this.draw(width);\n    this.setValue();\n  }\n\n  function disableAllRowsExceptActive() {\n    Rows.forEach((r, i) => {\n      if (i != ActiveIndex) {\n        r.container.interactive = false;\n        r.sprites.forEach(s => {\n          s.interactive = false;\n        });\n      }\n    });\n  }\n\n  function reEnableAllRows() {\n    console.log(\"reinableing all rows\");\n    Rows.forEach((r, i) => {\n      r.container.interactive = true;\n      r.sprites.forEach(s => {\n        s.interactive = true;\n        s.dragged = false;\n        s.touched = false;\n        s.dragging = false;\n      });\n    });\n  }\n\n  function swapRows() {\n    let index;\n    ANCHORS.forEach((a, i) => {\n      let d = Math.abs(a - ActiveRow.container.y);\n\n      if (d < BAR_STEP / 2) {\n        index = i;\n      }\n    }); // swap \n\n    if (ActiveIndex != index) {\n      console.log(\"swapping\", Rows);\n      let e = ActiveRow;\n      Rows.splice(ActiveIndex, 1);\n      Rows.splice(index, 0, e);\n      console.log(\"swapped\", Rows);\n      ActiveIndex = index;\n    }\n\n    Rows.forEach((r, i) => {\n      r.container.touching = false;\n      r.container.dragged = false;\n      r.container.dragging = false;\n      r.id = i;\n      r.container.id = i;\n      TweenMax.to(r.container, 0.2, {\n        y: ANCHORS[i],\n        onComplete: reEnableAllRows\n      });\n    });\n\n    const onComplete = () => {\n      RightWhisker.clear();\n      RightWhisker.lineStyle(LINE_THICKNESS / 2, 0x000000);\n      RightWhisker.moveTo(pinA.sprite.x, ActiveRow.container.y);\n      RightWhisker.lineTo(pinA.sprite.x, numberLine.line.y);\n    };\n\n    TweenMax.to(PlusButton, 0.2, {\n      y: ANCHORS[ActiveIndex] + BAR_HEIGHT / 2,\n      alpha: 1,\n      onUpdate: drawWhiskers\n    });\n    TweenMax.to(MinusButton, 0.2, {\n      y: ANCHORS[ActiveIndex] + 1 / 2 * BAR_HEIGHT,\n      alpha: 1\n    }); //drawWhiskers()\n  }\n\n  class Rowwow extends PIXI.Sprite {\n    constructor() {\n      super();\n      console.log(\"this\", this);\n      let graphics = new PIXI.Graphics();\n      this.addChild(graphics);\n      console.log(\"Graphbics parent\", graphics.parent.balls());\n    }\n\n    balls(input) {\n      console.log(\"balls called\");\n\n      if (input) {\n        return this.balls(false);\n      }\n    }\n\n  }\n\n  let ROWWOW = new Rowwow();\n\n  function drawWhiskers() {\n    let WHISKER_THICKNESS = LINE_THICKNESS / 2;\n    LeftWhisker.clear();\n    LeftWhisker.lineStyle(WHISKER_THICKNESS, 0x000000);\n    LeftWhisker.moveTo(ActiveRow.container.x, ActiveRow.container.y);\n    LeftWhisker.lineTo(ActiveRow.container.x, numberLine.line.y);\n    RightWhisker.clear();\n    RightWhisker.lineStyle(WHISKER_THICKNESS, 0x000000);\n    RightWhisker.moveTo(pinA.sprite.x, ActiveRow.container.y);\n    RightWhisker.lineTo(pinA.sprite.x, numberLine.line.y);\n    MiddleWhisker.clear();\n    MiddleWhisker.lineStyle(WHISKER_THICKNESS, 0x000000);\n    MiddleWhisker.moveTo(pinB.sprite.x, topNumberLine.line.y);\n    MiddleWhisker.lineTo(pinB.sprite.x, numberLine.line.y);\n  }\n\n  function globalPointerUp() {\n    // Ughhh...\n    ActiveRow.container.touching = false;\n    pinA.sprite.dragging = false;\n    pinA.sprite.round();\n    pinB.sprite.dragging = false;\n    ActiveRow.draw(pinA.sprite.x - LINE_START);\n    drawWhiskers();\n    placeButtons();\n    swapRows(); //pinB.sprite.round()\n    //stripA.draw()\n    //stripB.draw()\n    //stripALabel.draw()\n    //stripBLabel.draw()\n  } // Called on resize\n\n\n  function resize(newFrame, flex) {\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame);\n    app.renderer.resize(WINDOW_WIDTH, WINDOW_HEIGHT);\n    numberLine.draw();\n    topNumberLine.draw();\n    backGround.draw();\n    pinA.draw();\n    pinB.sprite.x = LINE_START;\n    incButton.draw();\n    decButton.draw();\n    Rows.forEach((r, i) => {\n      r.draw(r.value / state.lineMax * LINE_WIDTH);\n      r.container.x = LINE_START;\n      r.container.y = ANCHORS[i];\n    });\n    drawWhiskers();\n    placeButtons();\n  }\n\n  function updateLayoutParams(newFrame) {\n    let frame;\n\n    if (newFrame) {\n      frame = newFrame;\n    } else {\n      frame = {\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT\n      };\n    }\n\n    WINDOW_WIDTH = frame.width;\n    WINDOW_HEIGHT = frame.height;\n    H_W_RATIO = frame.height / frame.width;\n    LANDSCAPE = H_W_RATIO < 3 / 4;\n    ARENA_WIDTH = LANDSCAPE ? 4 / 3 * frame.height : frame.width;\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3 / 4 * frame.width;\n    LINE_WIDTH = LINE_PERCENTAGE * WINDOW_WIDTH;\n    LINE_THICKNESS = LINE_WIDTH / 200;\n    TICK_THICKNESS = LINE_THICKNESS / 2;\n    MAJOR_TICK_HEIGHT = LINE_WIDTH / 20;\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT / 2;\n    DX = LINE_WIDTH / state.lineMax;\n    LINE_START = WINDOW_WIDTH / 2 - LINE_WIDTH / 2;\n    STRIP_HEIGHT = LINE_WIDTH / 12;\n    BAR_HEIGHT = (BOTTOM_LINE_Y - TOP_LINE_Y) / 5;\n    BAR_STEP = (BOTTOM_LINE_Y - TOP_LINE_Y) / 4;\n    DY = (BOTTOM_LINE_Y - TOP_LINE_Y - 4 * BAR_HEIGHT) / 3;\n    Y1 = BOTTOM_LINE_Y - BAR_HEIGHT;\n    Y2 = BOTTOM_LINE_Y - 2 * BAR_HEIGHT - DY;\n    Y3 = BOTTOM_LINE_Y - 3 * BAR_HEIGHT - 2 * DY;\n    Y4 = TOP_LINE_Y;\n    ANCHORS = [Y1, Y2, Y3, Y4];\n  } // Loading Script\n\n\n  function load() {\n    let features = {\n      'strips': true\n    };\n\n    if (setup.props.features) {\n      features = setup.props.features;\n    }\n\n    backGround = new makeBackground(); // Number Lines\n\n    numberLine = new makeNumberLine();\n    numberLine.draw();\n    topNumberLine = new makeNumberLine(true);\n    topNumberLine.draw();\n    pinA = new makePin(0);\n    pinA.sprite.y = BOTTOM_LINE_Y + 2 * MINOR_TICK_HEIGHT;\n    pinA.sprite.x = LINE_START + LINE_WIDTH / 2;\n    pinB = new makePin(1);\n    pinB.sprite.y = TOP_LINE_Y - 1.65 * MINOR_TICK_HEIGHT;\n    pinB.sprite.x = LINE_START;\n    pinA.draw();\n    incButton = makeArrowButton(5);\n    decButton = makeArrowButton(-5);\n    incButton.draw();\n    decButton.draw();\n    FirstRow = new Row(0, 5, pinA.sprite.x - LINE_START, 0);\n    SecondRow = new Row(0, 4, pinA.sprite.x - LINE_START, 1);\n    ThirdRow = new Row(0, 3, pinA.sprite.x - LINE_START, 2);\n    FourthRow = new Row(0, 2, pinA.sprite.x - LINE_START, 3);\n    FirstRow.container.y = BOTTOM_LINE_Y - BAR_HEIGHT;\n    SecondRow.container.y = BOTTOM_LINE_Y - 2 * BAR_HEIGHT - DY;\n    ThirdRow.container.y = BOTTOM_LINE_Y - 3 * BAR_HEIGHT - 2 * DY;\n    FourthRow.container.y = TOP_LINE_Y;\n    Rows = [FirstRow, SecondRow, ThirdRow, FourthRow];\n    ActiveRow = Rows[ActiveIndex];\n    app.stage.addChild(LeftWhisker);\n    app.stage.addChild(RightWhisker);\n    app.stage.addChild(MiddleWhisker);\n    app.stage.addChild(PlusButton);\n    app.stage.addChild(MinusButton);\n    drawWhiskers();\n    placeButtons();\n  } // Call load script\n\n\n  load(); // Not sure where else to put this.\n\n  app.resize = frame => resize(frame);\n\n  app.resizable = true;\n};","map":{"version":3,"sources":["/Users/andrewfenner/Documents/MindResearch/Prototypes/newtestunit/src/js/fractionstacks.js"],"names":["PIXI","CONST","TweenMax","TimelineLite","Power2","Elastic","CSSPlugin","TweenLite","TimelineMax","ASSETS","init","app","setup","BLUE_TEXTURE","Texture","from","BLUE_CIRCLE","LINE_PERCENTAGE","PIN_TEXTURE","SHARP_PIN","MEASURE_PIN_TEXTURE","MEASURE_PIN","state","valA","valB","lineMax","console","log","width","window","innerHeight","WINDOW_WIDTH","WINDOW_HEIGHT","height","H_W_RATIO","LANDSCAPE","ARENA_WIDTH","ARENA_HEIGHT","LINE_WIDTH","LINE_THICKNESS","TICK_THICKNESS","MAJOR_TICK_HEIGHT","MINOR_TICK_HEIGHT","DX","LINE_START","STRIP_HEIGHT","TOP_LINE_Y","BOTTOM_LINE_Y","BAR_HEIGHT","BAR_STEP","INC_BUTTONS_HEIGHT","DY","Y1","Y2","Y3","Y4","ANCHORS","ActiveRow","ActiveIndex","FirstRow","SecondRow","ThirdRow","FourthRow","Rows","PlusButton","Sprite","PLUS_SQUARE","interactive","anchor","set","on","incActiveFrac","setTimeout","MinusButton","MINUS_SQUARE","placeButtons","w","container","h","x","y","LeftWhisker","Graphics","RightWhisker","MiddleWhisker","A","B","backGround","numberLine","topNumberLine","pinA","pinB","stripA","stripB","stripBLabel","stripALabel","incButton","decButton","activePin","inc","incDenonimator","makeNumberLine","flip","tickSpan","labelSpan","max","ticks","labels","line","n","lineStyle","lineTo","stage","addChild","i","newTick","push","newLabel","Text","fontFamily","fontSize","fill","align","text","increment","getSetup","updateLayoutParams","forEach","e","to","alpha","draw","_y","style","makeBackground","sprite","BLUE_GRADIENT","globalPointerUp","makePin","id","texture","scale","onDragStart","onDragMove","onDragEnd","onBDragStart","onBDragMove","onBDragEnd","val","round","rawLineX","Math","drawWhiskers","event","deltaTouch","data","global","dragging","newPosition","getLocalPosition","parent","setValue","makeArrowButton","button","ARROW","resize","rotation","PI","resizeLine","Row","num","den","ID","touching","activated","value","numerator","denominator","Container","sprites","blockWidth","blockA","drawRoundedRect","myA","renderer","generateTexture","blockB","beginFill","myB","g","clear","R","s","onComplete","spritePointerDown","spritePointerUp","spritePointerMoved","active","onUpdate","removeme","pop","removeChild","length","containerPointerDown","containerPointerUp","containerPointerMove","touched","dragged","disableAllRowsExceptActive","startWidth","dragStartY","r","reEnableAllRows","swapRows","index","a","d","abs","splice","moveTo","Rowwow","constructor","graphics","balls","input","ROWWOW","WHISKER_THICKNESS","newFrame","flex","frame","load","features","props","resizable"],"mappings":"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","sourcesContent":["import * as PIXI from \"pixi.js\";\nimport * as CONST from \"./const.js\";\nimport { TweenMax, TimelineLite, Power2, Elastic, CSSPlugin, TweenLite, TimelineMax } from \"gsap/TweenMax\";\nconst ASSETS = CONST.ASSETS\n\nexport const init = (app, setup) => {\n\n  // Constants\n  const BLUE_TEXTURE = new PIXI.Texture.from(CONST.ASSETS.BLUE_CIRCLE)\n  const LINE_PERCENTAGE = 0.8\n  const PIN_TEXTURE = new PIXI.Texture.from(ASSETS.SHARP_PIN)\n  const MEASURE_PIN_TEXTURE = new PIXI.Texture.from(ASSETS.MEASURE_PIN)\n\n\n // Initial State\n  let state = {\n    valA: 16,\n    valB: 16,\n    lineMax: 30,\n  }\n\n  console.log(\"setupwidth\",setup.width)\n  console.log(\"windowheight\",window.innerHeight)\n\n  // Layout Parameters\n  let WINDOW_WIDTH = setup.width\n  let WINDOW_HEIGHT = setup.height\n  let H_W_RATIO = setup.height/setup.width\n  let LANDSCAPE = H_W_RATIO < 3/4\n  let ARENA_WIDTH = LANDSCAPE ? 4/3*setup.height : setup.width\n  let ARENA_HEIGHT = LANDSCAPE ? setup.height : 3/4*setup.width\n  let LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n  let LINE_THICKNESS = LINE_WIDTH/200\n  let TICK_THICKNESS = 2*LINE_THICKNESS/3\n  let MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n  let MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n  let DX = LINE_WIDTH/state.lineMax\n  let LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n  let STRIP_HEIGHT = LINE_WIDTH/12\n  let TOP_LINE_Y = WINDOW_HEIGHT/4\n  let BOTTOM_LINE_Y = WINDOW_HEIGHT*3/4\n  let BAR_HEIGHT = (BOTTOM_LINE_Y - TOP_LINE_Y)/5\n  let BAR_STEP = (BOTTOM_LINE_Y - TOP_LINE_Y)/4\n  let INC_BUTTONS_HEIGHT = BAR_HEIGHT*0.7\n  let DY = (BOTTOM_LINE_Y - TOP_LINE_Y - 4*BAR_HEIGHT)/3\n  let Y1 =  BOTTOM_LINE_Y - BAR_HEIGHT\n  let Y2 = BOTTOM_LINE_Y - 2*BAR_HEIGHT - DY\n  let Y3 = BOTTOM_LINE_Y - 3*BAR_HEIGHT - 2*DY\n  let Y4 = TOP_LINE_Y\n  let ANCHORS = [Y1,Y2,Y3,Y4]   \n\n\n\n\n\n  // RELEVENT\n  let ActiveRow;\n  let ActiveIndex = 0\n  let FirstRow\n  let SecondRow\n  let ThirdRow;\n  let FourthRow;\n  var Rows;\n\n\n  let PlusButton = new PIXI.Sprite.from(ASSETS.PLUS_SQUARE)\n  \n  PlusButton.interactive = true\n  PlusButton.anchor.set(0.5)\n  PlusButton.on('pointerdown',()=>{\n    PlusButton.interactive = false\n    incActiveFrac(1)\n    setTimeout(()=>{PlusButton.interactive = true},300)\n  })\n  PlusButton.width = INC_BUTTONS_HEIGHT\n  PlusButton.height = INC_BUTTONS_HEIGHT\n\n\n  let MinusButton = new PIXI.Sprite.from(ASSETS.MINUS_SQUARE)\n  MinusButton.interactive = true\n  MinusButton.anchor.set(0.5)\n  MinusButton.on('pointerdown',()=>{\n    MinusButton.interactive = false\n    incActiveFrac(-1)\n    setTimeout(()=>{MinusButton.interactive = true},300)\n  })\n  MinusButton.width = BAR_HEIGHT/2.5\n  MinusButton.height = BAR_HEIGHT/2.5\n\n\n  function placeButtons(){\n\n    let w = ActiveRow.container.width\n    let h = ActiveRow.container.height \n    let x = ActiveRow.container.x + w \n    let y = ActiveRow.container.y\n\n    PlusButton.width = INC_BUTTONS_HEIGHT\n    PlusButton.height = INC_BUTTONS_HEIGHT\n    MinusButton.width = INC_BUTTONS_HEIGHT\n    MinusButton.height = INC_BUTTONS_HEIGHT\n  \n    PlusButton.x = x +  BAR_HEIGHT/2\n    PlusButton.y = y + BAR_HEIGHT/2\n    MinusButton.x = x - w - BAR_HEIGHT/2\n    MinusButton.y = y + BAR_HEIGHT/2\n\n  }\n\n\n  let LeftWhisker  = new PIXI.Graphics()\n  let RightWhisker = new PIXI.Graphics()\n  let MiddleWhisker = new PIXI.Graphics()\n\n  let A;\n  let B;\n\n  // Reference to entities. - deprecated.\n  let backGround;\n  let numberLine;\n  let topNumberLine;\n  let pinA;\n  let pinB;\n  let stripA;\n  let stripB;\n  let stripBLabel;\n  let stripALabel;\n  let incButton;\n  let decButton;\n  let activePin;\n\n\n  function incActiveFrac(inc){\n    ActiveRow.incDenonimator(inc)\n  }\n\n \n  // Constructors (should not be called on re-draw)\n  function makeNumberLine(flip){\n     this.tickSpan = 1\n     this.labelSpan = 1\n     this.max = state.lineMax\n     this.ticks = [] // size 120\n     this.labels = []\n     this.line = new PIXI.Graphics()\n\n     this.init = (n) => {\n        this.line.lineStyle(LINE_THICKNESS,0x000000)\n        this.line.x = LINE_START\n        this.line.y = ARENA_HEIGHT/2\n        this.line.lineTo(LINE_WIDTH,0)\n        app.stage.addChild(this.line)\n\n        for (let i = 0;i<120;i++){\n            let newTick = new PIXI.Graphics()\n            newTick.lineStyle(LINE_THICKNESS,0x000000)\n            newTick.x = this.line.x \n            if(flip){\n              newTick.y = this.line.y + LINE_THICKNESS/2\n              newTick.lineTo(0,-MINOR_TICK_HEIGHT)\n            } else {\n              newTick.y = this.line.y - LINE_THICKNESS/2\n              newTick.lineTo(0,MINOR_TICK_HEIGHT)\n            }\n            app.stage.addChild(newTick)\n            this.ticks.push(newTick)\n\n            // Setup Labels Here\n            let newLabel = new PIXI.Text(i,{\n              fontFamily: \"Arial\",\n              fontSize: DX/2,\n              fill: \"0x000000\",\n              align: \"center\"\n            })\n            newLabel.anchor.x = 0.5\n            this.labels.push(newLabel)\n            newLabel.x = this.line.x + DX*i\n            newLabel.y = this.line.y + MINOR_TICK_HEIGHT\n            if (flip){\n              newLabel.y = this.line.y - 2*MINOR_TICK_HEIGHT\n              newLabel.anchor.y = 1\n              newLabel.text.anchor.y = 0.5\n            }\n            app.stage.addChild(newLabel)\n        }\n        this.increment(0)\n     }\n\n     this.getSetup = ()=> {\n         // update tickspan etc. based on line max.\n     }\n\n     this.increment = (inc) => {\n         // Animation go here\n         this.max += inc\n\n         // Update State - (Context Specific)\n         state.lineMax = this.max\n         updateLayoutParams()\n\n         this.ticks.forEach((e,i)=> {\n            if (i > this.max){\n                TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n            } else {\n                TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n            }\n         })\n\n         this.labels.forEach((e,i)=> {\n          if (i > this.max){\n              TweenLite.to(e,0.5,{x: LINE_WIDTH + this.line.x })\n              TweenLite.to(e,0.5,{alpha: 0})\n          } else {\n              TweenLite.to(e,0.5,{x: LINE_WIDTH/this.max*i + this.line.x})\n              TweenLite.to(e,0.5,{alpha: 1})\n          }\n       })\n     }\n\n     this.draw = () => {\n       let _y;\n       if (flip){\n        _y = TOP_LINE_Y\n       } else {\n         _y = BOTTOM_LINE_Y\n       }\n        this.line.width = LINE_WIDTH\n        this.line.height = LINE_THICKNESS\n        this.line.x = LINE_START\n        this.line.y = _y\n        this.ticks.forEach((e,i)=> {\n            e.width = TICK_THICKNESS\n            e.height = MINOR_TICK_HEIGHT\n            e.y = this.line.y - LINE_THICKNESS/2\n            if (flip){\n              e.y = this.line.y + LINE_THICKNESS/2\n            }\n            if (i > this.max){\n                e.x = LINE_WIDTH + this.line.x \n            } else {\n                e.x =  LINE_WIDTH/this.max*i + this.line.x\n            }\n         })\n         this.labels.forEach((e,i)=> {\n          e.y = this.line.y + MINOR_TICK_HEIGHT\n          if (flip){\n            e.y = this.line.y - MINOR_TICK_HEIGHT\n          }\n          e.style.fontSize = DX/2\n          if (i > this.max){\n              e.x = LINE_WIDTH + this.line.x \n          } else {\n              e.x =  LINE_WIDTH/this.max*i + this.line.x\n          }\n       })\n     }\n     this.init()\n  }\n\n\n\n  function makeBackground(){\n    // Setup Background\n    this.sprite = new PIXI.Sprite.from(CONST.ASSETS.BLUE_GRADIENT);\n    this.sprite.width = WINDOW_WIDTH\n    this.sprite.height = WINDOW_HEIGHT\n    this.sprite.x = 0;\n    this.sprite.y = 0;\n    this.sprite.on('pointerup',globalPointerUp)\n    this.sprite.interactive = true\n\n    app.stage.addChild(this.sprite)\n\n    this.draw = () => {\n        this.sprite.width = WINDOW_WIDTH\n        this.sprite.height = WINDOW_HEIGHT\n    }\n  }\n\n\n  function makePin(id){\n    this.sprite = new PIXI.Sprite()\n    this.sprite.id = id\n    this.sprite.texture = PIN_TEXTURE\n    this.sprite.interactive = true\n    this.sprite.anchor.x = 0.5\n    this.sprite.scale.y = id == 0 ?  1 : -1\n    if (id == 0){\n      this.sprite.on('pointerdown',onDragStart)\n      this.sprite.on('pointermove',onDragMove)\n      this.sprite.on('pointerup',onDragEnd)\n    } else if (id == 1){\n      this.sprite.on('pointerdown',onBDragStart)\n      this.sprite.on('pointermove',onBDragMove)\n      this.sprite.on('pointerup',onBDragEnd)\n    }\n\n    this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    this.sprite.val = 16\n    // Removing pin B for now\n    if (id == 0){\n      app.stage.addChild(this.sprite)\n    }\n\n\n    this.sprite.round = () => {\n\n      // Pre Computation\n      let rawLineX = this.sprite.x - numberLine.line.x\n      let n = Math.round(rawLineX/DX)\n\n      // Setting\n      this.sprite.x = numberLine.line.x + n*DX\n      this.sprite.val = n\n\n      drawWhiskers()\n      // There's gotta be a better pattern than this\n      if (this.sprite.id == 0){\n        state.valA = this.sprite.val\n      } else if (this.sprite.id == 1){\n        state.valB = this.sprite.val\n      }\n    }\n\n    this.draw = () => { \n      this.sprite.width = STRIP_HEIGHT\n      this.sprite.height = STRIP_HEIGHT\n      this.sprite.y = BOTTOM_LINE_Y + MINOR_TICK_HEIGHT + DX/2\n      this.sprite.x = WINDOW_WIDTH/2 - LINE_WIDTH/2 + this.sprite.val*DX\n    }\n    this.draw()\n   }\n\n   function onBDragStart(event) {\n    app.stage.addChild(this)\n    app.stage.addChild(MiddleWhisker)\n    this.deltaTouch = {\n      x: this.x - event.data.global.x,\n      y: this.y - event.data.global.y\n    }\n    this.dragging = true;\n    this.data = event.data;\n}\n\nfunction onBDragEnd(event) {\n  this.dragging = false;\n  this.data = null;\n  drawWhiskers()\n  placeButtons()\n}\n\nfunction onBDragMove(event) {\n  if (this.dragging) {\n    drawWhiskers()\n    let newPosition = this.data.getLocalPosition(this.parent);\n    this.x = newPosition.x + this.deltaTouch.x;\n    // Keep within number line bounds.\n    if (this.x < WINDOW_WIDTH/2-LINE_WIDTH/2){\n      this.dragging = false\n      this.x = WINDOW_WIDTH/2-LINE_WIDTH/2\n    } else if (this.x > WINDOW_WIDTH/2+LINE_WIDTH/2) {\n      this.dragging = false\n      this.x = WINDOW_WIDTH/2+LINE_WIDTH/2\n    }\n  }\n}\n\n\n  // Pin Drag Functions\n  function onDragStart(event) {\n      app.stage.addChild(this)\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n      this.dragging = true;\n      this.data = event.data;\n  }\n\n  function onDragEnd(event) {\n    this.dragging = false;\n    this.data = null;\n    this.round()\n    ActiveRow.setValue()\n    ActiveRow.draw(this.x - LINE_START)\n    drawWhiskers()\n    placeButtons()\n  }\n\n  function onDragMove(event) {\n    if (this.dragging) {\n      let width = this.x - LINE_START\n      ActiveRow.draw(width)\n      drawWhiskers()\n      placeButtons()\n      let newPosition = this.data.getLocalPosition(this.parent);\n      this.x = newPosition.x + this.deltaTouch.x;\n\n      // Keep within number line bounds.\n      if (this.x < WINDOW_WIDTH/2-LINE_WIDTH/2){\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2-LINE_WIDTH/2\n      } else if (this.x > WINDOW_WIDTH/2+LINE_WIDTH/2) {\n        this.dragging = false\n        this.x = WINDOW_WIDTH/2+LINE_WIDTH/2\n      }\n    }\n  }\n\n  function makeArrowButton(inc){\n    let button = new PIXI.Sprite.from(CONST.ASSETS.ARROW)\n    button.inc = inc\n    button.interactive = true\n    button.anchor.set(0.5)\n    button.on('pointerdown',()=>{\n      numberLine.increment(inc)\n      topNumberLine.increment(inc)\n      resize(null,false)\n    })\n    //app.stage.addChild(button)\n\n    button.draw = () => {\n      if (button.inc == -5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2 + 1/2*button.width\n        button.rotation = Math.PI\n      } else if (button.inc == 5){\n        button.width = STRIP_HEIGHT/2\n        button.height = STRIP_HEIGHT/2\n        button.x = WINDOW_WIDTH - 1.1*button.width\n        button.y = WINDOW_HEIGHT/2  - 1/2*button.width\n      }\n    }\n    return button\n  }\n\n  app.stage.on('pointerdown',resizeLine)\n  app.stage.interactive = true\n\n  function resizeLine(event){\n \n  }\n\n\n\n\n \n  function Row(num,den,width,ID){\n\n    // Internal Params\n    let touching = true   \n    let activated = true\n    this.value = 0\n    \n    // Default values\n    this.numerator = num\n    this.denominator = den\n    this.width = width\n    this.id = ID\n  \n    this.container = new PIXI.Container()\n    this.container.id = ID\n    this.container.width = width\n    this.container.interactive = true\n    this.container.y = BOTTOM_LINE_Y - BAR_HEIGHT\n    this.container.x = LINE_START \n    this.sprites = []\n  \n\n    this.blockWidth = width / this.denominator\n\n    this.blockA = new PIXI.Graphics()\n    this.blockA.lineStyle(3,0x000000) \n    this.blockA.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n    let myA = app.renderer.generateTexture(this.blockA)\n\n    this.blockB = new PIXI.Graphics()\n    this.blockB.beginFill(0xff4772)\n    this.blockB.lineStyle(3,0x000000) \n    this.blockB.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n    let myB = app.renderer.generateTexture(this.blockB)\n\n    let g = new PIXI.Graphics()    \n\n\n    this.incDenonimator = (inc) => {\n      console.log(\"this denomonicator - inc\",this.denominator-inc)\n    if (this.denominator + inc >= 1) {\n      console.log(\"shouldn't exectuve if this.denominator is equal to 1\",this.denominator)\n      g.clear()\n      g.lineStyle(3,0x000000) \n      g.drawRoundedRect(0,0,this.width,BAR_HEIGHT,1)\n      let R = app.renderer.generateTexture(g)\n      let s = new PIXI.Sprite()\n      this.container.addChild(s)\n      s.texture = R\n      s.x  = 0\n\n      if (inc > 0){\n        const onComplete = ()=>{\n          s.on('pointerdown',spritePointerDown)\n          s.on('pointerup',spritePointerUp)\n          s.on('pointermove',spritePointerMoved)\n          s.interactive = true\n          s.active = false\n          this.sprites.push(s)\n          this.draw()\n        }\n        TweenMax.to(this, 0.25, {denominator: this.denominator+1,onUpdate: this.draw,onComplete: onComplete})\n      } else if (inc < 0) {\n        let removeme  = this.sprites.pop()\n        this.container.removeChild(removeme)\n        const onComplete = ()=>{\n          this.draw()\n          this.container.removeChild(s)\n        }\n        TweenMax.to(this, 0.25, {denominator: this.denominator-1,onUpdate: this.draw,onComplete: onComplete})\n      }\n     }\n    }\n\n    this.setValue = ()=> {\n      this.value = Math.round(this.width/LINE_WIDTH*state.lineMax)\n      console.log(\"this.value\",this.value)\n    }\n\n    this.draw = (width) => {\n\n      if (width) {\n        this.width = width\n      }\n      this.blockWidth = this.width/this.denominator\n\n      this.blockA.clear()\n      this.blockA.lineStyle(3,0x000000) \n      this.blockA.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      myA = app.renderer.generateTexture(this.blockA)\n\n      this.blockB.clear()\n      this.blockB.beginFill(0xff4772)\n      this.blockB.lineStyle(3,0x000000) \n      this.blockB.drawRoundedRect(0,0,this.blockWidth,BAR_HEIGHT,1)\n      myB = app.renderer.generateTexture(this.blockB)\n\n      for (let i = 0;i<this.sprites.length;i++){\n        if (this.sprites[i].active){\n          this.sprites[i].texture = myB\n        } else {\n          this.sprites[i].texture = myA\n        }\n\n        this.sprites[i].x = this.blockWidth*i\n        this.sprites[i].y = 0\n      }\n\n      //.this.container.y = ANCHORS[this.id]\n\n    }\n\n    for (let i = 0;i<this.denominator;i++) {\n      console.log(\"balls\")\n      let s = new PIXI.Sprite.from(myA)\n      s.on('pointerdown',spritePointerDown)\n      s.on('pointerup',spritePointerUp)\n      s.on('pointermove',spritePointerMoved)\n      s.interactive = true\n      s.active = false\n      s.x = i*LINE_WIDTH/this.denominator\n      s.y = WINDOW_HEIGHT/2 - BAR_HEIGHT\n      this.sprites.push(s)\n      this.container.addChild(s)\n    }\n      \n\n    //  Attached methods\n    this.container.on('pointerdown',containerPointerDown)\n    this.container.on('pointerup',containerPointerUp)\n    this.container.on('pointermove',containerPointerMove)\n\n    // Add children\n    app.stage.addChild(this.container)\n    this.width = this.container.width\n  \n\n    function spritePointerDown(event){\n      this.touched = true\n      this.dragged = false\n    }\n\n    function spritePointerMoved(event) {\n\n      if (this.touched){\n        console.log(\"pointermove\")\n        this.dragged = true\n      }\n    }\n\n    function spritePointerUp(event){\n         this.touched = false\n         console.log('this.draggeed',this.dragged)\n     if (!this.dragged && activated) {\n        this.dragged = false\n        this.active = !this.active\n        this.alpha = 0.2\n        this.texture = this.active ? myB : myA\n        TweenLite.to(this,0.4,{alpha: 1})\n       }\n    }\n\n \n   function containerPointerDown(event) {\n     app.stage.addChild(this)\n      activated = this.id == ActiveIndex\n      ActiveIndex = this.id\n      ActiveRow = Rows[ActiveIndex]\n      disableAllRowsExceptActive()\n      drawWhiskers()\n      placeButtons()\n      pinA.sprite.x = this.width + LINE_START\n      pinA.sprite.round()\n      this.data = event.data\n      this.startWidth = this.width\n      this.dragStartY = event.data.global.y\n      this.touching = true\n      touching = true\n      this.deltaTouch = {\n        x: this.x - event.data.global.x,\n        y: this.y - event.data.global.y\n      }\n    }\n \n   function containerPointerUp(event) {\n      globalPointerUp()\n      this.touching = false\n      touching = false\n    }\n\n    function containerPointerMove(event) {\n\n      if (this.touching){\n        const newPosition = this.data.getLocalPosition(this.parent);\n        this.y = event.data.global.y + this.deltaTouch.y\n      // Keep within number line bounds.\n      if (this.y < TOP_LINE_Y){\n        this.dragging = false\n        this.y = TOP_LINE_Y\n      } else if (this.y > BOTTOM_LINE_Y-BAR_HEIGHT) {\n        this.dragging = false\n        this.y = BOTTOM_LINE_Y  - BAR_HEIGHT\n      }\n        //this.x = event.data.global.x + this.deltaTouch.x\n        //pinA.sprite.x = this.x + this.width\n        this.dragged = true\n        drawWhiskers()\n        placeButtons()\n      }\n    }\n\n\n    this.draw(width)\n    this.setValue()\n\n  }\n\n\n  function disableAllRowsExceptActive(){\n    Rows.forEach((r,i)=> {\n      if (i  != ActiveIndex){\n        r.container.interactive = false\n        r.sprites.forEach(s=>{s.interactive = false})\n      }\n    })\n  }\n\n  function reEnableAllRows(){\n    console.log(\"reinableing all rows\")\n    Rows.forEach((r,i)=> {\n        r.container.interactive = true\n        r.sprites.forEach(s=>{\n          s.interactive = true\n          s.dragged = false \n          s.touched = false\n          s.dragging = false\n        })\n    })\n  }\n\n  function swapRows() {\n    \n    let index;\n    ANCHORS.forEach((a,i)=> {\n      let d = Math.abs(a-ActiveRow.container.y)\n      if (d < BAR_STEP/2) {\n        index = i\n      }\n    })\n    // swap \n\n    if (ActiveIndex != index){\n      console.log(\"swapping\",Rows)\n      let e = ActiveRow\n      Rows.splice(ActiveIndex,1)\n      Rows.splice(index,0,e)\n      console.log(\"swapped\",Rows)\n      ActiveIndex = index\n    }\n    Rows.forEach((r,i)=> {\n      r.container.touching = false\n      r.container.dragged = false\n      r.container.dragging = false\n      r.id = i\n      r.container.id = i\n      \n      TweenMax.to(r.container, 0.2, {y: ANCHORS[i],onComplete: reEnableAllRows})})\n\n      const onComplete = ()=> {\n        RightWhisker.clear()\n        RightWhisker.lineStyle(LINE_THICKNESS/2,0x000000)\n        RightWhisker.moveTo(pinA.sprite.x,ActiveRow.container.y)\n        RightWhisker.lineTo(pinA.sprite.x,numberLine.line.y)\n      }\n      TweenMax.to(PlusButton,0.2,{y: ANCHORS[ActiveIndex]+BAR_HEIGHT/2,alpha: 1,onUpdate: drawWhiskers})\n      TweenMax.to(MinusButton,0.2,{y: ANCHORS[ActiveIndex]+1/2*BAR_HEIGHT,alpha: 1})\n      //drawWhiskers()\n  }\n\n\n  class Rowwow extends PIXI.Sprite {\n     constructor(){\n       super()\n       console.log(\"this\",this)\n       let graphics = new PIXI.Graphics()\n       this.addChild(graphics)\n       console.log(\"Graphbics parent\",graphics.parent.balls())\n     }\n\n     balls(input) {\n       console.log(\"balls called\")\n        if (input) {\n          return this.balls(false)\n        }\n     }\n  }\n\n  let ROWWOW = new Rowwow()\n\n\n  function drawWhiskers(){\n      let WHISKER_THICKNESS = LINE_THICKNESS/2\n\n      LeftWhisker.clear()\n      LeftWhisker.lineStyle(WHISKER_THICKNESS,0x000000)\n      LeftWhisker.moveTo(ActiveRow.container.x,ActiveRow.container.y)\n      LeftWhisker.lineTo(ActiveRow.container.x,numberLine.line.y)\n\n      RightWhisker.clear()\n      RightWhisker.lineStyle(WHISKER_THICKNESS,0x000000)\n      RightWhisker.moveTo(pinA.sprite.x,ActiveRow.container.y)\n      RightWhisker.lineTo(pinA.sprite.x,numberLine.line.y)\n\n      MiddleWhisker.clear()\n      MiddleWhisker.lineStyle(WHISKER_THICKNESS,0x000000)\n      MiddleWhisker.moveTo(pinB.sprite.x,topNumberLine.line.y)\n      MiddleWhisker.lineTo(pinB.sprite.x,numberLine.line.y)\n  }\n\n  function globalPointerUp(){\n    // Ughhh...\n    ActiveRow.container.touching = false\n    pinA.sprite.dragging = false\n    pinA.sprite.round()\n    pinB.sprite.dragging = false\n    ActiveRow.draw(pinA.sprite.x - LINE_START)\n    drawWhiskers()\n    placeButtons()\n    swapRows()\n    //pinB.sprite.round()\n    //stripA.draw()\n    //stripB.draw()\n    //stripALabel.draw()\n    //stripBLabel.draw()\n  }\n  \n  // Called on resize\n  function resize(newFrame,flex){\n    // Make sure all layout parameters are up to date.\n    updateLayoutParams(newFrame)\n    app.renderer.resize(WINDOW_WIDTH,WINDOW_HEIGHT)\n    numberLine.draw()\n    topNumberLine.draw()\n    backGround.draw()\n    pinA.draw()\n    pinB.sprite.x = LINE_START\n    incButton.draw()\n    decButton.draw()\n    Rows.forEach((r,i)=>{\n      r.draw(r.value/state.lineMax*LINE_WIDTH)\n      r.container.x = LINE_START\n      r.container.y = ANCHORS[i]\n    })\n    drawWhiskers()\n    placeButtons()\n  }\n\n  function updateLayoutParams(newFrame){\n    let frame;\n    if (newFrame){\n      frame = newFrame\n    } else {\n      frame = {width: WINDOW_WIDTH,height: WINDOW_HEIGHT}\n    }\n    WINDOW_WIDTH = frame.width\n    WINDOW_HEIGHT = frame.height\n    H_W_RATIO = frame.height/frame.width\n    LANDSCAPE = H_W_RATIO < 3/4\n    ARENA_WIDTH = LANDSCAPE ? 4/3*frame.height : frame.width\n    ARENA_HEIGHT = LANDSCAPE ? frame.height : 3/4*frame.width\n    LINE_WIDTH = LINE_PERCENTAGE*WINDOW_WIDTH\n    LINE_THICKNESS = LINE_WIDTH/200\n    TICK_THICKNESS = LINE_THICKNESS/2\n    MAJOR_TICK_HEIGHT = LINE_WIDTH/20\n    MINOR_TICK_HEIGHT = MAJOR_TICK_HEIGHT/2\n    DX = LINE_WIDTH/state.lineMax\n    LINE_START = WINDOW_WIDTH/2 - LINE_WIDTH/2\n    STRIP_HEIGHT = LINE_WIDTH/12\n    BAR_HEIGHT = (BOTTOM_LINE_Y - TOP_LINE_Y)/5\n    BAR_STEP = (BOTTOM_LINE_Y - TOP_LINE_Y)/4\n    DY = (BOTTOM_LINE_Y - TOP_LINE_Y - 4*BAR_HEIGHT)/3\n    Y1 = BOTTOM_LINE_Y - BAR_HEIGHT\n    Y2 = BOTTOM_LINE_Y - 2*BAR_HEIGHT - DY\n    Y3 = BOTTOM_LINE_Y - 3*BAR_HEIGHT - 2*DY\n    Y4 = TOP_LINE_Y\n    ANCHORS = [Y1,Y2,Y3,Y4]   \n    \n  }\n\n  // Loading Script\n  function load(){\n    let features = {'strips': true}\n    if (setup.props.features){\n      features = setup.props.features\n    }\n\n\n    backGround = new makeBackground()\n\n    // Number Lines\n    numberLine = new makeNumberLine()\n    numberLine.draw()\n    topNumberLine = new makeNumberLine(true)\n    topNumberLine.draw()\n\n    pinA = new makePin(0)\n    pinA.sprite.y = BOTTOM_LINE_Y + 2*MINOR_TICK_HEIGHT\n    pinA.sprite.x = LINE_START + LINE_WIDTH/2\n    pinB = new makePin(1)\n    pinB.sprite.y = TOP_LINE_Y - 1.65*MINOR_TICK_HEIGHT\n    pinB.sprite.x = LINE_START\n    pinA.draw()\n    incButton = makeArrowButton(5)\n    decButton = makeArrowButton(-5)\n    incButton.draw()\n    decButton.draw()\n    FirstRow = new Row(0,5,pinA.sprite.x - LINE_START,0)\n    SecondRow = new Row(0,4,pinA.sprite.x - LINE_START,1)\n    ThirdRow = new Row(0,3,pinA.sprite.x - LINE_START,2)\n    FourthRow = new Row(0,2,pinA.sprite.x - LINE_START,3)\n  \n    FirstRow.container.y = BOTTOM_LINE_Y - BAR_HEIGHT\n    SecondRow.container.y = BOTTOM_LINE_Y - 2*BAR_HEIGHT - DY\n    ThirdRow.container.y = BOTTOM_LINE_Y - 3*BAR_HEIGHT - 2*DY\n    FourthRow.container.y = TOP_LINE_Y\n    Rows = [FirstRow,SecondRow,ThirdRow,FourthRow]\n    ActiveRow = Rows[ActiveIndex]\n\n\n    app.stage.addChild(LeftWhisker)\n    app.stage.addChild(RightWhisker)\n    app.stage.addChild(MiddleWhisker)\n    app.stage.addChild(PlusButton)\n    app.stage.addChild(MinusButton)\n    drawWhiskers()\n    placeButtons()\n  }\n\n  // Call load script\n  load()\n  // Not sure where else to put this.\n  app.resize = (frame) => resize(frame)\n  app.resizable = true\n};\n"]},"metadata":{},"sourceType":"module"}